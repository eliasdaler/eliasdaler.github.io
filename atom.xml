<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

 <title>Elias Daler's blog</title>
 <link href="https://eliasdaler.github.io/atom.xml" rel="self"/>
 <link href="https://eliasdaler.github.io/"/>
 <updated>2021-05-25T01:38:15+03:00</updated>
 <id>https://eliasdaler.github.io</id>
 <author>
   <name></name>
   <email></email>
 </author>

 
 <entry>
   <title>Using CMake and managing dependencies</title>
   <link href="https://eliasdaler.github.io/using-cmake/"/>
   <updated>2021-05-24T00:00:00+03:00</updated>
   <id>https://eliasdaler.github.io/using-cmake</id>
   <content type="html">&lt;p&gt;Building C++ projects and managing dependencies is hard. CMake’s FetchContent makes it much more manageable and easy to do.&lt;/p&gt;

&lt;p&gt;We’ll go step by step and create a simple project which will have SFML, Dear ImGui and ImGui-SFML as its dependencies. The project will clone these dependencies’ source code from Github and build them. You won’t need to use prebuilt libraries ever again.&lt;/p&gt;

&lt;p&gt;I’ll try to explain everything as I go on down to a “basic” things. It’s good to understand everything you do and be able to do it from scratch without any guides. This article will also be a good starting point if you’ve never used CMake before.&lt;/p&gt;

&lt;p&gt;If you just want to learn how to manage dependencies with CMake with &lt;code class=&quot;highlighter-rouge&quot;&gt;FetchContent&lt;/code&gt;, you can just jump straight to &lt;a href=&quot;#adding-sfml-as-a-dependency&quot;&gt;Adding SFML as a dependency&lt;/a&gt; section.&lt;/p&gt;

&lt;p&gt;The source code of the project in the article can be found &lt;a href=&quot;https://github.com/eliasdaler/cmake-fetchcontent-tutorial-code&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;

&lt;!--more--&gt;
&lt;p&gt;&lt;a class=&quot;anchor&quot; id=&quot;read-more&quot;&gt;&lt;/a&gt;&lt;/p&gt;

&lt;h2 class=&quot;no_toc&quot; id=&quot;table-of-contents&quot;&gt;Table of contents&lt;/h2&gt;

&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#hello-world&quot; id=&quot;markdown-toc-hello-world&quot;&gt;Hello, world&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#building-a-project&quot; id=&quot;markdown-toc-building-a-project&quot;&gt;Building a project&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#managing-dependencies&quot; id=&quot;markdown-toc-managing-dependencies&quot;&gt;Managing dependencies&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#manual-management&quot; id=&quot;markdown-toc-manual-management&quot;&gt;Manual management&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#git-submodules&quot; id=&quot;markdown-toc-git-submodules&quot;&gt;Git submodules&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#package-managers&quot; id=&quot;markdown-toc-package-managers&quot;&gt;Package managers&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#fetchcontent&quot; id=&quot;markdown-toc-fetchcontent&quot;&gt;FetchContent&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#adding-sfml-as-a-dependency&quot; id=&quot;markdown-toc-adding-sfml-as-a-dependency&quot;&gt;Adding SFML as a dependency&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#adding-dear-imgui-and-imgui-sfml-as-dependencies&quot; id=&quot;markdown-toc-adding-dear-imgui-and-imgui-sfml-as-dependencies&quot;&gt;Adding Dear ImGui and ImGui-SFML as dependencies&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#speeding-up-your-builds&quot; id=&quot;markdown-toc-speeding-up-your-builds&quot;&gt;Speeding up your builds&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#using-fetchcontent-with-local-source-directories&quot; id=&quot;markdown-toc-using-fetchcontent-with-local-source-directories&quot;&gt;Using FetchContent with local source directories&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#some-notes-about-libraries-which-dont-behave-well&quot; id=&quot;markdown-toc-some-notes-about-libraries-which-dont-behave-well&quot;&gt;Some notes about libraries which don’t behave well&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#missing-or-poorly-written-cmake-build&quot; id=&quot;markdown-toc-missing-or-poorly-written-cmake-build&quot;&gt;Missing or poorly written CMake build&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#build_shared_libs&quot; id=&quot;markdown-toc-build_shared_libs&quot;&gt;BUILD_SHARED_LIBS&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#copying-dlls-on-windows&quot; id=&quot;markdown-toc-copying-dlls-on-windows&quot;&gt;Copying DLLs on Windows&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#find_package&quot; id=&quot;markdown-toc-find_package&quot;&gt;find_package&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#closing-thoughts&quot; id=&quot;markdown-toc-closing-thoughts&quot;&gt;Closing thoughts&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;hello-world&quot;&gt;Hello, world&lt;/h2&gt;

&lt;p&gt;First, let’s create a bunch of files and directories so that we have a structure like this:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;.
├── CMakeLists.txt
└── src
    ├── CMakeLists.txt
    └── main.cpp
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Let’s start with a CMakeLists.txt from a root directory.&lt;/p&gt;

&lt;p&gt;It’s simple:&lt;/p&gt;

&lt;div class=&quot;language-cmake highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;cmake_minimum_required&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;VERSION 3.15&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;project&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;example
  LANGUAGES CXX
  VERSION 1.0
&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;nb&quot;&gt;add_subdirectory&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;src&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The first line sets up a required minimal version of CMake which can be used to build the project. CMake constantly evolves and it’s better to use the latest version for your project as each one brings handy new features, better compiler integration and bug fixes.&lt;/p&gt;

&lt;p class=&quot;message&quot;&gt;
If you're writing a library, it's better to stick to the lowest version of CMake that makes sense for you. You can find the version of CMake that is available for various distros &lt;a href=&quot;https://repology.org/project/cmake/versions&quot;&gt;here&lt;/a&gt;. Another way of choosing is to look at other popular libraries and choose the same version.

For example, &lt;i class=&quot;fa fa-github&quot;&gt;&lt;/i&gt; &lt;a href=&quot;https://github.com/nlohmann/json&quot;&gt;JSON for modern C++&lt;/a&gt; and &lt;i class=&quot;fa fa-github&quot;&gt;&lt;/i&gt; &lt;a href=&quot;https://github.com/fmtlib/fmt&quot;&gt;fmt&lt;/a&gt; use CMake 3.1. I'd recommend using something like CMake 3.8.2 or newer, unless you want to support very old distributions and users who don't want to upgrade to newer versions for some reason.
&lt;/p&gt;

&lt;p&gt;After &lt;code class=&quot;highlighter-rouge&quot;&gt;cmake_minimum_required&lt;/code&gt;, we have a project declaration:&lt;/p&gt;

&lt;div class=&quot;language-cmake highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;project&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;example
  LANGUAGES CXX
  VERSION 1.0
&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The project is similar to a concept of “solution” in Visual Studio terminology. One project can have multiple “targets” (which roughly correspond to “projects” in VS). The target can be an executable, a library or even something which doesn’t produce any files after it’s built (e.g. it can run unit tests, linters and so on).&lt;/p&gt;

&lt;p class=&quot;message&quot;&gt;For example, if you're making a game, you can have multiple targets - a game's main executable, the engine's library (which can be a static or a shared library), a level editor executable and so on. You don't need to make a new project for each of these targets - in most cases one project is enough.&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;LANGUAGES&lt;/code&gt; option in a &lt;code class=&quot;highlighter-rouge&quot;&gt;project&lt;/code&gt; call defines a language which your project uses so that CMake knows what kind of builds to generate. By default it’s &lt;code class=&quot;highlighter-rouge&quot;&gt;C&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;CXX&lt;/code&gt;, but there are a lot of other options available for you (like &lt;code class=&quot;highlighter-rouge&quot;&gt;CUDA&lt;/code&gt; or &lt;code class=&quot;highlighter-rouge&quot;&gt;Fortran&lt;/code&gt;). If you’re doing C or C++ project, it’s optional to specify it, but it’s still useful as a “meta-data” for people who’re reading your CMake build.&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;VERSION&lt;/code&gt; option specifies a current version of your project. It can be used to generate “version” headers (here’s an &lt;a href=&quot;https://cmake.org/cmake/help/v3.20/guide/tutorial/index.html#adding-a-version-number-and-configured-header-file&quot;&gt;example&lt;/a&gt; of how to do it), write some output in a terminal and so on. I’ve seen a lot of people getting &lt;code class=&quot;highlighter-rouge&quot;&gt;VERSION&lt;/code&gt; from a current Git tag or some changelog file, but we’ll not go here in this tutorial.&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;add_subdirectory(&amp;lt;DIR&amp;gt;)&lt;/code&gt; is like an “include” and can be thought of as an inclusion of &lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;lt;DIR&amp;gt;/CMakeLists.txt&lt;/code&gt; into another CMake file. It’s actually a bit more complex, but it’s okay to think about it as “include” at the beginning.&lt;/p&gt;

&lt;p class=&quot;message&quot;&gt;
It's better to decompose CMake build files into smaller files so that you don't get one huge `CMakeLists.txt` which builds everything, but is several thousands lines long and hard to maintain.

For example, if you have an &lt;code&gt;examples&lt;/code&gt; directory, it's good to have a &lt;code&gt;examples/CMakeLists.txt&lt;/code&gt; which will just be a bunch of &lt;code&gt;add_subdirectory&lt;/code&gt; calls for each sub-directory and &lt;code&gt;example/some_example/CMakeLists.txt&lt;/code&gt; will be a build script which contains information on how to build &lt;code&gt;some_example&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Here’s how &lt;code class=&quot;highlighter-rouge&quot;&gt;src/CMakeLists.txt&lt;/code&gt; looks:&lt;/p&gt;

&lt;div class=&quot;language-cmake highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;add_executable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;example_exe main.cpp&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Yep, just one line. Here, we define our first target, &lt;code class=&quot;highlighter-rouge&quot;&gt;example_exe&lt;/code&gt;.&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;In the &lt;code class=&quot;highlighter-rouge&quot;&gt;add_executable&lt;/code&gt; call, we can specify a list of sources needed to build your library or executable. For example, you can have:&lt;/p&gt;

&lt;div class=&quot;language-cmake highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;add_executable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;example_exe
    Game.cpp
    ResourceManager.cpp
    main.cpp&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Another option is to use &lt;code class=&quot;highlighter-rouge&quot;&gt;target_sources&lt;/code&gt;, which can be especially helpful if your target has .cpp files in several subdirectories, e.g.:&lt;/p&gt;

&lt;div class=&quot;language-cmake highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;# in src/CMakeLists.txt&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;add_executable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;example_exe&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;add_subdirectory&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;subdir&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;nf&quot;&gt;target_sources&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;example_exe PUBLIC main.cpp&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-cmake highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;# in src/subdir/CMakeLists.txt&lt;/span&gt;
&lt;span class=&quot;nf&quot;&gt;target_sources&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;example_exe source.cpp&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Read &lt;a href=&quot;https://crascit.com/2016/01/31/enhanced-source-file-handling-with-target_sources/&quot;&gt;this post&lt;/a&gt; to learn more &lt;code class=&quot;highlighter-rouge&quot;&gt;target_sources&lt;/code&gt;.&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;Finally, our &lt;code class=&quot;highlighter-rouge&quot;&gt;main.cpp&lt;/code&gt; looks like this:&lt;/p&gt;

&lt;div class=&quot;language-cpp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;#include &amp;lt;iostream&amp;gt;
&lt;/span&gt;
&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cout&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;Hello, world!&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Now, let’s build this project.&lt;/p&gt;

&lt;h2 id=&quot;building-a-project&quot;&gt;Building a project&lt;/h2&gt;

&lt;p&gt;Create a “build directory”. This is a directory where all temporary CMake, build and object files will be. It’s also the directory in which your executables and libraries will be built (unless you tell CMake not to do so). Ideally, it should be outside of your “source” directory.&lt;/p&gt;

&lt;p class=&quot;message&quot;&gt;This concept is called &quot;out-of-source&quot; build and it's great. For example, you can easily switch between different commits in your &quot;source&quot; directory and still be able to retain your build results if you make a new &quot;build&quot; directory. Another advantage is that you can have a very minimal &lt;code&gt;.gitignore&lt;/code&gt; file, because the build artifacts will all be outside of your repo's directory.&lt;/p&gt;

&lt;p&gt;So, suppose you have a structure like this:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;cmake-example
├── CMakeLists.txt
└── src
    ├── CMakeLists.txt
    └── main.cpp
cmake-example-build
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;When you’re in &lt;code class=&quot;highlighter-rouge&quot;&gt;cmake-example-build&lt;/code&gt; directory (it’s empty at the moment), do this:&lt;/p&gt;

&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;cmake ../cmake-example
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This is the step where CMake does configuration (reading your CMake files, checking their validity, checking your compiler and so on) and generation of build files. If you’re on Windows and only have Visual Studio installed, CMake will generate Visual Studio solutions/projects by default. On Linux it’ll generate GNU Make &lt;code class=&quot;highlighter-rouge&quot;&gt;Makefile&lt;/code&gt;s.&lt;/p&gt;

&lt;p&gt;To specify a generator, simply pass a &lt;code class=&quot;highlighter-rouge&quot;&gt;-G&lt;/code&gt; option with a name of your generator, for example:&lt;/p&gt;

&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;cmake &lt;span class=&quot;nt&quot;&gt;-GNinja&lt;/span&gt; ../cmake-example
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p class=&quot;message&quot;&gt;&lt;a href=&quot;https://ninja-build.org/&quot;&gt;ninja&lt;/a&gt; is a great build tool. It's blazingly fast and I find that it performs better than GNU Make for me in most cases.&lt;/p&gt;

&lt;p&gt;Here’s an example output of configuration and generation if it goes right:&lt;/p&gt;

&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nt&quot;&gt;--&lt;/span&gt; The CXX compiler identification is GNU 9.3.0
&lt;span class=&quot;nt&quot;&gt;--&lt;/span&gt; Check &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;working CXX compiler: /usr/bin/c++
&lt;span class=&quot;nt&quot;&gt;--&lt;/span&gt; Check &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;working CXX compiler: /usr/bin/c++ &lt;span class=&quot;nt&quot;&gt;--&lt;/span&gt; works
&lt;span class=&quot;nt&quot;&gt;--&lt;/span&gt; Detecting CXX compiler ABI info
&lt;span class=&quot;nt&quot;&gt;--&lt;/span&gt; Detecting CXX compiler ABI info - &lt;span class=&quot;k&quot;&gt;done&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;--&lt;/span&gt; Detecting CXX compile features
&lt;span class=&quot;nt&quot;&gt;--&lt;/span&gt; Detecting CXX compile features - &lt;span class=&quot;k&quot;&gt;done&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;--&lt;/span&gt; Configuring &lt;span class=&quot;k&quot;&gt;done&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;--&lt;/span&gt; Generating &lt;span class=&quot;k&quot;&gt;done&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;--&lt;/span&gt; Build files have been written to: ...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Finally, let’s build the project:&lt;/p&gt;

&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;cmake &lt;span class=&quot;nt&quot;&gt;--build&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;You can also build a specific target if you run&lt;/p&gt;

&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;cmake &lt;span class=&quot;nt&quot;&gt;--build&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;--target&lt;/span&gt; &amp;lt;target_name&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;, for example:&lt;/p&gt;

&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;cmake &lt;span class=&quot;nt&quot;&gt;--build&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;--target&lt;/span&gt; example_exe
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;You’ll find the executable in &lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;lt;your-build-dir&amp;gt;/src/&lt;/code&gt; directory or &lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;lt;your-build-dir&amp;gt;/Debug/src&lt;/code&gt; if you’re using Visual Studio to build the project.&lt;/p&gt;

&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;./src/example_exe
Hello, world!
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p class=&quot;message&quot;&gt;If you've generated a Visual Studio solution, you can just use Visual Studio for building. It even checks if any CMakeLists.txt was modified and re-generates solution/project which changed. You'll see VS asking if it should reload the project which has changed - you should agree do it so that it works properly.&lt;/p&gt;

&lt;p&gt;If the target you’re building is a library, CMake will build a static one by default. To build a shared library, set &lt;code class=&quot;highlighter-rouge&quot;&gt;BUILD_SHARED_LIBS=ON&lt;/code&gt; like this:&lt;/p&gt;

&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;cmake &lt;span class=&quot;nt&quot;&gt;-DBUILD_SHARED_LIBS&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;ON &amp;lt;source-dir&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Some generators (Visual Studio and XCode) support building multiple configurations of your projects in one build directory. You can do it by specifying &lt;code class=&quot;highlighter-rouge&quot;&gt;--config&lt;/code&gt; flag during the build like so:&lt;/p&gt;

&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;cmake &lt;span class=&quot;nt&quot;&gt;--build&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;--target&lt;/span&gt; some_target &lt;span class=&quot;nt&quot;&gt;--config&lt;/span&gt; Release
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If in Ninja, GNU make and so on, your &lt;code class=&quot;highlighter-rouge&quot;&gt;example_exe&lt;/code&gt; will be located in &lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;lt;build-dir&amp;gt;/src/&lt;/code&gt;, in Visual Studio it will be localted in &lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;lt;build-dir&amp;gt;/src/&amp;lt;config&amp;gt;/&lt;/code&gt; (e.g. &lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;lt;build-dir&amp;gt;/src/Release&lt;/code&gt;).&lt;/p&gt;

&lt;p&gt;For generators which don’t support multi-configuration builds in one build directory, you’ll have to make multiple build directories for each build type.&lt;/p&gt;

&lt;h1 id=&quot;managing-dependencies&quot;&gt;Managing dependencies&lt;/h1&gt;

&lt;p&gt;There are a lot of ways of managing dependencies with CMake, so let’s to a quick overview of possible ways.&lt;/p&gt;

&lt;h2 id=&quot;manual-management&quot;&gt;Manual management&lt;/h2&gt;

&lt;p&gt;The simplest way of doing dependency management is to simply copy source code of your dependencies into your project source directory. For example, you can just copy SFML sources to your &lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;lt;source-dir&amp;gt;/dependencies/SFML&lt;/code&gt; and then just do &lt;code class=&quot;highlighter-rouge&quot;&gt;add_subdirectory(dependencies/SFML)&lt;/code&gt; in your main CMake file (and then link to SFML’s targets as needed)&lt;/p&gt;

&lt;p&gt;However, this is not the best way of doing it:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;It might be hard to know which exact version the dependencies are.&lt;/li&gt;
  &lt;li&gt;You also don’t get a clear picture if you’ve modified the dependencies’ sources (e.g. to fix some problem or by mistake when you refactored something). Updating them is not fun then.&lt;/li&gt;
  &lt;li&gt;Your source directory might become huge if you have a lot of dependencies (and the repo size might increase dramatically as well).&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;git-submodules&quot;&gt;Git submodules&lt;/h2&gt;

&lt;p&gt;Git submodules are basically pointers to other repositories. The pointer basically stores repo’s URL and the commit you choose to point at (e.g. commit of a specific library version).&lt;/p&gt;

&lt;p&gt;You can directly use &lt;code class=&quot;highlighter-rouge&quot;&gt;add_subdirectory(...)&lt;/code&gt; with dependencies referenced via submodules, but you’ll need to check via CMake that dependencies were cloned, otherwise you’ll get errors about CMake not being able to find referenced subdirectories.&lt;/p&gt;

&lt;p&gt;You can read more about Git submodules &lt;a href=&quot;https://git-scm.com/book/en/v2/Git-Tools-Submodules&quot;&gt;here&lt;/a&gt;. I don’t use them myself, as I don’t like the git’s commands for their management and the metadata about your dependencies is not as clear as it could be.&lt;/p&gt;

&lt;p&gt;It also introduces a dependency on git and some people might have troubles trying to build your library because submodule management is not very user friendly.&lt;/p&gt;

&lt;h2 id=&quot;package-managers&quot;&gt;Package managers&lt;/h2&gt;

&lt;p&gt;There’s a bunch of package managers available for C++ right now: Conan, vcpkg and so on. They can be a great way of managing dependencies.&lt;/p&gt;

&lt;p&gt;I don’t like them for a few reasons.&lt;/p&gt;

&lt;p&gt;There’s no standard package manager in C++ world as of today, which leads to a fragmentation and build scripts not being available for all your dependencies. These build scripts are not supported by library maintainers most of the time, which leads to them to quickly becoming out of date with the latest version of the library or having some build features not being available to you.&lt;/p&gt;

&lt;p&gt;And finally, I like having few dependencies. I only need Git, a C++ compiler and CMake for building things I write.&lt;/p&gt;

&lt;h2 id=&quot;fetchcontent&quot;&gt;FetchContent&lt;/h2&gt;

&lt;p&gt;This is the way of managing dependencies that I personally use and like a lot. Basically, it allows you to download or clone source code of external projects from the Web (or other source) and then use this sources via &lt;code class=&quot;highlighter-rouge&quot;&gt;add_subdirectory&lt;/code&gt; call and linking to dependency’s targets or other means.&lt;/p&gt;

&lt;p&gt;It’s a wrapper around &lt;code class=&quot;highlighter-rouge&quot;&gt;ExternalProject&lt;/code&gt; CMake command, which can do a lot of things:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;It can download or git clone other project sources&lt;/li&gt;
  &lt;li&gt;Configure and build them&lt;/li&gt;
  &lt;li&gt;Run some commands at various steps of build process&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;A typical &lt;code class=&quot;highlighter-rouge&quot;&gt;ExternalProject&lt;/code&gt; declaration looks like this:&lt;/p&gt;

&lt;div class=&quot;language-cmake highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nf&quot;&gt;ExternalProject_Add&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;foobar
  GIT_REPOSITORY    git@github.com:FooCo/FooBar.git
  GIT_TAG           origin/release/1.2.3
&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The problem with it was that it did download at &lt;strong&gt;build&lt;/strong&gt; time, which doesn’t allow you to link to your dependencies targets - you need to link to library files produced after the build like this:&lt;/p&gt;

&lt;div class=&quot;language-cmake highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;target_include_directories&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;your_target PRIVATE &amp;lt;path-to-foorbar-includes&amp;gt;
&lt;span class=&quot;nb&quot;&gt;target_link_libraries&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;your_target PRIVATE &amp;lt;path-to-a-build-foorbar-library&amp;gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This wasn’t convenient, as a lot of dependencies build internals spilled into your build files and you needed to do a lot more work than simply linking to dependencies’ targets.&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;FetchContent&lt;/code&gt; solves that problem by downloading the dependency at &lt;strong&gt;configure&lt;/strong&gt; time, which allows you to do this:&lt;/p&gt;

&lt;div class=&quot;language-cmake highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nf&quot;&gt;FetchContent_Declare&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;foobar
  GIT_REPOSITORY    git@github.com:FooCo/FooBar.git
  GIT_TAG           origin/release/1.2.3
&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;nf&quot;&gt;FetchContent_MakeAvailable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;foobar&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;# somewhere later...&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;target_link_libraries&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;your_target PRIVATE foobar_target&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;There are some downsides to using FetchContent, however:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Your initial configuration step might take a lot of time if you have a lot of dependencies, because some repos might take a lot of time to download (it can take minutes!). However, with &lt;code class=&quot;highlighter-rouge&quot;&gt;ExternalProject&lt;/code&gt; you can get the same problem, but during the build process instead.&lt;/li&gt;
  &lt;li&gt;Some libraries might depend on other libraries being built and installed on the system. They will use &lt;code class=&quot;highlighter-rouge&quot;&gt;find_package&lt;/code&gt; or &lt;code class=&quot;highlighter-rouge&quot;&gt;find_library&lt;/code&gt; to find them and this might cause some problems for you. I’ll talk about it &lt;a href=&quot;#find_package&quot;&gt;find_package&lt;/a&gt; section of this article in more detail.&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;adding-sfml-as-a-dependency&quot;&gt;Adding SFML as a dependency&lt;/h1&gt;

&lt;p&gt;Create &lt;code class=&quot;highlighter-rouge&quot;&gt;depedencies/CMakeLists.txt&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;dependencies/sfml/CMakeLists.txt&lt;/code&gt;. We have the following structure now:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;.
├── CMakeLists.txt
├── dependencies
│   ├── CMakeLists.txt
│   └── sfml
│       └── CMakeLists.txt
└── src
    ├── CMakeLists.txt
    └── main.cpp
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p class=&quot;message&quot;&gt;I like naming dependencies and their directories in lowercase, because it allows me to not have to not think if the third-party dependency directory is named &quot;openAL&quot;, &quot;OpenAL&quot; - it'll be just &quot;openal&quot;. &quot;ImGui-SFML&quot; will be &quot;imgui-sfml&quot;.&lt;/p&gt;

&lt;p&gt;First, let’s add &lt;code class=&quot;highlighter-rouge&quot;&gt;add_subdirectory(dependencies)&lt;/code&gt; to our root &lt;code class=&quot;highlighter-rouge&quot;&gt;CMakeLists.txt&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;language-cmake highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;...

&lt;span class=&quot;nb&quot;&gt;add_subdirectory&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;dependencies&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;# add this&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;add_subdirectory&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;src&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The &lt;code class=&quot;highlighter-rouge&quot;&gt;dependencies/CMakeLists.txt&lt;/code&gt; looks like this:&lt;/p&gt;

&lt;div class=&quot;language-cmake highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;include&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;FetchContent&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;nf&quot;&gt;FetchContent_Declare&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
  sfml
  GIT_REPOSITORY &lt;span class=&quot;s2&quot;&gt;&quot;https://github.com/SFML/SFML&quot;&lt;/span&gt;
  GIT_TAG 2f11710abc5aa478503a7ff3f9e654bd2078ebab &lt;span class=&quot;c1&quot;&gt;# 2.5.1&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;nb&quot;&gt;add_subdirectory&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;sfml&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Note that you can specify &lt;code class=&quot;highlighter-rouge&quot;&gt;GIT_TAG&lt;/code&gt; by the name and not by the commit hash, but referencing by commit hash makes &lt;code class=&quot;highlighter-rouge&quot;&gt;FetchContent&lt;/code&gt; quicker, because it doesn’t have to connect the remote to check if the tag hasn’t been modified.&lt;/p&gt;

&lt;p&gt;Next, &lt;code class=&quot;highlighter-rouge&quot;&gt;dependencies/sfml/CMakeLists.txt&lt;/code&gt; (I’ll explain what goes on here a bit later):&lt;/p&gt;

&lt;div class=&quot;language-cmake highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;STATUS &lt;span class=&quot;s2&quot;&gt;&quot;Fetching SFML...&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;# No need to build audio and network modules&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;SFML_BUILD_AUDIO FALSE&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;SFML_BUILD_NETWORK FALSE&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;nf&quot;&gt;FetchContent_MakeAvailable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;sfml&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;src/CMakeLists.txt&lt;/code&gt; looks like this now:&lt;/p&gt;

&lt;div class=&quot;language-cmake highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;add_executable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;example_exe main.cpp&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;target_link_libraries&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;example_exe PRIVATE sfml-graphics&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And finally, let’s change our &lt;code class=&quot;highlighter-rouge&quot;&gt;src/main.cpp&lt;/code&gt; to the following “SFML Hello world” code which is used in its many examples:&lt;/p&gt;

&lt;div class=&quot;language-cpp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;#include &amp;lt;SFML/Graphics.hpp&amp;gt;
&lt;/span&gt;
&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;sf&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;RenderWindow&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;window&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sf&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;VideoMode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;200&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;200&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;SFML works!&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;sf&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CircleShape&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;shape&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;100.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;shape&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;setFillColor&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sf&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Color&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Green&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;window&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;isOpen&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;())&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;sf&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Event&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;event&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;window&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pollEvent&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;event&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;event&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sf&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Event&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Closed&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;window&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;close&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

        &lt;span class=&quot;n&quot;&gt;window&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;clear&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;window&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;draw&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;shape&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;window&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;display&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If you’re building on Windows, run the generation step again and set &lt;code class=&quot;highlighter-rouge&quot;&gt;BUILD_SHARED_LIBS&lt;/code&gt; to &lt;code class=&quot;highlighter-rouge&quot;&gt;OFF&lt;/code&gt; so that SFML doesn’t make it &lt;code class=&quot;highlighter-rouge&quot;&gt;ON&lt;/code&gt; causing issues with DLLs.&lt;/p&gt;

&lt;div class=&quot;language-cmake highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;cmake -DBUILD_SHARED_LIBS=OFF &amp;lt;source-dir&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;More about this in &lt;a href=&quot;#copying-dlls-on-windows&quot;&gt;“Copying DLLs on Windows”&lt;/a&gt; section.&lt;/p&gt;

&lt;p&gt;Now, let’s build the project:&lt;/p&gt;

&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;cmake &lt;span class=&quot;nt&quot;&gt;--build&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;A lot of the time can pass after “Fetching SFML…” message is displayed (even a minute or so).&lt;/p&gt;

&lt;p&gt;This is normal and can be caused by your Internet connection, GitHub being slow, or older versions of CMake where &lt;code class=&quot;highlighter-rouge&quot;&gt;FetchContent&lt;/code&gt; is not as quick as it can be (the developers seem to be working on its speed, so try to use the oldest version of CMake).&lt;/p&gt;

&lt;p&gt;A lot of dependencies can be downloaded much quicker if you download a release zip instead, for example for SFML we can do this:&lt;/p&gt;

&lt;div class=&quot;language-cmake highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nf&quot;&gt;FetchContent_Declare&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
  sfml
  URL https://github.com/SFML/SFML/archive/refs/tags/2.5.1.zip
  URL_HASH 2c4438b3e5b2d81a6e626ecf72bf75be
&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It’s also a good idea to specify &lt;code class=&quot;highlighter-rouge&quot;&gt;URL_HASH&lt;/code&gt; here to not download anything which you didn’t expect. You can usually find md5 hash or release in release notes or calculate it yourself using &lt;code class=&quot;highlighter-rouge&quot;&gt;md5sum&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Finally, run &lt;code class=&quot;highlighter-rouge&quot;&gt;src/example_exe&lt;/code&gt; and you’ll see this:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/cmake_article/sfml-simple.png&quot; alt=&quot;Green circle on a black background&quot; style=&quot;display:block; margin: 0 auto; width: 480px&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Now, let’s see what’s going on in &lt;code class=&quot;highlighter-rouge&quot;&gt;dependencies/sfml/CMakeLists.txt&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;First of all, we have a message which just prints “Fetching SFML…”:&lt;/p&gt;

&lt;div class=&quot;language-cmake highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Fetching SFML...&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;You can also have it say where it will fetch SFML from, at which commit, which version, etc. Having something printed there is useful, because otherwise you’ll not be able to take which dependency takes a lot of time to download (or fails at configuration step). However, it will also print it every time you run a generation step, even if nothing will get downloaded. I think it’s not a big deal.&lt;/p&gt;

&lt;p&gt;Then, we have a couple of &lt;code class=&quot;highlighter-rouge&quot;&gt;set&lt;/code&gt; calls which need to be done before &lt;code class=&quot;highlighter-rouge&quot;&gt;FetchContent_MakeAvailable&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;language-cmake highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;SFML_BUILD_AUDIO FALSE&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;SFML_BUILD_NETWORK FALSE&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;hr /&gt;

&lt;p&gt;A lot of libraries allow you to modify their behaviour and build process by setting CMake variables. CMake has a complex way of how &lt;code class=&quot;highlighter-rouge&quot;&gt;option&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;set(... CACHE ...)&lt;/code&gt; behave depending on if you have defined the variable or not. Sometimes a simple &lt;code class=&quot;highlighter-rouge&quot;&gt;set&lt;/code&gt; is not enough and you’ll need to do a &lt;code class=&quot;highlighter-rouge&quot;&gt;set(... CACHE ...)&lt;/code&gt; and even &lt;code class=&quot;highlighter-rouge&quot;&gt;set(... CACHE ... FORCE)&lt;/code&gt; to stop dependency’s CMakeLists.txt from overwriting the variable you’re trying to set.&lt;/p&gt;

&lt;p class=&quot;message&quot;&gt;It's a good practice to take a look at what gets built by default in your dependencies and tell CMake to build only what you need from the dependency (some libraries can build examples, docs and tests by default, which you probably don't need).&lt;/p&gt;

&lt;p&gt;Finally, we call &lt;code class=&quot;highlighter-rouge&quot;&gt;FetchContent_MakeAvailable&lt;/code&gt; which basically does some internal &lt;code class=&quot;highlighter-rouge&quot;&gt;FetchContent&lt;/code&gt; variable and then calls &lt;code class=&quot;highlighter-rouge&quot;&gt;add_subdirectory&lt;/code&gt; for the directory it has downloaded making dependency’s targets available to you.&lt;/p&gt;

&lt;p class=&quot;message&quot;&gt;
The source files of SFML can now be found in &lt;code&gt;*build_dir*/_deps/sfml-src&lt;/code&gt;, SFML's build directory and produced binaries can be found in &lt;code&gt;*build_dir*/_deps/sfml-build&lt;/code&gt;.
&lt;/p&gt;

&lt;h1 id=&quot;adding-dear-imgui-and-imgui-sfml-as-dependencies&quot;&gt;Adding Dear ImGui and ImGui-SFML as dependencies&lt;/h1&gt;

&lt;p&gt;Now, let’s look at something more complicated.&lt;/p&gt;

&lt;p&gt;I want to add &lt;a href=&quot;https://github.com/eliasdaler/imgui-sfml&quot;&gt;ImGui-SFML&lt;/a&gt; as a dependency - it’s the library that allows you to easily integrate &lt;a href=&quot;https://github.com/ocornut/imgui&quot;&gt;Dear ImGui&lt;/a&gt; and SFML. Let’s add Dear ImGui as a dependency first.&lt;/p&gt;

&lt;p&gt;Add this to &lt;code class=&quot;highlighter-rouge&quot;&gt;dependencies/CMakeLists.txt&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;language-cmake highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nf&quot;&gt;FetchContent_Declare&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
  imgui
  GIT_REPOSITORY https://github.com/ocornut/imgui
  GIT_TAG 35b1148efb839381b84de9290d9caf0b66ad7d03
&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;nf&quot;&gt;FetchContent_MakeAvailable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;imgui&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Dear ImGui doesn’t have a CMake build for the time of writing. We still need to call &lt;code class=&quot;highlighter-rouge&quot;&gt;FetchContent_MakeAvailable&lt;/code&gt;, though, so that we get &lt;code class=&quot;highlighter-rouge&quot;&gt;imgui_SOURCE_DIR&lt;/code&gt; variable set which we’ll use when setting up ImGui-SFML in a moment.&lt;/p&gt;

&lt;p&gt;Next, let’s add ImGui-SFML to &lt;code class=&quot;highlighter-rouge&quot;&gt;dependencies/CMakeLists.txt&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;language-cmake highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nf&quot;&gt;FetchContent_Declare&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
  imgui-sfml
  GIT_REPOSITORY https://github.com/eliasdaler/imgui-sfml
  GIT_TAG 82dc2033e51b8323857c3ae1cf1f458b3a933c35
&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;add_subdirectory&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;imgui-sfml&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Next, we’ll create &lt;code class=&quot;highlighter-rouge&quot;&gt;dependency/imgui-sfml/CMakeLists.txt&lt;/code&gt;, which looks like this:&lt;/p&gt;

&lt;div class=&quot;language-cmake highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;STATUS &lt;span class=&quot;s2&quot;&gt;&quot;Fetching ImGui-SFML...&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;nb&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;IMGUI_DIR &lt;span class=&quot;si&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;imgui_SOURCE_DIR&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;IMGUI_SFML_FIND_SFML OFF&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;IMGUI_SFML_IMGUI_DEMO ON&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;nf&quot;&gt;FetchContent_MakeAvailable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;imgui-sfml&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Nothing special - we need to set &lt;code class=&quot;highlighter-rouge&quot;&gt;IMGUI_DIR&lt;/code&gt; to a place where Dear ImGui sources can be found and set &lt;code class=&quot;highlighter-rouge&quot;&gt;IMGUI_SFML_FIND_SFML&lt;/code&gt; to &lt;code class=&quot;highlighter-rouge&quot;&gt;OFF&lt;/code&gt; so that ImGui-SFML doesn’t attempt to call &lt;code class=&quot;highlighter-rouge&quot;&gt;find_package(SFML)&lt;/code&gt; which will fail (more about that in &lt;code class=&quot;highlighter-rouge&quot;&gt;find_package&lt;/code&gt; section a bit later).&lt;/p&gt;

&lt;p&gt;Note that &lt;code class=&quot;highlighter-rouge&quot;&gt;add_subdirectory(imgui-sfml)&lt;/code&gt; should be place before &lt;code class=&quot;highlighter-rouge&quot;&gt;FetchContent_MakeAvailable(imgui)&lt;/code&gt; call so that &lt;code class=&quot;highlighter-rouge&quot;&gt;imgui_SOURCE_DIR&lt;/code&gt; gets defined.&lt;/p&gt;

&lt;p&gt;Next, let’s change the contents of &lt;code class=&quot;highlighter-rouge&quot;&gt;src/main.cpp&lt;/code&gt; to the following:&lt;/p&gt;

&lt;div class=&quot;language-cpp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;#include &amp;lt;SFML/Graphics/RenderWindow.hpp&amp;gt;
#include &amp;lt;SFML/System/Clock.hpp&amp;gt;
#include &amp;lt;SFML/Window/Event.hpp&amp;gt;
&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;#include &amp;lt;imgui-SFML.h&amp;gt;
#include &amp;lt;imgui.h&amp;gt;
&lt;/span&gt;
&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;sf&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;RenderWindow&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;window&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sf&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;VideoMode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1280&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;720&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;ImGui + SFML = &amp;lt;3&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;window&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;setFramerateLimit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;60&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;ImGui&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SFML&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Init&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;window&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;sf&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Clock&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;deltaClock&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;window&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;isOpen&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;())&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;sf&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Event&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;event&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;window&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pollEvent&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;event&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;ImGui&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SFML&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ProcessEvent&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;event&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;event&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sf&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Event&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Closed&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;window&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;close&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

        &lt;span class=&quot;n&quot;&gt;ImGui&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SFML&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Update&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;window&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;deltaClock&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;restart&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;());&lt;/span&gt;

        &lt;span class=&quot;n&quot;&gt;ImGui&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ShowDemoWindow&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;

        &lt;span class=&quot;n&quot;&gt;window&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;clear&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;ImGui&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SFML&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Render&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;window&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;window&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;display&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;ImGui&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SFML&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Shutdown&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This is a “hello world” of ImGui-SFML - it calls all the necessary functions for ImGui-SFML to do its thing and calls &lt;code class=&quot;highlighter-rouge&quot;&gt;ImGui::ShowDemoWindow&lt;/code&gt; which is a great way to see how many things Dear ImGui can do.&lt;/p&gt;

&lt;p&gt;Finally, we change &lt;code class=&quot;highlighter-rouge&quot;&gt;target_link_libraries&lt;/code&gt; call in &lt;code class=&quot;highlighter-rouge&quot;&gt;src/CMakeLists.txt&lt;/code&gt; to the following:&lt;/p&gt;

&lt;div class=&quot;language-cmake highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;target_link_libraries&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;example_exe PRIVATE ImGui-SFML::ImGui-SFML&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Yep, that’s it! Notice that the implicit linking to the &lt;code class=&quot;highlighter-rouge&quot;&gt;sfml-graphics&lt;/code&gt; is gone - ImGui-SFML links to it in its build files, so now you don’t need to link to SFML directly.&lt;/p&gt;

&lt;p&gt;Finally, let’s build our program and you’ll see something like this (I opened a few menus to make the screenshot more interesting).&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/cmake_article/imgui-sfml.png&quot; alt=&quot;ImGui-SFML with bunch of menus and examples open&quot; style=&quot;display:block; margin: 0 auto; width: 720px&quot; /&gt;&lt;/p&gt;

&lt;h1 id=&quot;speeding-up-your-builds&quot;&gt;Speeding up your builds&lt;/h1&gt;

&lt;p&gt;Of course, having to rebuild dependencies from scratch can take a lot of time. There’s a simple solution to that: &lt;a href=&quot;https://github.com/ccache/ccache&quot;&gt;ccache&lt;/a&gt;. This amazing program will cache all the object files you build and then instead of compiling the same source file from scratch over and over, it’ll just use the cached object file instead of doing compilation.&lt;/p&gt;

&lt;p&gt;It works with Clang and GCC and a couple of other compilers. MSVC is not supported, unfortunately.&lt;/p&gt;

&lt;p&gt;To use it, simply install it somewhere on your system and then do this on CMake configuration step:&lt;/p&gt;

&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;cmake ... &lt;span class=&quot;nt&quot;&gt;--DCMAKE_CXX_COMPILER_LAUNCHER&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;ccache ...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;You can also add this to your CMake builds to not have to set &lt;code class=&quot;highlighter-rouge&quot;&gt;CMAKE_CXX_COMPILER_LAUNCHER&lt;/code&gt; manually every time:&lt;/p&gt;

&lt;div class=&quot;language-cmake highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;find_program&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;CCACHE_FOUND ccache&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;CCACHE_FOUND&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;set_property&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;GLOBAL PROPERTY RULE_LAUNCH_COMPILE ccache&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;endif&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;CCACHE_FOUND&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h1 id=&quot;using-fetchcontent-with-local-source-directories&quot;&gt;Using FetchContent with local source directories&lt;/h1&gt;

&lt;p&gt;Sometimes it can be useful to download sources for dependencies and have FetchContent use them instead of fetching them from the Web. This can be needed for a few reasons:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;You don’t want to download sources again and again when you remove your build directories&lt;/li&gt;
  &lt;li&gt;You’re going somewhere where Internet connection is poor or not available&lt;/li&gt;
  &lt;li&gt;You want to do some source changes and see how the dependency will behave with them.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;This is easy to do. Just set &lt;code class=&quot;highlighter-rouge&quot;&gt;FETCHCONTENT_SOURCE_DIR_&amp;lt;lib&amp;gt;&lt;/code&gt; to your dependency source dir and you’re done, for example:&lt;/p&gt;

&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;cmake &lt;span class=&quot;nt&quot;&gt;-DFETCHCOUNTENT_SOURCE_DIR_SFML&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&amp;lt;sfml-dir&amp;gt; &amp;lt;main-project-source-dir&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Note that even if your library is named &lt;code class=&quot;highlighter-rouge&quot;&gt;sfml&lt;/code&gt; in CMake, you’ll need to set &lt;code class=&quot;highlighter-rouge&quot;&gt;FETCHCONTENT_SOURCE_DIR_SFML&lt;/code&gt; and not &lt;code class=&quot;highlighter-rouge&quot;&gt;FETCHCONTENT_SOURCE_DIR_sfml&lt;/code&gt;.&lt;/p&gt;

&lt;h1 id=&quot;some-notes-about-libraries-which-dont-behave-well&quot;&gt;Some notes about libraries which don’t behave well&lt;/h1&gt;

&lt;p&gt;In the example I’ve showed you, everything went pretty well. In most cases it won’t - you’ll spend a lot more time trying to get the library to work with your project, so let’s look at some common cases.&lt;/p&gt;

&lt;h2 id=&quot;missing-or-poorly-written-cmake-build&quot;&gt;Missing or poorly written CMake build&lt;/h2&gt;

&lt;p&gt;Not all libraries are built with CMake, Dear ImGui and Lua being examples. In some cases, there’s a CMake build, but it can be outdated or written in older CMake which makes build targets essentially useless (e.g. instead of &lt;code class=&quot;highlighter-rouge&quot;&gt;target_include_libraries&lt;/code&gt; which carry transitive include directory dependencies, the library can use &lt;code class=&quot;highlighter-rouge&quot;&gt;include_directories&lt;/code&gt; which will force you to manually specify include directories and other things for the library you link to).&lt;/p&gt;

&lt;p&gt;There are several ways of handling this:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;The best, but most complicated way is to fork the project, fix the CMake build and submit a PR. Until the PR is merged, you point &lt;code class=&quot;highlighter-rouge&quot;&gt;FetchContent&lt;/code&gt; to the branch of your fork and wait. It’s difficult, but it helps a lot of people in the future. I’ve done it myself and noticed that CMake builds of the libraries I use (SDL, for example) have improved gradually over the years thanks to other people’s contributions&lt;/li&gt;
  &lt;li&gt;Use some “alternative” CMake build/fork of a library. For example, for Lua I use &lt;a href=&quot;https://github.com/LuaDist/lua&quot;&gt;this repo&lt;/a&gt; and for GLEW, I use &lt;a href=&quot;https://github.com/Perlmint/glew-cmake&quot;&gt;this one&lt;/a&gt;.&lt;/li&gt;
  &lt;li&gt;You can use &lt;code class=&quot;highlighter-rouge&quot;&gt;FetchContent&lt;/code&gt; for getting source code of the library and then write the needed CMake build code from scratch as I’ve done in &lt;a href=&quot;https://github.com/eliasdaler/imgui-fetchcontent&quot;&gt;this example&lt;/a&gt; of using Dear ImGui with SDL with FetchContent.&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;build_shared_libs&quot;&gt;BUILD_SHARED_LIBS&lt;/h2&gt;

&lt;p&gt;A lot of libraries tend to ignore &lt;code class=&quot;highlighter-rouge&quot;&gt;BUILD_SHARED_LIBS&lt;/code&gt; and either build shared libraries by default or build both static and shared library unless you tell it not to do that. You’ll probably need to look at your dependency’s &lt;code class=&quot;highlighter-rouge&quot;&gt;CMakeList.txt&lt;/code&gt; to understand how to build a static or shared library depending on your needs.&lt;/p&gt;

&lt;p&gt;In SFML’s case, if you don’t set &lt;code class=&quot;highlighter-rouge&quot;&gt;BUILD_SHARED_LIBS&lt;/code&gt; to &lt;code class=&quot;highlighter-rouge&quot;&gt;OFF&lt;/code&gt;, it’ll just build shared libraries, which is a bit frustrating. To fix this, you’ll need to set &lt;code class=&quot;highlighter-rouge&quot;&gt;BUILD_SHARED_LIBS&lt;/code&gt; to &lt;code class=&quot;highlighter-rouge&quot;&gt;OFF&lt;/code&gt; if you need to build SFML as static libraries.&lt;/p&gt;

&lt;h2 id=&quot;copying-dlls-on-windows&quot;&gt;Copying DLLs on Windows&lt;/h2&gt;

&lt;p&gt;If you’re using dynamic linking when building on Windows, you’ll need to copy DLLs to the directory where your executable is built, so that it can find them. This can be done by adding the following:&lt;/p&gt;

&lt;div class=&quot;language-cmake highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;# Copy DLLs needed for runtime on Windows&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;WIN32&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;BUILD_SHARED_LIBS&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;add_custom_command&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;TARGET example_exe POST_BUILD
      COMMAND &lt;span class=&quot;si&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CMAKE_COMMAND&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt; -E copy_if_different
          $&amp;lt;TARGET_FILE:ImGui-SFML::ImGui-SFML&amp;gt;
          $&amp;lt;TARGET_FILE:sfml-graphics&amp;gt;
          $&amp;lt;TARGET_FILE:sfml-window&amp;gt;
          $&amp;lt;TARGET_FILE:sfml-system&amp;gt;
          $&amp;lt;TARGET_FILE_DIR:example_exe&amp;gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;endif&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;endif&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Basically, CMake will take build artifacts of &lt;code class=&quot;highlighter-rouge&quot;&gt;ImGui-SFML&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;sfml-graphics&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;sfml-window&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;sfml-system&lt;/code&gt; targets (DLLs) and copy them to the directory where executable &lt;code class=&quot;highlighter-rouge&quot;&gt;example_exe&lt;/code&gt; will be built. Note that this is only done when you’re building your project, not installing it (when you run &lt;code class=&quot;highlighter-rouge&quot;&gt;cmake --build . --target install&lt;/code&gt;). For that, you’ll need to add similar install steps to your build script.&lt;/p&gt;

&lt;h2 id=&quot;find_package&quot;&gt;find_package&lt;/h2&gt;

&lt;p&gt;If your dependency depends on other dependencies and uses &lt;code class=&quot;highlighter-rouge&quot;&gt;find_package&lt;/code&gt; to find them, this can lead to a lot of problems, because in some cases, &lt;code class=&quot;highlighter-rouge&quot;&gt;find_package&lt;/code&gt; tries to find built library files and does it in system directories. If you don’t have this library built or installed system-wide, &lt;code class=&quot;highlighter-rouge&quot;&gt;find_package&lt;/code&gt; will fail, even though you build the dependency of dependency yourself. This issue is still not solved and discussion about it can be found &lt;a href=&quot;https://gitlab.kitware.com/cmake/cmake/-/issues/17735&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;To handle this, make a PR or ask a library maintainer to add an option to skip &lt;code class=&quot;highlighter-rouge&quot;&gt;find_package&lt;/code&gt; call if some option like &lt;code class=&quot;highlighter-rouge&quot;&gt;XXX_FIND_Y&lt;/code&gt; is set to &lt;code class=&quot;highlighter-rouge&quot;&gt;FALSE&lt;/code&gt;. For example, ImGui-SFML will not call &lt;code class=&quot;highlighter-rouge&quot;&gt;find_package(SFML)&lt;/code&gt; if &lt;code class=&quot;highlighter-rouge&quot;&gt;IMGUI_SFML_FIND_SFML&lt;/code&gt; is set to &lt;code class=&quot;highlighter-rouge&quot;&gt;FALSE&lt;/code&gt;. Another way to make your library more friendly is to check if the targets you want to link to are already present, for example:&lt;/p&gt;

&lt;div class=&quot;language-cmake highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;NOT TARGET &amp;lt;target_of_dependency&amp;gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;find_package&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&amp;lt;dependency&amp;gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;endif&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;

...

&lt;span class=&quot;nb&quot;&gt;target_link_libraries&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&amp;lt;target&amp;gt; PUBLIC &amp;lt;target_of_dependency&amp;gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I did this to fix SDL_image not behaving well with its dependency on SDL which can be seen in &lt;a href=&quot;https://github.com/libsdl-org/SDL_image/pull/170&quot;&gt;this PR&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;If you can’t do that for some reason, you’ll have to use &lt;code class=&quot;highlighter-rouge&quot;&gt;ExternalProject&lt;/code&gt;. For example, if libA depends on libB and uses &lt;code class=&quot;highlighter-rouge&quot;&gt;find_package&lt;/code&gt; to find libB, then you need to to build and install &lt;code class=&quot;highlighter-rouge&quot;&gt;libB&lt;/code&gt; first via &lt;code class=&quot;highlighter-rouge&quot;&gt;ExternalProject&lt;/code&gt; and only then build &lt;code class=&quot;highlighter-rouge&quot;&gt;libA&lt;/code&gt;’s so that &lt;code class=&quot;highlighter-rouge&quot;&gt;find_package(libB)&lt;/code&gt; succeeds. This is very complicated, which makes the first solution (modifying the CMakeLists.txt which calls &lt;code class=&quot;highlighter-rouge&quot;&gt;find_package&lt;/code&gt; via any means) much easier in practice.&lt;/p&gt;

&lt;h1 id=&quot;closing-thoughts&quot;&gt;Closing thoughts&lt;/h1&gt;

&lt;p&gt;CMake is quite complex, and I think I only scratched the surface of how to manage a CMake project and its dependencies. However, I hope that you’ve found this article useful and it’ll be a good step to get you started and make your builds easier to manage.&lt;/p&gt;

&lt;p&gt;Here are some recommended CMake resources to help you further:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://crascit.com/professional-cmake/&quot;&gt;Professional CMake: A Practical Guide&lt;/a&gt; by Craig Scott. The best and most up-to-date book about CMake. It will teach you most of the things you’ll ever need from CMake. I use it as a CMake reference all the time.&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://cmake.org/cmake/help/v3.20/guide/tutorial/index.html&quot;&gt;CMake tutorial&lt;/a&gt; and &lt;a href=&quot;https://cmake.org/cmake/help/v3.20/manual/cmake-buildsystem.7.html&quot;&gt;cmake-buildsystem(7)&lt;/a&gt; - nice overview of main CMake things and main CMake concepts in general&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://pabloariasal.github.io/2018/02/19/its-time-to-do-cmake-right/&quot;&gt;“It’s time to do CMake Right”&lt;/a&gt; &lt;a href=&quot;https://web.archive.org/web/20210415182304/https://pabloariasal.github.io/2018/02/19/its-time-to-do-cmake-right/&quot;&gt;(archive)&lt;/a&gt; by Pablo Arias. A fantastic article about writing CMake for libraries meant to be used for other people and easy to include as a dependency in other projects.&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.youtube.com/watch?v=eC9-iRN2b04&quot;&gt;“Using Modern CMake Patterns to Enforce a Good Modular Design”&lt;/a&gt; by Mathieu Ropert. A very nice talk about writing good CMake scripts.&lt;/li&gt;
&lt;/ul&gt;
</content>
 </entry>
 
 <entry>
   <title>Porting my engine from SFML to SDL</title>
   <link href="https://eliasdaler.github.io/porting-to-sdl/"/>
   <updated>2020-05-17T00:00:00+03:00</updated>
   <id>https://eliasdaler.github.io/porting-to-sdl</id>
   <content type="html">&lt;p&gt;Recently I’ve ported my game/engine from SFML to SDL. This was not an easy task
and took me two weeks of hard work (3-4 hours on weekdays, 6-8 hours on
weekends). This article will explain why I did it and which challenges I’ve
faced in the process.&lt;/p&gt;

&lt;p class=&quot;img-desc&quot;&gt;&lt;img src=&quot;/assets/sdl_port_article/title_image.png&quot; alt=&quot;My first game&quot; style=&quot;display:block; margin: 0 auto; width: 720px&quot; /&gt;
My first SFML project&lt;/p&gt;

&lt;!--more--&gt;
&lt;p&gt;&lt;a class=&quot;anchor&quot; id=&quot;read-more&quot;&gt;&lt;/a&gt;&lt;/p&gt;

&lt;h2 id=&quot;intro&quot;&gt;Intro&lt;/h2&gt;

&lt;p class=&quot;img-desc&quot;&gt;&lt;img src=&quot;/assets/sdl_port_article/first_game.png&quot; alt=&quot;My first game&quot; style=&quot;display:block; margin: 0 auto; width: 480px&quot; /&gt;
My first SFML project&lt;/p&gt;

&lt;p&gt;SFML has played a huge part in my life. I’ve started using it 8 years ago (in
2012) and it was then when things finally clicked for me in game programming.&lt;/p&gt;

&lt;p class=&quot;img-desc&quot;&gt;&lt;img src=&quot;/assets/sdl_port_article/re-creation.gif&quot; alt=&quot;Re:creation gameplay&quot; style=&quot;display:block; margin: 0 auto; width: 480px&quot; /&gt;
Re:creation, my second project (unfinished, sadly)&lt;/p&gt;

&lt;p&gt;SFML is a perfect library for a beginner. In one framework you have pretty much everything
to make a simple 2D game: window creation, 2D graphics helpers, TTF rendering,
audio, input, networking and so on. In a few lines of code you can get your
simple prototype running, compared to SDL or GLFW, where you need to do much
more (it was especially true before SDL_Renderer became better and didn’t have
accelerated graphics support). If you’re not planning to make a huge game, but
still don’t want to use an engine, SFML is a solid choice. &lt;a href=&quot;https://www.youtube.com/playlist?list=PLB_ibvUSN7mzUffhiay5g5GUHyJRO4DYr&quot;&gt;These
videos&lt;/a&gt; show
how powerful SFML can be and how fast you can iterate with it.&lt;/p&gt;

&lt;h2 id=&quot;why-port-my-game-to-sdl&quot;&gt;Why port my game to SDL?&lt;/h2&gt;

&lt;p&gt;My main reason for porting to SDL was my engine’s preservation and future. SDL
is a very stable framework and is &lt;a href=&quot;https://en.wikipedia.org/wiki/List_of_games_using_SDL&quot;&gt;widely
used&lt;/a&gt; and supported
(especially by Valve - it’s basically integrated into Steam at this point and
been used as a main tool for porting many games to Linux).&lt;/p&gt;

&lt;p&gt;As I developed my games and engine for yet another year, I’ve realized that my
engine will be with me for a really long time. At the same time, OSes don’t
stand still - they sometimes change their APIs (macOS especially loves to do
this), they introduce new bugs and incompatibilities. SFML was pretty
up-to-date in the 2012-2017, but then I’ve felt that it just couldn’t keep up
with rapidly changing environment. It still supported very old joysticks, for
example, but had some bugs popping up on macOS and its mobile phone support was
not supported well.&lt;/p&gt;

&lt;p&gt;SDL is a widely used framework and it’s a very nice thing - the bugs are
reported faster and get resolved quicker. When you have a lot of games running
on a framework, you don’t want to see it being broken - and so you tend to put
more effort into its support and preservation. This is not the same for SFML -
there are only a couple of commercial games made with it, and most of them are
not made by AAA or even AA studios.&lt;/p&gt;

&lt;p&gt;Another issue with SFML is a crawling speed of its development. There are &lt;a href=&quot;https://en.sfml-dev.org/forums/index.php?board=2.0&quot;&gt;a
lot&lt;/a&gt; of
long-awaited features and bugs to be fixed. This is a direct result of what I’ve
talked in the paragraph above - SFML is mostly a hobbyist library, so there’s
not a lot of developers working on it. Even one full-time developer would have
made a world of difference, but SFML doesn’t have them.&lt;/p&gt;

&lt;p&gt;One example of this is scancodes - I’ve provided &lt;a href=&quot;https://github.com/SFML/SFML/pull/1400&quot;&gt;a PR for Linux
implementation&lt;/a&gt;
two years ago. And even though the code was accepted, the implementation is not
merged into master, because other implementations are still not complete or buggy.&lt;/p&gt;

&lt;p&gt;There’s also a lot of conservatism from some people on SFML team - it’s mostly
justifiable, given that there’s not enough developer time to support all the
extra features and APIs, but at the same time it feels like you don’t have
enough things that could easily be added and be very useful.&lt;/p&gt;

&lt;p&gt;There’s also an “SFML 3” discussion floating around, which is about dropping
C++03 support in SFML and finally starting to use C++11 (and later) features and
making SFML’s API easier and safer to use, and dropping support for a lot of
things at the same time (e.g. the abstraction on threads can be removed, because
we have std::thread now). The discussion has been going around for years, but
there is still no clear sign of when such thing will be finally developed.&lt;/p&gt;

&lt;p&gt;You get the idea. SFML could be much greater than it is now, but basically
nothing has happened with it in the past 5 years, except for implementing some
features which SDL had for a long time.&lt;/p&gt;

&lt;p&gt;I can go on, but here’s a summarization of all the things which made me choose
SDL over SFML:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;SDL has commercial support, which results in bugs being found and resolved
quicker&lt;/li&gt;
  &lt;li&gt;SDL has better portability&lt;/li&gt;
  &lt;li&gt;SDL deals with a lot of OS quirks (down to update versions for Windows, for
example)&lt;/li&gt;
  &lt;li&gt;SFML will probably not get features which will make it superior for modern C++
development soon, so at this point using a C library is as good as using C++03
library for me.&lt;/li&gt;
  &lt;li&gt;SDL has better gamepad support (thanks to its huge &lt;a href=&quot;https://github.com/gabomdq/SDL_GameControllerDB&quot;&gt;controller
DB&lt;/a&gt;).&lt;/li&gt;
  &lt;li&gt;SDL handles multi-display setups better&lt;/li&gt;
  &lt;li&gt;SDL has various features not present in SFML (IO streams abstraction, message
box abstraction, and so on)&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;porting-to-sdl---the-process&quot;&gt;Porting to SDL - the process&lt;/h2&gt;

&lt;p&gt;The porting process was very daunting at first - even though I’ve tried to keep
my SFML-related code separate, parts of it still leaked into higher level
things. I’ve also used a lot of graphical features of SFML, which SDL doesn’t
have in its &lt;code class=&quot;highlighter-rouge&quot;&gt;SDL_Renderer&lt;/code&gt; module to this day or which have entirely different
API from SFML’s.&lt;/p&gt;

&lt;p&gt;One thing that helped me moving quicker is realization that I can replace SFML
code with SDL code without breaking SFML part. Imagine if I just chose to not
link to SFML and start to rewrite all the things module by module - it would
take a lot of time to even get the thing to compile, getting it to run properly
would be even harder.&lt;/p&gt;

&lt;p&gt;I’ve decided to not use &lt;code class=&quot;highlighter-rouge&quot;&gt;SDL_Renderer&lt;/code&gt; or &lt;code class=&quot;highlighter-rouge&quot;&gt;SDL_gpu&lt;/code&gt; for rendering, because I’ve
realized that the porting would be much easier if I could write my own similar
classes for sprites, render textures and other stuff, so that its behaviour is
similar to SFML’s graphical primitives. I’ve chosen to write the whole graphics
part in OpenGL.&lt;/p&gt;

&lt;p class=&quot;img-desc&quot;&gt;&lt;img src=&quot;/assets/sdl_port_article/imgui.png&quot; alt=&quot;ImGui demo window&quot; style=&quot;display:block; margin: 0 auto; width: 480px&quot; /&gt;
Getting ImGui to work with SDL/OpenGL was encouraging&lt;/p&gt;

&lt;p&gt;Before that, the only thing I knew about OpenGL is how to draw a triangle with
it, so it was additional challenge for me, but one that I took with a great
interest, because I wanted to properly learn modern OpenGL for a long time.&lt;/p&gt;

&lt;p&gt;However, this presented new problems - SFML uses legacy OpenGL (its immediate
mode with &lt;code class=&quot;highlighter-rouge&quot;&gt;glBegin&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;glEnd&lt;/code&gt; everywhere), so I couldn’t just follow SFML’s
implementation to get my own version of its graphics API. I’m still glad that I
used so many parts of SFML’s graphics module, though, because a lot of OpenGL
concepts like vertex buffers (&lt;code class=&quot;highlighter-rouge&quot;&gt;sf::VertexBuffer&lt;/code&gt;), frame buffers
(&lt;code class=&quot;highlighter-rouge&quot;&gt;sf::RenderTexture&lt;/code&gt;), shaders (&lt;code class=&quot;highlighter-rouge&quot;&gt;sf::Shader&lt;/code&gt;), viewport matrix (&lt;code class=&quot;highlighter-rouge&quot;&gt;sf::View&lt;/code&gt;) and
other things had abstractions in SFML, so I understood the concepts well.&lt;/p&gt;

&lt;p&gt;A lot of tutorials helped me get used to OpenGL. Here are some of them:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://learnopengl.com&quot;&gt;learnopengl.com&lt;/a&gt;, Joey de Vries tutorials&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.tomdalling.com/blog/category/modern-opengl/&quot;&gt;Tom Dalling’s modern OpenGL
tutorials&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://duriansoftware.com/joe/An-intro-to-modern-OpenGL.-Table-of-Contents.html&quot;&gt;Joe Groff’s OpenGL
articles&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;For the math library, I’ve chosen &lt;a href=&quot;https://glm.g-truc.net/&quot;&gt;glm&lt;/a&gt;, which proved to be amazing and helped
me out with a lot of math stuff (especially matrices and transforms). I’ve
eventually replaced my own vector class with &lt;code class=&quot;highlighter-rouge&quot;&gt;glm::vec2&lt;/code&gt;/&lt;code class=&quot;highlighter-rouge&quot;&gt;glm::ivec2&lt;/code&gt; and
now it’s used consistently through the whole codebase (with SFML I had to
convert to &lt;code class=&quot;highlighter-rouge&quot;&gt;sf::Vector2&amp;lt;T&amp;gt;&lt;/code&gt; back and forth, which was annoying).&lt;/p&gt;

&lt;p&gt;The only huge problem I had with &lt;code class=&quot;highlighter-rouge&quot;&gt;glm&lt;/code&gt; is that it didn’t initialize its vectors
and matrices to zero by default. It wasn’t noticeable at first, but then I’ve
spent a few hours debugging some sprites being missing from time to time…
turns out it was caused by uninitialized &lt;code class=&quot;highlighter-rouge&quot;&gt;glm::vec2&lt;/code&gt;. I turned on
&lt;code class=&quot;highlighter-rouge&quot;&gt;GLM_FORCE_CTOR_INIT&lt;/code&gt; and never looked back (I still try to initialize vectors
explicitly, but sometimes you just forget to do it!).&lt;/p&gt;

&lt;p&gt;As the result, I now have a bunch of classes closely following SFML’s API, but I
could finally change the API to my liking and not implement all the things that
I didn’t like or didn’t use.&lt;/p&gt;

&lt;p&gt;There was another problem - SFML screwed with OpenGL context even if I wasn’t
rendering anything with SFML’s graphics API. For example, creating an instance of
&lt;code class=&quot;highlighter-rouge&quot;&gt;sf::RenderTexture&lt;/code&gt; caused graphical errors and crashes. I didn’t even need to
call &lt;code class=&quot;highlighter-rouge&quot;&gt;sf::RenderTexture::create&lt;/code&gt; for it to happen! But other than that, creating
SFML objects along my own graphics objects didn’t cause any problems, so
good-ol’ &lt;code class=&quot;highlighter-rouge&quot;&gt;ifdef&lt;/code&gt;’s came to the rescue:&lt;/p&gt;

&lt;div class=&quot;language-cpp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;GraphicsComponent&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;...&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
   &lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
   &lt;span class=&quot;n&quot;&gt;sf&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Sprite&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sprite&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
   &lt;span class=&quot;n&quot;&gt;edge&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Sprite&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sprite2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// my verision of sprite&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// somewhere in the rendering system&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;#ifdef USE_SFML
&lt;/span&gt;    &lt;span class=&quot;n&quot;&gt;window&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;draw&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;gc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sprite&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;#else
&lt;/span&gt;    &lt;span class=&quot;n&quot;&gt;window_sdl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;draw&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;gc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sprite2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;#endif
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Why &lt;code class=&quot;highlighter-rouge&quot;&gt;sprite&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;sprite2&lt;/code&gt;, you might ask? Because If I had written something
like this:&lt;/p&gt;

&lt;div class=&quot;language-cpp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;GraphicsComponent&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;...&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
   &lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;#ifdef USE_SFML
&lt;/span&gt;   &lt;span class=&quot;n&quot;&gt;sf&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Sprite&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sprite&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;#else
&lt;/span&gt;   &lt;span class=&quot;n&quot;&gt;Sprite&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sprite&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;#endif
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;… then I’d get a lot of compiler errors in all the systems which used &lt;code class=&quot;highlighter-rouge&quot;&gt;sprite&lt;/code&gt;
in any way, but I chose a more iterative approach - I didn’t allow some
systems/functions to run in SDL mode and got them working properly one by one.&lt;/p&gt;

&lt;p&gt;Another thing that really saved me was making a small project with my engine
before the porting began. This way, it was easier to get things working
iteratively without breaking my main big project. Once I could get all the
graphical things working one by one in this small environments, I could finally
move on to making my game work correctly.&lt;/p&gt;

&lt;p&gt;Porting input was easy - I’m using an abstraction on keyboards and gamepads:
when you press “Z” on the keyboard or “A” on the gamepad, the “PrimaryAction”
event gets sent and the game logic handles it, instead of checking for
keyboard/gamepad state manually. Therefore, all I had to do was to replace the
code which handled framework’s events (&lt;code class=&quot;highlighter-rouge&quot;&gt;sf::Event&lt;/code&gt; to &lt;code class=&quot;highlighter-rouge&quot;&gt;SDL_event&lt;/code&gt;), and it was
all done - no changes to game input logic.&lt;/p&gt;

&lt;p&gt;At this point, my game was up and running. Even if it didn’t have proper shaders
and had some graphical issues, it was fully playable, which was really
satisfying, because it proved to me that my game logic was independent from the
framework it was running on (I didn’t need to change a thing in game logic, in
part because I didn’t export any SFML classes to Lua, so I only had to change
implementation of some C++/Lua bindings like &lt;code class=&quot;highlighter-rouge&quot;&gt;setSpriteColor&lt;/code&gt; or &lt;code class=&quot;highlighter-rouge&quot;&gt;setTexture&lt;/code&gt;)&lt;/p&gt;

&lt;p class=&quot;img-desc&quot;&gt;&lt;img src=&quot;/assets/sdl_port_article/tomb-painter-1.png&quot; alt=&quot;Tomb Painter running&quot; style=&quot;display:block; margin: 0 auto; width: 480px&quot; /&gt;
Tomb Painter running for the first time on SDL. Some animations were broken, no palette
or lighting shaders, but it’s playable!&lt;/p&gt;

&lt;p&gt;The audio proved to be a lot more trickier - I’ve initially just commented out
all audio code until I was done with everything else, but once I needed to port
my audio code I’ve decided to implement some simple Sound and Music class
similar to SFML’s using OpenAL-soft - and &lt;a href=&quot;https://indiegamedev.net/2020/02/15/the-complete-guide-to-openal-with-c-part-1-playing-a-sound/&quot;&gt;these
tutorials&lt;/a&gt;
really helped me out with it.&lt;/p&gt;

&lt;p&gt;Porting level editor was not easy. There were absolutely no problems with Dear
ImGui running on SDL instead of SFML - not much has changed in UI code, except
for me having to make some wrappers around my &lt;code class=&quot;highlighter-rouge&quot;&gt;Sprite&lt;/code&gt; classes to get
&lt;code class=&quot;highlighter-rouge&quot;&gt;ImGui::Image&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;ImGui::ImageButton&lt;/code&gt; to work. However, I used a lot of SFML’s
more complex features for implementing level editor camera and drawing debug
info, so I had to spend a lot of time porting all of that to my own graphics system.&lt;/p&gt;

&lt;p class=&quot;img-desc&quot;&gt;&lt;img src=&quot;/assets/sdl_port_article/editor.png&quot; alt=&quot;Level editor running&quot; style=&quot;display:block; margin: 0 auto; width: 720px&quot; /&gt;
Level editor running&lt;/p&gt;

&lt;h2 id=&quot;results&quot;&gt;Results&lt;/h2&gt;

&lt;p&gt;Here’s the result of my porting efforts:&lt;/p&gt;

&lt;p class=&quot;img-desc&quot;&gt;&lt;img src=&quot;/assets/sdl_port_article/commit.png&quot; alt=&quot;The final commit&quot; style=&quot;display:block; margin: 0 auto; width: 480px&quot; /&gt;
The final commit in porting branch. Game + engine is ~40k loc in total, so I change quite a big
percentage of it.&lt;/p&gt;

&lt;p&gt;10 days have passed since the porting was finished, and so far I didn’t notice
any bugs caused by it. In fact, it was just yesterday that I remembered that I
have ported my game at all to SDL. And it’s a good thing, which makes that the
engine’s base is stronger than ever, but my main development process has not
slowed down a bit.&lt;/p&gt;

&lt;p&gt;SDL with modern OpenGL are pleasant to use, and now as I’m closer to low level, I can
implement things that wouldn’t be as easy to do with just SFML. Let’s see where
it leads me!&lt;/p&gt;

&lt;p&gt;Thanks for reading!&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>LuaVela - the LuaJIT fork I've worked on</title>
   <link href="https://eliasdaler.github.io/luavela/"/>
   <updated>2019-10-15T00:00:00+03:00</updated>
   <id>https://eliasdaler.github.io/luavela</id>
   <content type="html">&lt;p&gt;Recently, IPONWEB open sourced its fork of LuaJIT called
&lt;a href=&quot;https://github.com/iponweb/luavela&quot;&gt;LuaVela&lt;/a&gt;. The original announcement post
can be found &lt;a href=&quot;http://lua-users.org/lists/lua-l/2019-08/msg00041.html&quot;&gt;here&lt;/a&gt;
where a lot of details about it can be found. For those who don’t know - my real
name is Ilya Daylidyonok, and I’m mentioned in the announcement!&lt;/p&gt;

&lt;p&gt;I’ve worked on LuaVela for the last 7 months and now I want to tell about my
experience.&lt;/p&gt;

&lt;!--more--&gt;
&lt;p&gt;&lt;a class=&quot;anchor&quot; id=&quot;read-more&quot;&gt;&lt;/a&gt;&lt;/p&gt;

&lt;h1 id=&quot;intro&quot;&gt;Intro&lt;/h1&gt;

&lt;p&gt;Lua has been dear for me for a long time. It’s an amazing language. It’s easy to
integrate it with C++, it’s fast, and it’s a joy to write code with it.  I’ve
used it in my games and other projects for the last 6 years, so it’s my “mother
tongue” as much as C++ at this point.&lt;/p&gt;

&lt;p&gt;Another thing that makes Lua dear to me is that &lt;a href=&quot;https://eliasdaler.wordpress.com/tag/tutorial/&quot;&gt;the
articles&lt;/a&gt; I’ve written about it
were received very well and this has given me a lot of motivation to write more.
If you Google “Lua C++”, you’ll see my blog somewhere on the first page (maybe
it’ll even be the first result!). That’s how popular the articles have gotten.&lt;/p&gt;

&lt;p&gt;I’ve been fascinated by compilers for a long time, and I’ve always wanted to do
some work in that field. And this became possible when I’ve started working at
IPONWEB.&lt;/p&gt;

&lt;h1 id=&quot;luajits-2gb-problem&quot;&gt;LuaJIT’s 2GB problem&lt;/h1&gt;

&lt;p&gt;You don’t usually stumble upon companies working on their own compilers (or even
forks of them). One of the reasons IPONWEB choose to do so, is that it hit
(in)famous limitation of LuaJIT: its 2GB RAM limit.&lt;/p&gt;

&lt;p&gt;LuaJIT was originally written with 32 bit architecture/pointers in mind. When
you ran it on 64 bit platforms, you had a limitation: you could only adress 1GB
of RAM (because of mmap limitations), so this was LuaJIT’s memory limit. In
newer Linux kernels the limit was raised to 2GB, but it still wasn’t enough for
some projects IPONWEB did. This became a serious problem by 2015. LuaJIT 2.1
wasn’t stable enough for production use at this point, and other possible
solutions to the problem the problem just weren’t good enough. People at IPONWEB
decided to fork LuaJIT.&lt;/p&gt;

&lt;h1 id=&quot;forking-luajit&quot;&gt;Forking LuaJIT&lt;/h1&gt;

&lt;p&gt;Lua community is one of the most segmented communities I’ve ever seen. LuaJIT
can be partially blamed for that. A lot of people stayed somewhere between Lua
5.1 and Lua 5.2 because they used LuaJIT. LuaJIT got huge performance gains
for them, so migrating to Lua 5.2 and Lua 5.3 was not possible.&lt;/p&gt;

&lt;p&gt;LuaJIT also has a lot forks. People add optimizations which work well for them,
but don’t work that well in general case. People fix bugs, which can’t be easily
ported to upstream, because of its cross-platform support and very high
standards to which patches must conform (which are justified!).&lt;/p&gt;

&lt;p&gt;When LuaVela (called uJIT internally until the release) became yet another fork,
people who started it wanted for it to conform to the standard (vanilla) Lua as
much as possible. A lot of tests were added to ensure standard conformance.
LuaVela is a “drop-in” replacement for Lua 5.1 and LuaJIT. It’s likely that if
you replace your Lua/LuaJIT headers in your code, you’ll just get LuaVela to
work with your code and might see performance benifits immediately.&lt;/p&gt;

&lt;p&gt;Another thing that was done early on was dropping cross-platform support. We
used LuaVela for projects which ran on x86-64 Linux only and it was difficult
for our small team to try to support all the other platforms.&lt;/p&gt;

&lt;h1 id=&quot;what-ive-found-interesting-about-luajit&quot;&gt;What I’ve found interesting about LuaJIT&lt;/h1&gt;

&lt;p&gt;During my first days at IPONWEB, I’ve started digging into LuaVela’s and
LuaJIT’s codebase. There is an in-depth
&lt;a href=&quot;http://lua-users.org/lists/lua-l/2009-11/msg00089.html&quot;&gt;e-mail&lt;/a&gt; by Mike Pall
(the author of LuaJIT) which explains some of the stuff about how LuaJIT works
and why it is so fast and good at generating assembly. I’ll go over a few things
I’ve found fascinating about LuaJIT’s implementation.&lt;/p&gt;

&lt;p&gt;First of all, LuaJIT’s interpreter is written in assembly (in
&lt;a href=&quot;https://luajit.org/dynasm.html&quot;&gt;DynASM&lt;/a&gt;, to be precise) and &lt;a href=&quot;http://luajit.org/performance_x86.html&quot;&gt;it can perform
faster&lt;/a&gt; than vanilla Lua 5.1 in 2-4
times. One of the reasons for that are some incredible performance optimizations
that were done in handcrafted assembly to reduce the number of RAM lookups and
stores. A lot of the computations are done using CPU registers - most of the
time you have function’s parameters and local variables stored in CPU registers
and so a lot of computations are done without accessing the RAM. There are also
some optimizations (like expression folding) which are done at script’s initial
convertion to bytecode (when your module is loaded by Lua).&lt;/p&gt;

&lt;p&gt;Another cool thing is that LuaJIT and C share the same stack and LuaJIT honors
C ABI to do function calls. This is one of the reason why Lua/C calls are so
cheap there - they’re almost identical to C function calls.&lt;/p&gt;

&lt;p&gt;LuaJIT’s interpreter is written in DynASM, a higher level assembly, which allows
you to write “macros”, have constants and other things to make your assembly
writing process faster, safer and easier to read. You can find LuaVela’s
improved interpreter
&lt;a href=&quot;https://github.com/iponweb/luavela/blob/master/src/vm_x86.dasc&quot;&gt;here&lt;/a&gt;. A lot
was done to refactor and document &lt;a href=&quot;https://github.com/LuaJIT/LuaJIT/blob/v2.1/src/vm_x86.dasc&quot;&gt;original LuaJIT’s
interpreter&lt;/a&gt;, so I
think that it’s a useful learning resource even if you don’t plan to use LuaVela
in your project.&lt;/p&gt;

&lt;p&gt;When it comes to JIT/compilation part, LuaJIT shines again - it uses a huge
number of optimizations to make generated assembly fast. It generates linear
“traces” - assembly without branches and jumps. The only jumps that are
there are &lt;em&gt;exit conditions&lt;/em&gt;: you compile a trace using some invariants and
assumptions, e.g. that some variable should stay constant or have a certain
type. When this assumption gets broken, you &lt;em&gt;exit&lt;/em&gt; the trace, and either find
another trace or just continue execution in the interpreter.&lt;/p&gt;

&lt;p&gt;All function calls in a trace are inlined - this one also gives a considerable
performance boost. There is also a huge number of “fold” optimizations which
transform things like &lt;code class=&quot;highlighter-rouge&quot;&gt;2 + 2 + x + x&lt;/code&gt; into &lt;code class=&quot;highlighter-rouge&quot;&gt;4 + 2*x&lt;/code&gt; (even function calls,
especially to math functions can be folded sometimes!).&lt;/p&gt;

&lt;p&gt;There are also built-ins like &lt;code class=&quot;highlighter-rouge&quot;&gt;string.find&lt;/code&gt; or &lt;code class=&quot;highlighter-rouge&quot;&gt;math.abs&lt;/code&gt; which are either
written in C/asm, or are written as C functions which tell LuaJIT which IRs to
emit, so you get very efficient assembly as the result of a final trace
generation.&lt;/p&gt;

&lt;p&gt;For example, calling &lt;code class=&quot;highlighter-rouge&quot;&gt;math.abs&lt;/code&gt; essentially turns into few instructions in a
trace. There’s no table lookup into &lt;code class=&quot;highlighter-rouge&quot;&gt;math&lt;/code&gt; table, there’s even no call to C’s
&lt;code class=&quot;highlighter-rouge&quot;&gt;abs&lt;/code&gt; function!&lt;/p&gt;

&lt;p&gt;LuaJIT’s IR is linear: it’s laid out contiguously in memory. It’s one of the
reasons why optimizations and code generation happen quickly and don’t have
noticeable performance overhead in most cases.&lt;/p&gt;

&lt;h1 id=&quot;luavelas-new-features&quot;&gt;LuaVela’s new features&lt;/h1&gt;

&lt;p&gt;What makes LuaVela different from other LuaJIT forks? I’ll quote the &lt;a href=&quot;http://lua-users.org/lists/lua-l/2019-08/msg00041.html&quot;&gt;original
announcement post&lt;/a&gt;:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Full support for 64-bit memory without any tricks or hacks in the
interpreter and JIT compiler;&lt;/li&gt;
  &lt;li&gt;“Sealing”: An ability to hide some data from the garbage collector.
In IPONWEB, we use this generation-like (or, better, Eden-like) trick
to mark data with the same lifetime as the application instance itself
reducing overall pressure on GC;&lt;/li&gt;
  &lt;li&gt;Immutability: Data structures may be (recursively) marked immutable
in run-time. This implemented via an extension API, the syntax of the
language is unaffected;&lt;/li&gt;
  &lt;li&gt;Coroutine timeouts: There are C-level extension APIs that allow to
control the life time of coroutines – once a coroutine runs for too
long, it is terminated by the virtual machine;&lt;/li&gt;
  &lt;li&gt;Some new optimizations in the JIT compiler (but some of them are not
brand new if one compares with LuaJIT 2.1);&lt;/li&gt;
  &lt;li&gt;New C- and Lua-level extension APIs;&lt;/li&gt;
  &lt;li&gt;Platform-level sampling profiler;&lt;/li&gt;
  &lt;li&gt;Memory usage profiler;&lt;/li&gt;
  &lt;li&gt;Platform-level code coverage.&lt;/li&gt;
  &lt;li&gt;CMake is used as a build system for the project;&lt;/li&gt;
  &lt;li&gt;6 test suites are bundled with the project: Lua 5.1 test suite,
LuaJIT test suite, CERN MAD test suite (partially), lua-Harness test
suite and two suites written inside IPONWEB (for testing at Lua- and
C-level, respectively);&lt;/li&gt;
  &lt;li&gt;Documentation bundle is included into the release, too. All the docs
are in the RST format and &lt;code class=&quot;highlighter-rouge&quot;&gt;make docs&lt;/code&gt; will build you the HTML version
if you have Sphinx installed.&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;my-contributions-to-luavela&quot;&gt;My contributions to LuaVela&lt;/h1&gt;

&lt;p&gt;Here’s some of the stuff I did in the 7 months that I’ve worked on LuaVela:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Added &lt;code class=&quot;highlighter-rouge&quot;&gt;ujit.table.size&lt;/code&gt; built-in for counting non-nil elements in a Lua table (both array and hash parts)&lt;/li&gt;
  &lt;li&gt;Created &lt;code class=&quot;highlighter-rouge&quot;&gt;ujit.math&lt;/code&gt; module which is used to test if number is finite, +-ifn or NaN (in &lt;a href=&quot;https://en.wikipedia.org/wiki/IEEE_754-1985&quot;&gt;IEEE-754&lt;/a&gt; terms)&lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Implemented &lt;code class=&quot;highlighter-rouge&quot;&gt;ujit.string.trim&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;ujit.string.split&lt;/code&gt; built-ins - the first one removes whitespace from both ends of the string, and another allows you to iterate over strings like this:&lt;/p&gt;

    &lt;div class=&quot;language-lua highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{}&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;token&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ujit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;split&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;a,b,c&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;,&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;table.insert&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;-- t == { &quot;a&quot;, &quot;b&quot;, &quot;c&quot; }&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;Improved byte code dumping. LuaJIT and LuaVela have “-b” flag used for
printing byte code of a Lua chunk. I’ve figured out that you can actually do
something close to gdb’s &lt;code class=&quot;highlighter-rouge&quot;&gt;disas /s&lt;/code&gt; with it (when source code lines are printed next to corresponding assembly). The resulting flag “-B” does this:&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;img src=&quot;/assets/luavela_post/bytecode.png&quot; alt=&quot;-B flag of LuaVela&quot; style=&quot;display: block;margin: 0 auto; width:480px&quot; /&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Improved testing system and helped make it more consistent across different testing suites.&lt;/li&gt;
  &lt;li&gt;Migrated repo from hg to Git. I used
&lt;a href=&quot;https://github.com/frej/fast-export&quot;&gt;hg-fast-export&lt;/a&gt; for this, but it wasn’t
simple as that. Initially uJIT started inside another repo, and so the history
was full of empty commits when the transfer to another repository happened.
Also “closing branch” commits from hg were adding a lot of noise. I’ve written a Python script which iterated over the entire history and rewrote it while excluding empty commits and saving authorship, time of commit and feature branches from HG repo.&lt;/li&gt;
  &lt;li&gt;Made tons of CMake improvements - the most significant was adding support for
out of source build and testing. Another cool thing was migrating to
&lt;code class=&quot;highlighter-rouge&quot;&gt;ExternalProject&lt;/code&gt; for third party libraries, which made the build process a
lot cleaner. I also introduced some modern CMake practices in our build scripts, which made everyone’s lives a bit easier.&lt;/li&gt;
  &lt;li&gt;Fixed non-conformant code to enable &lt;code class=&quot;highlighter-rouge&quot;&gt;-std=c11&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;-pedantic&lt;/code&gt;. LuaJIT used
something close to GNU 99 standard for everything, but didn’t really specify
the standard. It turned out that GCC is using &lt;code class=&quot;highlighter-rouge&quot;&gt;-std=gnu11&lt;/code&gt; by default since
GCC 5, so we’ve decided to fix all non-conforming code. Some interesting changes:
    &lt;ul&gt;
      &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;-std=gnu11&lt;/code&gt; allows you to forward declare enums, ISO C doesn’t&lt;/li&gt;
      &lt;li&gt;You need to explicitly cast pointers to &lt;code class=&quot;highlighter-rouge&quot;&gt;void*&lt;/code&gt; before printing them with
&lt;code class=&quot;highlighter-rouge&quot;&gt;printf&lt;/code&gt;, e.g.:&lt;/li&gt;
    &lt;/ul&gt;

    &lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;some_type&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ptr&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;some_obj&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;pointer: %p&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ptr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;//                    ^^^^^^^&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;ul&gt;
      &lt;li&gt;Casting a function pointer to &lt;code class=&quot;highlighter-rouge&quot;&gt;void*&lt;/code&gt; is not allowed by C standard, but this is okay to do on Linux, and LuaJIT uses it often for storing callbacks, and dlsym returns void*, so I had to disable -pedantic for lines that do so.&lt;/li&gt;
      &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;##__VA_ARGS__&lt;/code&gt; is not in ISO C, which is painful, because if you have a macro with variadic arguments, you can’t pass “nothing” in such macros&lt;/li&gt;
      &lt;li&gt;enum values must be initialized with integer constant expressions, but
LuaJIT used &lt;code class=&quot;highlighter-rouge&quot;&gt;uint32_t&lt;/code&gt; for &lt;code class=&quot;highlighter-rouge&quot;&gt;x86Op&lt;/code&gt; &lt;code class=&quot;highlighter-rouge&quot;&gt;enum&lt;/code&gt;&lt;/li&gt;
      &lt;li&gt;expressions like these are permitted in GNU C, but not in ISO C:&lt;/li&gt;
    &lt;/ul&gt;

    &lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;g&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;Implemented a process of mirroring patches from internal repo to a public one.
We have some internal docs and other secret stuff in the private repo, so I’ve
made a script which excludes changes to these files&lt;/li&gt;
  &lt;li&gt;I’ve also done a lot of clean up for the code base in general to make
sure that when we open source the project, it looks as good as possible.&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;future&quot;&gt;Future&lt;/h1&gt;

&lt;p&gt;At the moment, the development of LuaVela is finished. We’ll fix critical bugs,
but we felt that LuaVela is close to being feature complete and fast enough for
most of our use cases, so we’ve moved on to other projects.  LuaVela was open
sourced as a “thank you” for Lua and LuaJIT community and developers. I hope
that some of the unique things LuaVela has will be later ported to other active
forks and make the software which uses it even faster and better.&lt;/p&gt;

&lt;p&gt;I’ve enjoyed working on LuaVela: I’ve learned a lot about Lua and JIT
compilation. I’ve also got some real life C programming experience. It was
great.&lt;/p&gt;

&lt;p&gt;Thanks for reading!&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>Tomb Painter. The first dev log (2017-2018)</title>
   <link href="https://eliasdaler.github.io/tomb-painter-first-dev-log/"/>
   <updated>2019-01-06T23:22:00+03:00</updated>
   <id>https://eliasdaler.github.io/tomb-painter-first-dev-log</id>
   <content type="html">
&lt;hr /&gt;

&lt;p&gt;Hello, everyone. Today I’m ready to officially announce and talk about the game I’m currently working on!&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/tomb_painter_first_dev_log/tomb_painter_logo.png&quot; alt=&quot;Tomb Painter logo&quot; style=&quot;display:block; margin: 0 auto&quot; /&gt;&lt;/p&gt;

&lt;p&gt;It’s called Tomb Painter and I’ve been working on it since August of 2017.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/tomb_painter_first_dev_log/characters.png&quot; alt=&quot;Tomb Painter characters&quot; style=&quot;display:block; margin: 0 auto; width: 447px&quot; /&gt;&lt;/p&gt;

&lt;p&gt;In the game, a painter arrives on mysterious island, which has strange things going on with it. Blob-shaped monsters made of paint start to appear from an ancient tomb. The only way to stop this is to paint beautiful patterns which were washed away by a flood that happened some time ago.&lt;/p&gt;

&lt;p&gt;The main mechanic is that you can draw on floors and paint stuff by hitting it with your brush. By painting on the floor, you solve different puzzles.
&lt;img src=&quot;/assets/tomb_painter_first_dev_log/gameplay.gif&quot; alt=&quot;Tomb Painter gameplay&quot; style=&quot;display:block; margin: 0 auto; width: 512px&quot; /&gt;&lt;/p&gt;

&lt;!--more--&gt;
&lt;p&gt;&lt;a class=&quot;anchor&quot; id=&quot;read-more&quot;&gt;&lt;/a&gt;&lt;/p&gt;

&lt;h2 class=&quot;no_toc&quot; id=&quot;table-of-contents&quot;&gt;Table of contents&lt;/h2&gt;

&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#start-of-development&quot; id=&quot;markdown-toc-start-of-development&quot;&gt;Start of development&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#game--engine-separation&quot; id=&quot;markdown-toc-game--engine-separation&quot;&gt;Game / engine separation&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#cmake--fetchcontent--third-party-dependencies&quot; id=&quot;markdown-toc-cmake--fetchcontent--third-party-dependencies&quot;&gt;CMake / FetchContent / Third party dependencies&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#cutscene-system&quot; id=&quot;markdown-toc-cutscene-system&quot;&gt;Cutscene system&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#quest-and-saving-system&quot; id=&quot;markdown-toc-quest-and-saving-system&quot;&gt;Quest and saving system&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#replay-system&quot; id=&quot;markdown-toc-replay-system&quot;&gt;Replay system&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#data--script-separation&quot; id=&quot;markdown-toc-data--script-separation&quot;&gt;Data / script separation&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#other&quot; id=&quot;markdown-toc-other&quot;&gt;Other&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#whats-next&quot; id=&quot;markdown-toc-whats-next&quot;&gt;What’s next?&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;start-of-development&quot;&gt;Start of development&lt;/h2&gt;

&lt;p&gt;I’ve started to work on this game, because developing &lt;a href=&quot;https://eliasdaler.github.io/re-creation/&quot;&gt;Re:creation&lt;/a&gt; became too hard for me. It had gigantic scope and pretty detailed art, which took a long time to produce, so I’ve decided to make something simpler as my first game.&lt;/p&gt;

&lt;p&gt;It all started with this prototype art, which was highly inspired by &lt;a href=&quot;http://minitgame.com/&quot;&gt;Minit&lt;/a&gt;:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/tomb_painter_first_dev_log/tomb_painter_first_prototype.png&quot; alt=&quot;Tomb Painter first prototype&quot; style=&quot;display:block; margin: 0 auto; width: 480px&quot; /&gt;&lt;/p&gt;

&lt;p&gt;I was pretty surprised that so much can be accomplished with only two colors, but I wanted a bit more detail, so I’ve decided to use 4 colors, just like Game Boy did:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/tomb_painter_first_dev_log/tomb_painter_early.png&quot; alt=&quot;Tomb Painter early prototype&quot; style=&quot;display:block; margin: 0 auto; width: 480px&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/tomb_painter_first_dev_log/early_gameplay.gif&quot; alt=&quot;Tomb Painter early prototype&quot; style=&quot;display:block; margin: 0 auto; width: 480px&quot; /&gt;&lt;/p&gt;

&lt;p&gt;The game’s internal resolution is 160x144 pixels, same as Game Boy again. I’ve decided not to follow all limitations of Game Boy, as it would be pretty hard to make a good looking game with them, but still, 4 colors and 160x144 is pretty limiting, while it can also look good. It also takes a lot less time to produce art.&lt;/p&gt;

&lt;p&gt;I’ve also experimented with adding a second palette (just like Super Game Boy on SNES did) and it looked pretty interesting:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/tomb_painter_first_dev_log/early_gameplay2.gif&quot; alty=&quot;Tomb Painter early prototype&quot; style=&quot;display:block; margin: 0 auto; width: 480px&quot; /&gt;&lt;/p&gt;

&lt;p&gt;You can also see first painting system which was improved later.&lt;/p&gt;

&lt;p&gt;So now I have two palettes with 4 colors each. The game is rendered in shades of grey and I can easily map each shade to whatever color I want to get different palettes, including the original Game Boy one:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/tomb_painter_first_dev_log/gameboy.png&quot; alt=&quot;Tomb Painter characters&quot; style=&quot;display:block; margin: 0 auto; width: 447px&quot; /&gt;&lt;/p&gt;

&lt;p&gt;I also made some simple shaders for fade in and fade out:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/tomb_painter_first_dev_log/fadein_fadeout.gif&quot; alt=&quot;Tomb Painter fade in / fade out effects&quot; style=&quot;display:block; margin: 0 auto; width: 480px&quot; /&gt;&lt;/p&gt;

&lt;p&gt;and for lighting simulation:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/tomb_painter_first_dev_log/light.gif&quot; alt=&quot;Tomb Painter lighting&quot; style=&quot;display:block; margin: 0 auto; width: 480px&quot; /&gt;&lt;/p&gt;

&lt;p&gt;It’s still 4 colors, but it looks pretty nice.&lt;/p&gt;

&lt;p&gt;A lot of time was spent on making paint look and feel good. Note that the tiles of paint change depending on direction you’re painting in, so it looks like a continuous trail, and you can also have multiples layer of paint. The paint also changes the color of what’s below it and that was pretty interesting to implement too. I may write about all that shader magic in the future.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/tomb_painter_first_dev_log/painting.gif&quot; alt=&quot;Tomb Painter painting system&quot; style=&quot;display:block; margin: 0 auto; width: 480px&quot; /&gt;&lt;/p&gt;

&lt;p&gt;As for more technical details: I’ve used Re:creation’s engine and started to modify it as I needed. I had working prototype of Tomb Painter in two weeks and it felt good to not start from scratch. All the abstractions and worries about design were worth it!&lt;/p&gt;

&lt;p&gt;I’ve improved the engine quite a lot and if I start to go over it all in detail, so I’ll make a short summary here, and if you want to have it explained in depth, ask about stuff you want to be covered in comments!&lt;/p&gt;

&lt;h2 id=&quot;game--engine-separation&quot;&gt;Game / engine separation&lt;/h2&gt;

&lt;p&gt;Right now I’m still working on better game / engine separation, but basically the engine is now a statically linked library. I’ve decided to call the engine &lt;strong&gt;EDGE&lt;/strong&gt; (Elias Daler’s Game Engine). The “game” part is just several .cpp files and mostly just Lua code, because I prefer to code game logic in it. Once I feel that engine is decoupled enough and I have some time to make a simple game with it, I plan to open source the engine part!&lt;/p&gt;

&lt;h2 id=&quot;cmake--fetchcontent--third-party-dependencies&quot;&gt;CMake / FetchContent / Third party dependencies&lt;/h2&gt;

&lt;p&gt;I’ve learned a lot about CMake (thanks to &lt;a href=&quot;https://crascit.com/professional-cmake/&quot;&gt;Professional CMake book&lt;/a&gt;) and finally achieved a perfect setup for me. I’ve managed to get all third party dependencies (9 of them) to be fetched at configure time. Then, I build all the dependencies and my game. It works perfectly - it’s easy to start with a clean folder and just build everything!
It’s also very easy to update to new versions of the libraries, here’s the only thing I need to do:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/tomb_painter_first_dev_log/changing_lib_versions.png&quot; alt=&quot;Changing lib versions&quot; style=&quot;display:block; margin: 0 auto; width: 360px&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;cutscene-system&quot;&gt;Cutscene system&lt;/h2&gt;

&lt;p&gt;I’ve written an article about how I write cutscenes with coroutines &lt;a href=&quot;https://eliasdaler.github.io/how-to-implement-action-sequences-and-cutscenes/&quot;&gt;here&lt;/a&gt;. It’s pretty great! A lot of code was simplified and now I can easily write complex action sequences, multi-branch cutscenes and dialogue trees with it. So, with the code like this:&lt;/p&gt;

&lt;div class=&quot;language-lua highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;answer&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;girl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;say&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'do_you_love_lua'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                          &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'YES'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'NO'&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;})&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;answer&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'YES'&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;girl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;setMood&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'happy'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;girl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;say&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'happy_response'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;girl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;setMood&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'angry'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;girl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;say&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'angry_response'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I get this:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/tomb_painter_first_dev_log/dialogue.gif&quot; alt=&quot;Replay system&quot; style=&quot;display:block; margin: 0 auto; width: 447px&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;quest-and-saving-system&quot;&gt;Quest and saving system&lt;/h2&gt;

&lt;p&gt;It’s now possible to have a main quest line in the game, but also side quests with multiple states which are easy to write, modify and read.&lt;/p&gt;

&lt;p&gt;Previously, Re:creation had a very simple save system which saved your inventory, main quest progression, etc. But I’ve decided that I needed something more complex for Tomb Painter, to store consequences of NPC interactions or side quest progression. The current system tracks game’s state in real time and saves all important stuff in a Lua table once it happens (by catching events). Then, when you save, this table is just converted to JSON and saved to a file. Pretty awesome!&lt;/p&gt;

&lt;h2 id=&quot;replay-system&quot;&gt;Replay system&lt;/h2&gt;

&lt;p&gt;I’ve also implemented a replay system which lets me record all input and then replay it in any speed I want. I can record minutes of gameplay and then run it very fast! I can also use it to quickly repeat some tasks (e.g. kill two enemies than go to room X) and then continue playing the game. Here’s how all this looks in action:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/tomb_painter_first_dev_log/replay.gif&quot; alt=&quot;Replay system&quot; style=&quot;display:block; margin: 0 auto; width: 447px&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;data--script-separation&quot;&gt;Data / script separation&lt;/h2&gt;

&lt;p&gt;Previously, I’ve stored all information about prefabs in Lua scripts. But then I’ve decided that they’d look better in JSON and it’ll be much easier to write a GUI tool for modifying prefabs in the future. Here’s an example of how prefab looks:&lt;/p&gt;

&lt;div class=&quot;language-json highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nl&quot;&gt;&quot;slime&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;ai&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;type&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;chaser&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;viewRadius&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;60&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;viewAngle&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;90&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;animation&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;collision&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;boundingBox&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;6&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;damage&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;amount&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;type&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;physical&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;graphics&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;spriteOrigin&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;overlays&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
            &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;paint&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;slime_overlay&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;health&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;maxHealth&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;movement&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;moveSpeed&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;15.0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;15.0&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;mass&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;0.5&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;sound&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;sounds&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
            &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;hit&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;file&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;enemy_hit&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
            &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;die&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;file&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;enemy_die&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;stateMachine&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;main&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
            &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;initialState&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;IdleState&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
            &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;transitionTable&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;hero&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;ai&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
            &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;initialState&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;AIPatrolState&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
            &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;transitionTable&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;ai_slime&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;As you can see, it’s easy to read. Transition tables are still written in Lua, because they usually have conditions inside of them and they look like this:&lt;/p&gt;

&lt;div class=&quot;language-lua highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;IdleState&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;update&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;entity&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;entity&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;getVelocity&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;():&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;isZero&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;MoveState&quot;&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;MoveState&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;update&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;entity&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;entity&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;getVelocity&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;():&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;isZero&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;IdleState&quot;&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;DyingState&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;EventType&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;AnimationFinished&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;callback&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;entity&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;event&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;event&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;animationName&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;dying&quot;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then&lt;/span&gt;
                    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;DiedState&quot;&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Update fuction can either call &lt;code class=&quot;highlighter-rouge&quot;&gt;setState&lt;/code&gt; explicitly, or just return a name of the state to transition into. Another way to transition is by catching the event. So, if entity is in &lt;code class=&quot;highlighter-rouge&quot;&gt;DyingState&lt;/code&gt; and it catches &lt;code class=&quot;highlighter-rouge&quot;&gt;AnimationFinished&lt;/code&gt; event, the callback is called where it can then transition into another state.&lt;/p&gt;

&lt;h2 id=&quot;other&quot;&gt;Other&lt;/h2&gt;

&lt;p&gt;All GUI widgets are now entities, which is very useful as they can be manipulated as normal game objects and I don’t have any repeating rendering/movement code.&lt;/p&gt;

&lt;p&gt;Also, I’ve worked a lot on resource and entity prefab management. Now, entity prefabs are ref counted and if entity prefab is unused on another level, it’s unloaded with all resources which it was using (unless other prefabs use it too). The system is very complex to explain in a few paragraphs and I might write an article about it later.&lt;/p&gt;

&lt;p&gt;And there was a lot of refactoring, of course. All the code is now in its best condition ever.&lt;/p&gt;

&lt;h2 id=&quot;whats-next&quot;&gt;What’s next?&lt;/h2&gt;

&lt;p&gt;&lt;img src=&quot;/assets/tomb_painter_first_dev_log/shadows.png&quot; alt=&quot;Tomb Painter painting system&quot; style=&quot;display:block; margin: 0 auto; width: 480px&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Right now, my next goal is making game look even prettier shadows (see the screenshot above), animated tiles, a new level, the first boss and the first awesome mini-game. Overall, the progress looks very good and I’m very happy with my engine and I can’t wait to start working on the game again. I’ll also have a lot more time to work on the game (find out why in the next post!), so it’s going to be awesome.&lt;/p&gt;

&lt;p&gt;See you soon! Thanks for reading.&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>How to implement action sequences and cutscenes</title>
   <link href="https://eliasdaler.github.io/how-to-implement-action-sequences-and-cutscenes/"/>
   <updated>2018-10-03T21:00:00+03:00</updated>
   <id>https://eliasdaler.github.io/how-to-implement-action-sequences-and-cutscenes</id>
   <content type="html">
&lt;hr /&gt;

&lt;h2 id=&quot;introduction&quot;&gt;Introduction&lt;/h2&gt;

&lt;p&gt;&lt;a href=&quot;https://habr.com/post/427135/&quot;&gt;Russian translation&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This post will show ways of implementing actions sequences and cutscenes in video games. The code is written in Lua, but the patterns can be implemented with other languages (except the coroutine approach, because not all languages have coroutines).&lt;/p&gt;

&lt;p&gt;Action sequences frequently appear in games. In cutscenes, for example: a character approaches an enemy, says something, the enemy responds and so on. But action sequences often appear in gameplay as well. Take a look at this gif for example:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/cutscene_article/going_into_bar.gif&quot; alt=&quot;Sample cutscene&quot; style=&quot;display:block; margin: 0 auto; width: 480px&quot; /&gt;&lt;/p&gt;

&lt;!--more--&gt;
&lt;p&gt;&lt;a class=&quot;anchor&quot; id=&quot;read-more&quot;&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;We see the following sequence of actions:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;The door is opened&lt;/li&gt;
  &lt;li&gt;The player goes inside the house&lt;/li&gt;
  &lt;li&gt;The door closes&lt;/li&gt;
  &lt;li&gt;The screen fades out&lt;/li&gt;
  &lt;li&gt;Level changes&lt;/li&gt;
  &lt;li&gt;The screen fades in&lt;/li&gt;
  &lt;li&gt;The player enters the building&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;Action sequences can be used when scripting NPC behavior and boss fights. For example, you can have a boss throw something at you, then laugh, then shook its fist in your direction. But implementing such things is not an easy task…&lt;/p&gt;

&lt;h2 class=&quot;no_toc&quot; id=&quot;table-of-contents&quot;&gt;Table of contents&lt;/h2&gt;

&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#introduction&quot; id=&quot;markdown-toc-introduction&quot;&gt;Introduction&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#the-problem&quot; id=&quot;markdown-toc-the-problem&quot;&gt;The problem&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#booleans-enums-state-machines&quot; id=&quot;markdown-toc-booleans-enums-state-machines&quot;&gt;Booleans, enums, state machines&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#action-lists&quot; id=&quot;markdown-toc-action-lists&quot;&gt;Action lists&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#coroutines&quot; id=&quot;markdown-toc-coroutines&quot;&gt;Coroutines&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#coroutines-basics&quot; id=&quot;markdown-toc-coroutines-basics&quot;&gt;Coroutines basics&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#implementing-cutscenes-with-coroutines&quot; id=&quot;markdown-toc-implementing-cutscenes-with-coroutines&quot;&gt;Implementing cutscenes with coroutines&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#advanced-usage&quot; id=&quot;markdown-toc-advanced-usage&quot;&gt;Advanced usage&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#pros-and-cons-of-coroutines&quot; id=&quot;markdown-toc-pros-and-cons-of-coroutines&quot;&gt;Pros and cons of coroutines&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#conclusion&quot; id=&quot;markdown-toc-conclusion&quot;&gt;Conclusion&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;the-problem&quot;&gt;The problem&lt;/h2&gt;

&lt;p&gt;Unfortunately, standard game loop doesn’t make it easy for us. Suppose we have this game loop:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/cutscene_article/game_loop.png&quot; alt=&quot;Dialogue&quot; style=&quot;display:block; margin: 0 auto; width: 256px&quot; /&gt;&lt;/p&gt;

&lt;div class=&quot;language-lua highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;game&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;isRunning&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;processInput&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;dt&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;clock&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;delta&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;update&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;render&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Now, suppose you want to implement the following cutscene: a player goes to an NPC, and the NPC says “You did it!”, and then after short delay it says “Thank you!”. In ideal world, we’d want to write it like this:&lt;/p&gt;

&lt;div class=&quot;language-lua highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;player&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;goTo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;npc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;npc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;say&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;You did it!&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;delay&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;npc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;say&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Thank you&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And that’s when we hit the first roadblock. All these actions take some time to complete. Some might even require user input - for example, to close a dialogue window before the cutscene can proceed further. As for &lt;code class=&quot;highlighter-rouge&quot;&gt;delay&lt;/code&gt;, you can’t just call &lt;code class=&quot;highlighter-rouge&quot;&gt;sleep&lt;/code&gt; function there, because the game will freeze. It won’t be updated and will be stuck in one iteration of the game loop.&lt;/p&gt;

&lt;p&gt;Let’s take a look at some of the possible solutions to the problem.&lt;/p&gt;

&lt;h2 id=&quot;booleans-enums-state-machines&quot;&gt;Booleans, enums, state machines&lt;/h2&gt;

&lt;p&gt;The most obvious and brute-force way to implement action sequence is to store the information about its state in booleans, strings or enums. The code will look something like this:&lt;/p&gt;

&lt;div class=&quot;language-lua highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;update&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cutsceneState&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'playerGoingToNpc'&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;player&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;continueGoingTo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;npc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;player&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;closeTo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;npc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;cutsceneState&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'npcSayingYouDidIt'&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;dialogueWindow&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;show&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;You did it!&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;elseif&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cutsceneState&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'npcSayingYouDidIt'&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dialogueWindow&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;wasClosed&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;cutsceneState&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'delay'&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;elseif&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;...&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;-- so on...&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This approach can easily lead to spaghetti code and long if-else chains, so I’d recommend to avoid it.&lt;/p&gt;

&lt;h2 id=&quot;action-lists&quot;&gt;Action lists&lt;/h2&gt;

&lt;p&gt;Action lists are similar to state machines. Action list is a list of actions which are executed sequentially. You can think of an action as a state in state machine. We update the current action in every iteration of game loop. If we see that the action has finished, we move on to the next one.&lt;/p&gt;

&lt;p&gt;In our example, we can implement the following actions: &lt;code class=&quot;highlighter-rouge&quot;&gt;GoToAction&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;DialogueAction&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;DelayAction&lt;/code&gt;. Let’s look at the implementation of &lt;code class=&quot;highlighter-rouge&quot;&gt;DelayAction&lt;/code&gt;.&lt;/p&gt;

&lt;p class=&quot;message&quot;&gt;For examples I’ll use &lt;i class=&quot;fa fa-github&quot;&gt;&lt;/i&gt; &lt;a href=&quot;https://github.com/kikito/middleclass&quot;&gt;middleclass&lt;/a&gt; library for OOP.&lt;/p&gt;

&lt;div class=&quot;language-lua highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;-- constructor&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;DelayAction&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;initialize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;params&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;delay&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;params&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;delay&lt;/span&gt;

  &lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;currentTime&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;isFinished&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;false&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;DelayAction&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;update&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;currentTime&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;currentTime&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dt&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;currentTime&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;delay&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;isFinished&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;ActionList&lt;/code&gt;’s &lt;code class=&quot;highlighter-rouge&quot;&gt;update&lt;/code&gt; function looks like this:&lt;/p&gt;

&lt;div class=&quot;language-lua highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;ActionList&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;update&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;isFinished&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;currentAction&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;update&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;currentAction&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;isFinished&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;goToNextAction&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;currentAction&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;isFinished&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And finally, our cutscene looks like this:&lt;/p&gt;

&lt;div class=&quot;language-lua highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;makeCutsceneActionList&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;player&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;npc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ActionList&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;GoToAction&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;entity&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;player&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;target&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;npc&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;SayAction&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;entity&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;npc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;text&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;You did it!&quot;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;DelayAction&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;delay&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;SayAction&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;entity&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;npc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;text&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Thank you&quot;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;-- ... and then somewhere in update:&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;actionList&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;update&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p class=&quot;message&quot;&gt;In Lua &lt;code&gt;someFunction({ ... })&lt;/code&gt; can be written as &lt;code&gt;someFunction{...}&lt;/code&gt;, that’s why instead of writing &lt;code&gt;DelayAction:new({delay = 0.5})&lt;/code&gt; we can write &lt;code&gt;DelayAction:new{ delay = 0.5 }&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;This looks much better. We now have a clear sequence of actions. If we want to insert new action in a cutscene, we can easily do so. And we can reuse common actions in lots of action sequences.&lt;/p&gt;

&lt;p&gt;See this presentation by Sean Middleditch for more details and trickier usages of action lists:&lt;/p&gt;

&lt;div class=&quot;videoWrapper&quot;&gt;
  &lt;iframe width=&quot;496&quot; height=&quot;372&quot; src=&quot;https://www.youtube.com/embed/o6CaB-hmqoE&quot; frameborder=&quot;0&quot; allow=&quot;autoplay; encrypted-media&quot; allowfullscreen=&quot;&quot;&gt;&lt;/iframe&gt;
&lt;/div&gt;

&lt;p&gt;Action lists are very useful. I’ve used them for several years before discovering coroutine approach and was very happy. But then I wanted to make more complex cutscenes like this:&lt;/p&gt;

&lt;div class=&quot;language-lua highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;cutscene&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;player&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;npc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;player&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;goTo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;npc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;player&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;hasCompleted&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;quest&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;npc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;say&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;You did it!&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;delay&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;npc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;say&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Thank you&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;npc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;say&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Please help me&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;With action lists you’ll need non-linear lists to make this happen. This can be accomplished by actions having tags. Then, you’ll be able to jump to a tagged action instead of the next one. This works, but it is not as readable as the function above.&lt;/p&gt;

&lt;p&gt;We can make this code real with coroutines.&lt;/p&gt;

&lt;h2 id=&quot;coroutines&quot;&gt;Coroutines&lt;/h2&gt;

&lt;h3 id=&quot;coroutines-basics&quot;&gt;Coroutines basics&lt;/h3&gt;

&lt;p&gt;Coroutine is a function which can be “paused” and “resumed”. It is executed in &lt;strong&gt;the same thread&lt;/strong&gt; as your main program. No new threads are created for it.&lt;/p&gt;

&lt;p&gt;Coroutines can be paused with &lt;code class=&quot;highlighter-rouge&quot;&gt;coroutine.yield&lt;/code&gt; and resumed with &lt;code class=&quot;highlighter-rouge&quot;&gt;coroutine.resume&lt;/code&gt;. Here’s a simple example:&lt;/p&gt;

&lt;div class=&quot;language-lua highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;hello&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;coroutine.yield&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;world!&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;c&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;coroutine.create&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;coroutine.resume&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;uhh...&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;coroutine.resume&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The output is:&lt;/p&gt;

&lt;p class=&quot;console-output&quot;&gt;hello
uhh…
world&lt;/p&gt;

&lt;p&gt;First we create a coroutine with &lt;code class=&quot;highlighter-rouge&quot;&gt;coroutine.create&lt;/code&gt;. Coroutine doesn’t start to execute after it’s created. It needs to be launched by &lt;code class=&quot;highlighter-rouge&quot;&gt;coroutine.resume&lt;/code&gt;. &lt;code class=&quot;highlighter-rouge&quot;&gt;f&lt;/code&gt; function is called then, it prints “hello” and then pauses itself by yielding. You can think of it as a form of &lt;code class=&quot;highlighter-rouge&quot;&gt;return&lt;/code&gt;, but we can still resume the function afterwards by calling &lt;code class=&quot;highlighter-rouge&quot;&gt;coroutine.resume&lt;/code&gt; if coroutine hasn’t finished its function.&lt;/p&gt;

&lt;p&gt;If you pass arguments when calling &lt;code class=&quot;highlighter-rouge&quot;&gt;coroutine.yield&lt;/code&gt;, they’re returned by &lt;code class=&quot;highlighter-rouge&quot;&gt;coroutine.resume&lt;/code&gt; in the “main thread”. For example:&lt;/p&gt;

&lt;div class=&quot;language-lua highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;coroutine.yield&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;42&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;some text&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;ok&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;num&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;text&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;coroutine.resume&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;num&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;text&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;-- will print '42    &quot;some text&quot;'&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Here, &lt;code class=&quot;highlighter-rouge&quot;&gt;ok&lt;/code&gt; is a bool, which shows the status of coroutine. If &lt;code class=&quot;highlighter-rouge&quot;&gt;ok&lt;/code&gt; is &lt;code class=&quot;highlighter-rouge&quot;&gt;true&lt;/code&gt; then everything is okay and next returned values are arguments of the last &lt;code class=&quot;highlighter-rouge&quot;&gt;coroutine.yield&lt;/code&gt; call. However, if &lt;code class=&quot;highlighter-rouge&quot;&gt;f&lt;/code&gt; calls &lt;code class=&quot;highlighter-rouge&quot;&gt;error&lt;/code&gt; function or fails at some point, the first value will be &lt;code class=&quot;highlighter-rouge&quot;&gt;false&lt;/code&gt; and the error message will be the second return of the function. Let’s see a failing coroutine:&lt;/p&gt;

&lt;div class=&quot;language-lua highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;notDefined&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;coroutine.create&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;ok&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;msg&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;coroutine.resume&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ok&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Coroutine failed!&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;msg&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Output:&lt;/p&gt;
&lt;p class=&quot;console-output&quot;&gt;Coroutine failed!    input:4: attempt to perform arithmetic on a nil value (global ‘notDefined’)&lt;/p&gt;

&lt;p&gt;Similarly, you can pass values to a coroutine when calling &lt;code class=&quot;highlighter-rouge&quot;&gt;coroutine.resume&lt;/code&gt; and the results will be returned by &lt;code class=&quot;highlighter-rouge&quot;&gt;coroutine.yield&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;language-lua highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;someNum&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;coroutine.yield&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;someNum&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;-- will print &quot;42&quot;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;coroutine.resume&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;42&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Coroutine can be in different states which you can check by calling &lt;code class=&quot;highlighter-rouge&quot;&gt;coroutine.status&lt;/code&gt;:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;&quot;running&quot;&lt;/code&gt; - coroutine is currently running. This means that &lt;code class=&quot;highlighter-rouge&quot;&gt;coroutine.status&lt;/code&gt; was launched from inside the coroutine’s function.&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;&quot;suspended&quot;&lt;/code&gt; - coroutine was paused or hasn’t been launched yet.&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;&quot;normal&quot;&lt;/code&gt; - coroutine is active, but isn’t currently running (it has resumed another coroutine).&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;&quot;dead&quot;&lt;/code&gt; - the coroutine has finished running - function has finished its execution.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Now, let’s implement coroutine-based action sequence system with this knowledge.&lt;/p&gt;

&lt;h3 id=&quot;implementing-cutscenes-with-coroutines&quot;&gt;Implementing cutscenes with coroutines&lt;/h3&gt;

&lt;p&gt;Here’s how our basic action will look like:&lt;/p&gt;

&lt;div class=&quot;language-lua highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Action&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;launch&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;init&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;

  &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;finished&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dt&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;coroutine.yield&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;-- the most important part&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;update&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

  &lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;exit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This is similar to what we have with action lists: the action calls &lt;code class=&quot;highlighter-rouge&quot;&gt;update&lt;/code&gt; function until it’s finished. But it yields on each game loop iteration (&lt;code class=&quot;highlighter-rouge&quot;&gt;Action:launch&lt;/code&gt; is called from some coroutine), while somewhere in our main &lt;code class=&quot;highlighter-rouge&quot;&gt;update&lt;/code&gt; (for example, in some &lt;code class=&quot;highlighter-rouge&quot;&gt;ActionSequenceManager&lt;/code&gt; which tracks the state of all action sequences) we resume it like this:&lt;/p&gt;

&lt;div class=&quot;language-lua highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;coroutine.resume&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;-- note that we pass dt here&lt;/span&gt;
                        &lt;span class=&quot;c1&quot;&gt;-- which is later used in actions's update&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Our cutscene is a coroutine now:&lt;/p&gt;

&lt;div class=&quot;language-lua highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;cutscene&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;player&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;npc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;player&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;goTo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;npc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;npc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;say&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;You did it!&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;delay&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;npc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;say&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Thank you&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;-- later...&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;c&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;coroutine.create&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cutscene&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;player&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;npc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;coroutine.resume&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Here’s how &lt;code class=&quot;highlighter-rouge&quot;&gt;delay&lt;/code&gt; is implemented:&lt;/p&gt;

&lt;div class=&quot;language-lua highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;delay&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;time&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;action&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;DelayAction&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;delay&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;time&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;action&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;launch&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Having such wrapper functions is very useful to make your cutscenes easier to read and use. Next, let’s see how &lt;code class=&quot;highlighter-rouge&quot;&gt;DelayAction&lt;/code&gt; is implemented:&lt;/p&gt;

&lt;div class=&quot;language-lua highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;-- Action is a base class of DelayAction&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;DelayAction&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;DelayAction&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Action&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;DelayAction&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;initialize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;params&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;delay&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;params&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;delay&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;currentTime&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;isFinished&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;false&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;DelayAction&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;update&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;currentTime&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;currentTime&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dt&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;currentTime&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;delayTime&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;finished&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This is identical to action lists approach! Let’s take a look at &lt;code class=&quot;highlighter-rouge&quot;&gt;Action&lt;/code&gt;’s &lt;code class=&quot;highlighter-rouge&quot;&gt;launch&lt;/code&gt; function again to understand how it works:&lt;/p&gt;

&lt;div class=&quot;language-lua highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Action&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;launch&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;init&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;

  &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;finished&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dt&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;coroutine.yield&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;-- the most important part&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;update&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

  &lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;exit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;As you can see, we can create &lt;code class=&quot;highlighter-rouge&quot;&gt;init&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;exit&lt;/code&gt; functions to do something when action begins and ends. But the most important part is the &lt;code class=&quot;highlighter-rouge&quot;&gt;while&lt;/code&gt; loop which executes until the action is finished. Here’s a visualization of the order of execution which makes it easier to understand:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/cutscene_article/coroutine_game_loop.png&quot; alt=&quot;Dialogue&quot; style=&quot;display:block; margin: 0 auto; width: 480px&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Now, let’s see how we can implement &lt;code class=&quot;highlighter-rouge&quot;&gt;goTo&lt;/code&gt; function:&lt;/p&gt;

&lt;div class=&quot;language-lua highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Entity&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;goTo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;target&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;action&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;GoToAction&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;entity&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;target&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;target&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;action&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;launch&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;-- constructor is ommited&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;GoToAction&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;update&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;entity&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;closeTo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;target&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then&lt;/span&gt;
      &lt;span class=&quot;o&quot;&gt;...&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;-- perform AI movement logic here&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;finished&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It’s very easy to implement new types of actions.&lt;/p&gt;

&lt;p&gt;Now, let’s see how we can use coroutines with events. Let’s implement &lt;code class=&quot;highlighter-rouge&quot;&gt;WaitForEventAction&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;language-lua highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;WaitForEventAction&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;initialize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;params&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;finished&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;false&lt;/span&gt;

  &lt;span class=&quot;n&quot;&gt;eventManager&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;subscribe&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;listener&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;eventType&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;params&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;eventType&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;callback&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;WaitForEventAction&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;onEvent&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;WaitForEventAction&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;onEvent&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;event&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;finished&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We can leave the &lt;code class=&quot;highlighter-rouge&quot;&gt;update&lt;/code&gt; function empty for that one. This action will execute until an event of &lt;code class=&quot;highlighter-rouge&quot;&gt;eventType&lt;/code&gt; is sent. As a practical example of &lt;code class=&quot;highlighter-rouge&quot;&gt;WaitForEventAction&lt;/code&gt; usage, let’s implement &lt;code class=&quot;highlighter-rouge&quot;&gt;say&lt;/code&gt; function:&lt;/p&gt;

&lt;div class=&quot;language-lua highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Entity&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;say&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;text&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;DialogueWindow&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;show&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;text&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;action&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;WaitForEventAction&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;eventType&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'DialogueWindowClosed'&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;action&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;launch&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Nice and easy. Now, when dialogue window is closed by the player by the press of the button, it will send &lt;code class=&quot;highlighter-rouge&quot;&gt;DialogueWindowClosed&lt;/code&gt; event. The action will finish and the next one will start.&lt;/p&gt;

&lt;p&gt;It’s easy to implement non-linear cutscenes, which depend on player’s choice, for example:&lt;/p&gt;

&lt;div class=&quot;language-lua highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;answer&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;girl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;say&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'do_you_love_lua'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                          &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'YES'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'NO'&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;})&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;answer&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'YES'&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;girl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;setMood&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'happy'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;girl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;say&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'happy_response'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;girl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;setMood&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'angry'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;girl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;say&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'angry_response'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;/assets/cutscene_article/dialogue.gif&quot; alt=&quot;Dialogue&quot; style=&quot;display:block; margin: 0 auto; width: 480px&quot; /&gt;&lt;/p&gt;

&lt;p&gt;The implementation of &lt;code class=&quot;highlighter-rouge&quot;&gt;say&lt;/code&gt; function is trickier there, because now you need to somehow return player’s dialogue choice, but it’s not that hard to implement. As you can see, we don’t need to implement special mechanisms for if-else statements and loops.&lt;/p&gt;

&lt;h3 id=&quot;advanced-usage&quot;&gt;Advanced usage&lt;/h3&gt;

&lt;p&gt;It’s easy to make quests and tutorials using coroutines. Consider this function:&lt;/p&gt;

&lt;div class=&quot;language-lua highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;girl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;say&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Kill that monster!&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;waitForEvent&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'EnemyKilled'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;girl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;setMood&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'happy'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;girl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;say&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;You did it! Thank you!&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;/assets/cutscene_article/kill_monster_quest.gif&quot; alt=&quot;Kill monster quest&quot; style=&quot;display:block; margin: 0 auto; width: 480px&quot; /&gt;&lt;/p&gt;

&lt;p&gt;You can also use coroutines for AI. For example, to make a monster traverse a path, you can do this:&lt;/p&gt;

&lt;div class=&quot;language-lua highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;followPath&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;monster&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;numberOfPoints&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;getNumberOfPoints&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
  &lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;-- index of current waypoint on path&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;monster&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;goTo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;getPoint&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;numberOfPoints&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;-- go to the next point&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;-- start from the beginning&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;/assets/cutscene_article/monster_follows_path.gif&quot; alt=&quot;Monster following a path&quot; style=&quot;display:block; margin: 0 auto; width: 240px&quot; /&gt;&lt;/p&gt;

&lt;p&gt;When monster will see the player, we can just not resume the coroutine, so while that &lt;code class=&quot;highlighter-rouge&quot;&gt;while&lt;/code&gt; loop looks endless, it isn’t.&lt;/p&gt;

&lt;p&gt;It’s also possible to implement “parallel” actions in a way that both actions are performed at the same time, but the action sequence goes to next action only when both actions are finished. For example, consider two NPCs moving at different speeds. When they meet at &lt;code class=&quot;highlighter-rouge&quot;&gt;meetingPoint&lt;/code&gt;, the cat says “meow”. We can implement it like this:&lt;/p&gt;

&lt;div class=&quot;language-lua highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;cutscene&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cat&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;girl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;meetingPoint&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;c1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;coroutine.create&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;cat&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;goTo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;meetingPoint&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

  &lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;c2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;coroutine.create&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;girl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;goTo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;meetingPoint&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

  &lt;span class=&quot;n&quot;&gt;c1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;resume&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;c2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;resume&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;

  &lt;span class=&quot;c1&quot;&gt;-- synchronization&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;waitForFinish&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;c2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

  &lt;span class=&quot;c1&quot;&gt;-- cutscene continues&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;cat&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;say&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;meow&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The important part here is &lt;code class=&quot;highlighter-rouge&quot;&gt;waitForFinish&lt;/code&gt; function which is a wrapper around &lt;code class=&quot;highlighter-rouge&quot;&gt;WaitForFinishAction&lt;/code&gt; which can be implemented like this:&lt;/p&gt;

&lt;div class=&quot;language-lua highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;WaitForFinishAction&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;update&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;coroutine.status&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'dead'&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;and&lt;/span&gt;
     &lt;span class=&quot;nb&quot;&gt;coroutine.status&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'dead'&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then&lt;/span&gt;
     &lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;finished&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;coroutine.status&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;~=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'dead'&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then&lt;/span&gt;
      &lt;span class=&quot;nb&quot;&gt;coroutine.resume&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;coroutine.status&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;~=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'dead'&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then&lt;/span&gt;
      &lt;span class=&quot;nb&quot;&gt;coroutine.resume&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;You can also take it a step further and allow &lt;code class=&quot;highlighter-rouge&quot;&gt;WaitForFinishAction&lt;/code&gt; to take an arbitrary amount of actions to synchronize. You can also implement an action which waits until one of the actions is finished. For example, this can be used for racing mini-games. You’ll be able to check when one of the cars arrives the finish line and then execute some action sequence.&lt;/p&gt;

&lt;h3 id=&quot;pros-and-cons-of-coroutines&quot;&gt;Pros and cons of coroutines&lt;/h3&gt;

&lt;p&gt;Coroutine approach is very powerful. The action sequences and cutscenes written with it can be easily read and modified, even by non-programmers.&lt;/p&gt;

&lt;p&gt;What’s also great is about it is that everything happens in one thread, so you don’t have synchronization or data racing problems.&lt;/p&gt;

&lt;p&gt;The approach is not perfect, however. For example, it’s hard to handle saving. For example, suppose that you have a long tutorial which is just one big coroutine. The player won’t be able to save during this tutorial, because you’d have to serialize coroutine’s state and then resume coroutine exactly from the point it was paused at.&lt;/p&gt;

&lt;p class=&quot;message&quot;&gt;It’s possible to save coroutine’s state with &lt;a href=&quot;http://lua-users.org/wiki/PlutoLibrary&quot;&gt;PlutoLibrary&lt;/a&gt;, however it only works with Lua 5.1&lt;/p&gt;

&lt;p&gt;This is not a problem if you use coroutines for cutscenes, as it’s usually not allowed for player to save during them.&lt;/p&gt;

&lt;p&gt;As for the long tutorial example - you can just separate your tutorial in chunks and then allow player to only save between them. For example, part A of the tutorial happens in a room without a save point. Then, there’s another room with a save point to which player goes once part A is finished. Then, part B begins. If you separate tutorial into two coroutines, serializing won’t be a problem, as you’ll only need to save a string which will contain info about the point of tutorial which player has completed.&lt;/p&gt;

&lt;h2 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h2&gt;

&lt;p&gt;As you can see, there are different approaches to implementing actions sequences and cutscenes. I believe coroutine approach is one of the most useful and clearest for writing action sequences and cutscenes. I hope this approach will make your life easier and you’ll make tons of complex and fun cutscenes with it. Thanks for reading!&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>How my little C++ meta-serialization library works and how I wrote it</title>
   <link href="https://eliasdaler.github.io/meta-stuff/"/>
   <updated>2017-09-27T22:00:00+03:00</updated>
   <id>https://eliasdaler.github.io/meta-stuff</id>
   <content type="html">
&lt;hr /&gt;

&lt;h2 id=&quot;introduction&quot;&gt;Introduction&lt;/h2&gt;

&lt;p&gt;A year ago I wrote a small library called &lt;i class=&quot;fa fa-github&quot;&gt;&lt;/i&gt;&lt;a href=&quot;https://github.com/eliasdaler/MetaStuff&quot;&gt;MetaStuff&lt;/a&gt;. It is used to register meta info about classes, which can be later used for serialization, deserialization, making GUI and so on. The cool thing about it is that you can write a serializer for your own data format, be it JSON, Lua or anything else. The library is very small, it uses C++14, requires no pre-build process, RTTI, macros… It’s just templates!&lt;/p&gt;

&lt;p&gt;Let’s look at how registration and serialization work. Suppose you have the following struct:&lt;/p&gt;

&lt;pre class=&quot;vs-code&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;Person&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;{&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppMemberField - identifier - (TRANSIENT)&quot;&gt;age&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;cppNamespace - identifier - (TRANSIENT)&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;string&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppMemberField - identifier - (TRANSIENT)&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;operator&quot;&gt;};&lt;/span&gt;&lt;/pre&gt;

&lt;p&gt;You register it like this:&lt;/p&gt;

&lt;pre class=&quot;vs-code&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;namespace&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppNamespace - identifier - (TRANSIENT)&quot;&gt;meta&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;{&lt;/span&gt;

&lt;span class=&quot;keyword&quot;&gt;template&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;&amp;lt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;keyword&quot;&gt;inline&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;auto&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppFunction - identifier - (TRANSIENT)&quot;&gt;registerMembers&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;Person&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;gt;()&lt;/span&gt;
&lt;span class=&quot;operator&quot;&gt;{&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppFunctionTemplate - identifier - (TRANSIENT)&quot;&gt;members&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;cppFunction - identifier - (TRANSIENT)&quot;&gt;member&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;string&quot;&gt;&amp;quot;age&amp;quot;&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;Person&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppMemberField - identifier - (TRANSIENT)&quot;&gt;age&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;),&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;cppFunction - identifier - (TRANSIENT)&quot;&gt;member&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;string&quot;&gt;&amp;quot;name&amp;quot;&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;Person&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppMemberField - identifier - (TRANSIENT)&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;)&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;operator&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;operator&quot;&gt;}&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;comment&quot;&gt;//&amp;nbsp;end&amp;nbsp;of&amp;nbsp;namespace&amp;nbsp;meta&lt;/span&gt;&lt;/pre&gt;

&lt;p&gt;And now you can serialize / deserialize it to / from JSON! (I’ll be using Niels Lohmann’s &lt;i class=&quot;fa fa-github&quot;&gt;&lt;/i&gt;&lt;a href=&quot;https://github.com/nlohmann/json&quot;&gt;JSON for Modern C++&lt;/a&gt; library in this article)&lt;/p&gt;

&lt;pre class=&quot;vs-code&quot;&gt;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;Person&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppLocalVariable - identifier - (TRANSIENT)&quot;&gt;person&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;cppLocalVariable - identifier - (TRANSIENT)&quot;&gt;person&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;cppMemberField - identifier - (TRANSIENT)&quot;&gt;age&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;number&quot;&gt;30&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;cppLocalVariable - identifier - (TRANSIENT)&quot;&gt;person&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;cppMemberField - identifier - (TRANSIENT)&quot;&gt;name&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppMemberOperator - operator - (TRANSIENT)&quot;&gt;=&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;string&quot;&gt;&amp;quot;John&amp;quot;&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;comment&quot;&gt;//&amp;nbsp;serialize&lt;/span&gt;
&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;json&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppLocalVariable - identifier - (TRANSIENT)&quot;&gt;j&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;cppLocalVariable - identifier - (TRANSIENT)&quot;&gt;j&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppMemberOperator - operator - (TRANSIENT)&quot;&gt;=&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppLocalVariable - identifier - (TRANSIENT)&quot;&gt;person&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;cppNamespace - identifier - (TRANSIENT)&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppGlobalVariable - identifier - (TRANSIENT)&quot;&gt;cout&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppOperator - operator - (TRANSIENT)&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppNamespace - identifier - (TRANSIENT)&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppFunction - identifier - (TRANSIENT)&quot;&gt;setw&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;)&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppOperator - operator - (TRANSIENT)&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppLocalVariable - identifier - (TRANSIENT)&quot;&gt;j&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppMemberOperator - operator - (TRANSIENT)&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppNamespace - identifier - (TRANSIENT)&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppFunctionTemplate - identifier - (TRANSIENT)&quot;&gt;endl&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;comment&quot;&gt;//&amp;nbsp;deserialize&lt;/span&gt;
&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;Person&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppLocalVariable - identifier - (TRANSIENT)&quot;&gt;p2&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;cppLocalVariable - identifier - (TRANSIENT)&quot;&gt;p2&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppLocalVariable - identifier - (TRANSIENT)&quot;&gt;j&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;identifier&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;Person&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;gt;(&lt;/span&gt;&lt;span class=&quot;cppLocalVariable - identifier - (TRANSIENT)&quot;&gt;j&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;cppNamespace - identifier - (TRANSIENT)&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppGlobalVariable - identifier - (TRANSIENT)&quot;&gt;cout&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppOperator - operator - (TRANSIENT)&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;string&quot;&gt;&amp;quot;Name&amp;nbsp;=&amp;nbsp;&amp;quot;&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppOperator - operator - (TRANSIENT)&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppLocalVariable - identifier - (TRANSIENT)&quot;&gt;p2&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;cppMemberField - identifier - (TRANSIENT)&quot;&gt;name&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppOperator - operator - (TRANSIENT)&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;string&quot;&gt;&amp;quot;,&amp;nbsp;age&amp;nbsp;=&amp;nbsp;&amp;quot;&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppMemberOperator - operator - (TRANSIENT)&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppLocalVariable - identifier - (TRANSIENT)&quot;&gt;p2&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;cppMemberField - identifier - (TRANSIENT)&quot;&gt;age&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppOperator - operator - (TRANSIENT)&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;string&quot;&gt;&amp;quot;\n&amp;quot;&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;&lt;/pre&gt;

&lt;p&gt;Output:&lt;/p&gt;

&lt;pre class=&quot;console-output&quot;&gt;{
    &quot;age&quot;: 30,
    &quot;name&quot;: &quot;John&quot;
}
Name = John, age = 30&lt;/pre&gt;

&lt;p&gt;Simple as that!&lt;/p&gt;

&lt;!--more--&gt;
&lt;p&gt;&lt;a class=&quot;anchor&quot; id=&quot;read-more&quot;&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;One more example. In &lt;a href=&quot;https://eliasdaler.github.io/re-creation/&quot;&gt;my game&lt;/a&gt; I have &lt;code class=&quot;highlighter-rouge&quot;&gt;Animation&lt;/code&gt; class registered. I also have a bunch of functions for &lt;a href=&quot;https://github.com/ocornut/imgui&quot;&gt;ImGui&lt;/a&gt; which can automatically build GUI for me, so I can easily change animation parameters. I just do this:&lt;/p&gt;

&lt;pre class=&quot;vs-code&quot;&gt;&lt;span class=&quot;cppNamespace - identifier - (TRANSIENT)&quot;&gt;ImGui&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppFunction - identifier - (TRANSIENT)&quot;&gt;Input&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;cppLocalVariable - identifier - (TRANSIENT)&quot;&gt;animation&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;);&lt;/span&gt;
&lt;/pre&gt;

&lt;p&gt;And I get this (the “Animation properties” table is generated by MetaStuff):&lt;/p&gt;

&lt;p class=&quot;img-desc&quot;&gt;&lt;img src=&quot;https://i.imgur.com/A44zLlb.gif&quot; alt=&quot;Animation editor&quot; /&gt;
Animation editor&lt;/p&gt;

&lt;h2 id=&quot;using-metastuff&quot;&gt;Using MetaStuff&lt;/h2&gt;

&lt;p&gt;The most important thing about MetaStuff is that it stores information about class members in a tuple without losing their types. To do something for all members of the class, you write this:&lt;/p&gt;

&lt;pre class=&quot;vs-code&quot;&gt;&lt;span class=&quot;cppNamespace - identifier - (TRANSIENT)&quot;&gt;meta&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppFunction - identifier - (TRANSIENT)&quot;&gt;doForAllMembers&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;Person&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;gt;(&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;[&amp;amp;&lt;/span&gt;&lt;span class=&quot;cppLocalVariable - identifier - (TRANSIENT)&quot;&gt;person&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;](&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;auto&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;amp;&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppParameter - identifier - (TRANSIENT)&quot;&gt;member&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;)&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;{&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;comment&quot;&gt;//&amp;nbsp;do&amp;nbsp;something&amp;nbsp;for&amp;nbsp;member&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;});&lt;/span&gt;&lt;/pre&gt;

&lt;p&gt;The type of &lt;code class=&quot;highlighter-rouge&quot;&gt;member&lt;/code&gt; inside the lambda is &lt;code class=&quot;highlighter-rouge&quot;&gt;meta::Member&amp;lt;Person, T&amp;gt;&lt;/code&gt;, where &lt;code class=&quot;highlighter-rouge&quot;&gt;T&lt;/code&gt; is a type of a member you previously registered. This is really nice, because just by calling &lt;code class=&quot;highlighter-rouge&quot;&gt;Member&amp;lt;Person, T&amp;gt;::get(person)&lt;/code&gt;, you get a reference to an object from &lt;code class=&quot;highlighter-rouge&quot;&gt;person&lt;/code&gt; instance, which you can modify and use in other functions.&lt;/p&gt;

&lt;p&gt;Let’s look at a simple example.&lt;/p&gt;

&lt;pre class=&quot;vs-code&quot;&gt;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;Person&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppLocalVariable - identifier - (TRANSIENT)&quot;&gt;person&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;cppLocalVariable - identifier - (TRANSIENT)&quot;&gt;person&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;cppMemberField - identifier - (TRANSIENT)&quot;&gt;age&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;number&quot;&gt;30&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;cppLocalVariable - identifier - (TRANSIENT)&quot;&gt;person&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;cppMemberField - identifier - (TRANSIENT)&quot;&gt;name&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppMemberOperator - operator - (TRANSIENT)&quot;&gt;=&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;string&quot;&gt;&amp;quot;John&amp;quot;&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;cppNamespace - identifier - (TRANSIENT)&quot;&gt;meta&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppFunction - identifier - (TRANSIENT)&quot;&gt;doForAllMembers&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;Person&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;gt;(&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;[&amp;amp;&lt;/span&gt;&lt;span class=&quot;cppLocalVariable - identifier - (TRANSIENT)&quot;&gt;person&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;](&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;auto&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;amp;&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppParameter - identifier - (TRANSIENT)&quot;&gt;member&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;operator&quot;&gt;{&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;using&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;MemberT&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppNamespace - identifier - (TRANSIENT)&quot;&gt;meta&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;get_member_type&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;decltype&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;cppParameter - identifier - (TRANSIENT)&quot;&gt;member&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;)&amp;gt;;&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;cppNamespace - identifier - (TRANSIENT)&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppGlobalVariable - identifier - (TRANSIENT)&quot;&gt;cout&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppOperator - operator - (TRANSIENT)&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;string&quot;&gt;&amp;quot;*&amp;nbsp;&amp;quot;&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppParameter - identifier - (TRANSIENT)&quot;&gt;member&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;identifier&quot;&gt;getName&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;()&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;string&quot;&gt;&amp;quot;,&amp;nbsp;value&amp;nbsp;=&amp;nbsp;&amp;quot;&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppParameter - identifier - (TRANSIENT)&quot;&gt;member&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;identifier&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;cppLocalVariable - identifier - (TRANSIENT)&quot;&gt;person&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;)&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;string&quot;&gt;&amp;quot;,&amp;nbsp;type&amp;nbsp;=&amp;nbsp;&amp;quot;&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;typeid&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;MemberT&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;cppMemberFunction - identifier - (TRANSIENT)&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;()&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;string&quot;&gt;&amp;#39;\n&amp;#39;&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;operator&quot;&gt;});&lt;/span&gt;&lt;/pre&gt;

&lt;p&gt;Output:&lt;/p&gt;

&lt;pre class=&quot;console-output&quot;&gt;* age, value = 30, type = int
* name, value = John, type = class std::basic_string&amp;lt;char,struct std::char_traits&amp;lt;char&amp;gt;,class std::allocator&amp;lt;char&amp;gt; &amp;gt;&lt;/pre&gt;

&lt;hr /&gt;

&lt;p&gt;You can iterate over all members and call template functions or functions with overloads. Suppose you have a function:&lt;/p&gt;

&lt;pre class=&quot;vs-code&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;template&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;typename&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppFunctionTemplate - identifier - (TRANSIENT)&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;T&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppParameter - identifier - (TRANSIENT)&quot;&gt;obj&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;)&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;{};&lt;/span&gt;

&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppFunction - identifier - (TRANSIENT)&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppParameter - identifier - (TRANSIENT)&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;operator&quot;&gt;{&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;cppNamespace - identifier - (TRANSIENT)&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppGlobalVariable - identifier - (TRANSIENT)&quot;&gt;cout&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppOperator - operator - (TRANSIENT)&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;string&quot;&gt;&amp;quot;It&amp;#39;s&amp;nbsp;an&amp;nbsp;int!&amp;nbsp;Value&amp;nbsp;=&amp;nbsp;&amp;quot;&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppMemberOperator - operator - (TRANSIENT)&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppParameter - identifier - (TRANSIENT)&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;operator&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppFunction - identifier - (TRANSIENT)&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppNamespace - identifier - (TRANSIENT)&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;amp;&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppParameter - identifier - (TRANSIENT)&quot;&gt;str&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;operator&quot;&gt;{&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;cppNamespace - identifier - (TRANSIENT)&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppGlobalVariable - identifier - (TRANSIENT)&quot;&gt;cout&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppOperator - operator - (TRANSIENT)&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;string&quot;&gt;&amp;quot;It&amp;#39;s&amp;nbsp;a&amp;nbsp;string!&amp;nbsp;Value&amp;nbsp;=&amp;nbsp;&amp;quot;&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppOperator - operator - (TRANSIENT)&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppParameter - identifier - (TRANSIENT)&quot;&gt;str&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;operator&quot;&gt;}&lt;/span&gt;&lt;/pre&gt;

&lt;p&gt;And now we do this:&lt;/p&gt;

&lt;pre class=&quot;vs-code&quot;&gt;&lt;span class=&quot;cppNamespace - identifier - (TRANSIENT)&quot;&gt;meta&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppFunction - identifier - (TRANSIENT)&quot;&gt;doForAllMembers&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;Person&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;gt;(&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;[&amp;amp;&lt;/span&gt;&lt;span class=&quot;cppLocalVariable - identifier - (TRANSIENT)&quot;&gt;person&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;](&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;auto&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;amp;&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppParameter - identifier - (TRANSIENT)&quot;&gt;member&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;)&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;{&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;cppNamespace - identifier - (TRANSIENT)&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppGlobalVariable - identifier - (TRANSIENT)&quot;&gt;cout&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppOperator - operator - (TRANSIENT)&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;string&quot;&gt;&amp;quot;*&amp;nbsp;&amp;quot;&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppOperator - operator - (TRANSIENT)&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;string&quot;&gt;&amp;quot;What&amp;nbsp;is&amp;nbsp;&amp;quot;&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppParameter - identifier - (TRANSIENT)&quot;&gt;member&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;identifier&quot;&gt;getName&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;()&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;string&quot;&gt;&amp;quot;&amp;nbsp;?&amp;nbsp;&amp;quot;&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;identifier&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;cppParameter - identifier - (TRANSIENT)&quot;&gt;member&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;identifier&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;cppLocalVariable - identifier - (TRANSIENT)&quot;&gt;person&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;));&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;cppNamespace - identifier - (TRANSIENT)&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppGlobalVariable - identifier - (TRANSIENT)&quot;&gt;cout&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppOperator - operator - (TRANSIENT)&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;string&quot;&gt;&amp;#39;\n&amp;#39;&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;});&lt;/span&gt;&lt;/pre&gt;

&lt;p&gt;Output:&lt;/p&gt;
&lt;pre class=&quot;console-output&quot;&gt;* What is age ? It's an int! Value = 30
* What is name ? It's a string! Value = John
&lt;/pre&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/eliasdaler/MetaStuff/blob/master/example/JsonCast.inl#L86&quot;&gt;Here&lt;/a&gt; you can look at how JSON serialization / deserialization is performed. It’s not that complicated: we just need to write some overloads for non-trivial cases (&lt;code class=&quot;highlighter-rouge&quot;&gt;std::vector&lt;/code&gt; should be processed as JSON array and &lt;code class=&quot;highlighter-rouge&quot;&gt;std::unordered_map&lt;/code&gt; as JSON object). For the main serialization / deserialization loop, we just need to iterate over all registered members and do something like this:&lt;/p&gt;

&lt;pre class=&quot;vs-code&quot;&gt;&lt;span class=&quot;cppLocalVariable - identifier - (TRANSIENT)&quot;&gt;jsonObject&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;cppParameter - identifier - (TRANSIENT)&quot;&gt;member&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;identifier&quot;&gt;getName&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;()]&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppParameter - identifier - (TRANSIENT)&quot;&gt;member&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;identifier&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;cppLocalVariable - identifier - (TRANSIENT)&quot;&gt;person&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;);&lt;/span&gt;
&lt;/pre&gt;

&lt;p&gt;The serializer can handle much more complex cases, than shown previously, such as instance of one class, being in another class: the serialization will work correctly for registered classes! For example, for the following classes:&lt;/p&gt;

&lt;pre class=&quot;vs-code&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;Health&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;{&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppMemberField - identifier - (TRANSIENT)&quot;&gt;hp&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;number&quot;&gt;20&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;operator&quot;&gt;};&lt;/span&gt;

&lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;Hero&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;{&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;Health&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppMemberField - identifier - (TRANSIENT)&quot;&gt;health&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppMemberField - identifier - (TRANSIENT)&quot;&gt;attackPower&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;number&quot;&gt;30&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;operator&quot;&gt;};&lt;/span&gt;&lt;/pre&gt;

&lt;p&gt;we’ll get this JSON:&lt;/p&gt;

&lt;div class=&quot;language-json highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;attackPower&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;health&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;hp&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;20&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;nice-things-about-metastuff&quot;&gt;Nice things about MetaStuff&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;It doesn’t require you to perform some pre-build process to generate additional code.&lt;/li&gt;
  &lt;li&gt;It doesn’t use RTTI.&lt;/li&gt;
  &lt;li&gt;You don’t need to modify your class to register meta info about it. This allows you to register classes from code you can’t modify, such as libraries.&lt;/li&gt;
  &lt;li&gt;It’s not constrained to one format or library: you can implement your own serializer / deserializer to any format you want.&lt;/li&gt;
  &lt;li&gt;Surprisingly, the code works pretty fast and compilers optimize a lot behind the scenes. My game loads animations using MetaStuff and the performance is pretty close to JSON deserialization written by hand.&lt;/li&gt;
  &lt;li&gt;This library can be used for other things other than serialization, such as building GUIs.&lt;/li&gt;
  &lt;li&gt;You can use it with getters and setters, instead of raw member pointers.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Suppose our &lt;code class=&quot;highlighter-rouge&quot;&gt;Person&lt;/code&gt; class now looks like this:&lt;/p&gt;
&lt;pre class=&quot;vs-code&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;Person&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;:&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppMemberFunction - identifier - (TRANSIENT)&quot;&gt;setAge&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppParameter - identifier - (TRANSIENT)&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;)&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;{&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppMemberField - identifier - (TRANSIENT)&quot;&gt;age&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppParameter - identifier - (TRANSIENT)&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;}&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppMemberFunction - identifier - (TRANSIENT)&quot;&gt;getAge&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;()&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;{&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppMemberField - identifier - (TRANSIENT)&quot;&gt;age&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;}&lt;/span&gt;

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;comment&quot;&gt;//&amp;nbsp;...&amp;nbsp;same&amp;nbsp;for&amp;nbsp;name&lt;/span&gt;
&lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;:&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppMemberField - identifier - (TRANSIENT)&quot;&gt;age&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;cppNamespace - identifier - (TRANSIENT)&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;string&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppMemberField - identifier - (TRANSIENT)&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;operator&quot;&gt;};&lt;/span&gt;&lt;/pre&gt;

&lt;p&gt;We pass getter and setter to MetaStuff during registration:&lt;/p&gt;
&lt;pre class=&quot;vs-code&quot;&gt;&lt;span class=&quot;identifier&quot;&gt;member&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;string&quot;&gt;&amp;quot;age&amp;quot;&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;Person&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;identifier&quot;&gt;getAge&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;Person&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppMemberFunction - identifier - (TRANSIENT)&quot;&gt;setAge&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;)&lt;/span&gt;
&lt;/pre&gt;

&lt;p&gt;Now, when we’ll serialize object, &lt;code class=&quot;highlighter-rouge&quot;&gt;Person::getAge&lt;/code&gt; will get called when getting value of “age” member.&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;You can make more complex serialization process easier by using getters and setters in a non-standard way.
Suppose that you have &lt;code class=&quot;highlighter-rouge&quot;&gt;Sprite&lt;/code&gt; class:&lt;/p&gt;

&lt;pre class=&quot;vs-code&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;Sprite&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;:&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;comment&quot;&gt;//&amp;nbsp;...&lt;/span&gt;
&lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;:&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;Texture&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppMemberField - identifier - (TRANSIENT)&quot;&gt;texture&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;operator&quot;&gt;};&lt;/span&gt;&lt;/pre&gt;

&lt;p&gt;How do you deserialize it? It’s not possible to store &lt;code class=&quot;highlighter-rouge&quot;&gt;Texture&lt;/code&gt; in a JSON, so we’ll store a texture filename instead:&lt;/p&gt;

&lt;div class=&quot;language-json highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;texture&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;res/images/hero.png&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;But how do we load texture when reading data from JSON? One solution is to register variable, which will store texture’s filename, and later call some &lt;code class=&quot;highlighter-rouge&quot;&gt;postInit&lt;/code&gt; function:&lt;/p&gt;

&lt;pre class=&quot;vs-code&quot;&gt;&lt;span class=&quot;cppNamespace - identifier - (TRANSIENT)&quot;&gt;meta&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppFunction - identifier - (TRANSIENT)&quot;&gt;member&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;string&quot;&gt;&amp;quot;texture&amp;quot;&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;Sprite&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppMemberField - identifier - (TRANSIENT)&quot;&gt;textureFilename&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;);&lt;/span&gt;
&lt;/pre&gt;

&lt;pre class=&quot;vs-code&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;Sprite&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppMemberFunction - identifier - (TRANSIENT)&quot;&gt;postInit&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;operator&quot;&gt;{&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;cppMemberField - identifier - (TRANSIENT)&quot;&gt;texture&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;cppMemberFunction - identifier - (TRANSIENT)&quot;&gt;loadFromFile&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;cppMemberField - identifier - (TRANSIENT)&quot;&gt;textureFilename&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;operator&quot;&gt;}&lt;/span&gt;&lt;/pre&gt;

&lt;pre class=&quot;vs-code&quot;&gt;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;Sprite&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppLocalVariable - identifier - (TRANSIENT)&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;cppLocalVariable - identifier - (TRANSIENT)&quot;&gt;s&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppMemberOperator - operator - (TRANSIENT)&quot;&gt;=&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppLocalVariable - identifier - (TRANSIENT)&quot;&gt;j&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;cppMemberFunction - identifier - (TRANSIENT)&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;Sprite&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;gt;();&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;comment&quot;&gt;//&amp;nbsp;here&amp;nbsp;we&amp;#39;ll&amp;nbsp;get&amp;nbsp;textureFilename&lt;/span&gt;
&lt;span class=&quot;cppLocalVariable - identifier - (TRANSIENT)&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;cppMemberFunction - identifier - (TRANSIENT)&quot;&gt;postInit&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;();&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;comment&quot;&gt;//&amp;nbsp;and&amp;nbsp;here&amp;nbsp;our&amp;nbsp;texture&amp;nbsp;we&amp;#39;ll&amp;nbsp;be&amp;nbsp;loaded&lt;/span&gt;&lt;/pre&gt;

&lt;p&gt;This works, but we can do better! Let’s register a &lt;code class=&quot;highlighter-rouge&quot;&gt;loadTexture&lt;/code&gt; function as a setter for “texture”.&lt;/p&gt;

&lt;pre class=&quot;vs-code&quot;&gt;&lt;span class=&quot;cppNamespace - identifier - (TRANSIENT)&quot;&gt;meta&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppFunction - identifier - (TRANSIENT)&quot;&gt;member&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;string&quot;&gt;&amp;quot;texture&amp;quot;&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;Sprite&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppMemberFunction - identifier - (TRANSIENT)&quot;&gt;getTextureFilename&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;Sprite&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppMemberFunction - identifier - (TRANSIENT)&quot;&gt;loadTexture&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;);&lt;/span&gt;
&lt;/pre&gt;

&lt;pre class=&quot;vs-code&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppNamespace - identifier - (TRANSIENT)&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;amp;&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;Sprite&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppMemberFunction - identifier - (TRANSIENT)&quot;&gt;getTextureFilename&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;()&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt;
&lt;span class=&quot;operator&quot;&gt;{&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppMemberField - identifier - (TRANSIENT)&quot;&gt;textureFilename&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;operator&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;Sprite&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppMemberFunction - identifier - (TRANSIENT)&quot;&gt;loadTexture&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppNamespace - identifier - (TRANSIENT)&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;amp;&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppParameter - identifier - (TRANSIENT)&quot;&gt;filename&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;operator&quot;&gt;{&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;cppMemberField - identifier - (TRANSIENT)&quot;&gt;textureFilename&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppMemberOperator - operator - (TRANSIENT)&quot;&gt;=&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppParameter - identifier - (TRANSIENT)&quot;&gt;filename&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;cppMemberField - identifier - (TRANSIENT)&quot;&gt;texture&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;cppMemberFunction - identifier - (TRANSIENT)&quot;&gt;loadFromFile&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;cppParameter - identifier - (TRANSIENT)&quot;&gt;filename&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;operator&quot;&gt;}&lt;/span&gt;&lt;/pre&gt;

&lt;p&gt;Now, when you’ll deserialize from JSON, &lt;code class=&quot;highlighter-rouge&quot;&gt;loadTexture&lt;/code&gt; will be called and the texture will get loaded as you want it to. And when you serialize &lt;code class=&quot;highlighter-rouge&quot;&gt;Sprite&lt;/code&gt; class to JSON, texture filename gets saved there.&lt;/p&gt;

&lt;p&gt;Now, let’s implement simple meta info holder and see how I came from its design to MetaStuff.&lt;/p&gt;

&lt;h2 id=&quot;simple-approach-that-kinda-works&quot;&gt;Simple approach (that kinda works)&lt;/h2&gt;

&lt;p&gt;It all started from a simple, yet somewhat flawed approach. One easy way to build a meta system is to make it with type-erasure and virtual functions. Full working example can be found &lt;a href=&quot;https://gist.github.com/eliasdaler/213d42051958ae21185adbc7edbff915&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;

&lt;pre class=&quot;vs-code&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;template&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;typename&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;Class&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppClassTemplate - identifier - (TRANSIENT)&quot;&gt;IMember&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;:&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;virtual&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppMemberFunction - operator - (TRANSIENT)&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;cppMemberFunction - identifier - (TRANSIENT)&quot;&gt;IMember&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;()&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;default&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;virtual&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppMemberFunction - identifier - (TRANSIENT)&quot;&gt;fromJson&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;Class&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;amp;&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppParameter - identifier - (TRANSIENT)&quot;&gt;obj&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;json&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;amp;&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppParameter - identifier - (TRANSIENT)&quot;&gt;j&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;)&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;virtual&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;json&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppMemberFunction - identifier - (TRANSIENT)&quot;&gt;toJson&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;Class&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;amp;&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppParameter - identifier - (TRANSIENT)&quot;&gt;obj&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;)&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;operator&quot;&gt;};&lt;/span&gt;&lt;/pre&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;IMember&lt;/code&gt; is a base class for &lt;code class=&quot;highlighter-rouge&quot;&gt;Member&lt;/code&gt; class which will store member info.&lt;/p&gt;

&lt;pre class=&quot;vs-code&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;template&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;typename&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;Class&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;typename&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppClassTemplate - identifier - (TRANSIENT)&quot;&gt;Member&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;:&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;IMember&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;Class&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;gt;&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;:&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;cppMemberFunction - identifier - (TRANSIENT)&quot;&gt;Member&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;T&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;Class&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::*&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppParameter - identifier - (TRANSIENT)&quot;&gt;ptr&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;)&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;:&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppMemberField - identifier - (TRANSIENT)&quot;&gt;ptr&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;cppParameter - identifier - (TRANSIENT)&quot;&gt;ptr&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;)&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;{}&lt;/span&gt;

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppMemberFunction - identifier - (TRANSIENT)&quot;&gt;fromJson&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;Class&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;amp;&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppParameter - identifier - (TRANSIENT)&quot;&gt;obj&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;json&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;amp;&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppParameter - identifier - (TRANSIENT)&quot;&gt;j&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;)&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;override&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;{&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;cppParameter - identifier - (TRANSIENT)&quot;&gt;obj&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;.*&lt;/span&gt;&lt;span class=&quot;cppMemberField - identifier - (TRANSIENT)&quot;&gt;ptr&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppParameter - identifier - (TRANSIENT)&quot;&gt;j&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;}&lt;/span&gt;

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;json&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppMemberFunction - identifier - (TRANSIENT)&quot;&gt;toJson&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;Class&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;amp;&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppParameter - identifier - (TRANSIENT)&quot;&gt;obj&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;)&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;override&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;{&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;json&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;cppParameter - identifier - (TRANSIENT)&quot;&gt;obj&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;.*&lt;/span&gt;&lt;span class=&quot;cppMemberField - identifier - (TRANSIENT)&quot;&gt;ptr&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;);&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;:&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;T&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;Class&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::*&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppMemberField - identifier - (TRANSIENT)&quot;&gt;ptr&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;operator&quot;&gt;};&lt;/span&gt;&lt;/pre&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;Member&lt;/code&gt; class stores a pointer to a class member which lets us get it directly from &lt;code class=&quot;highlighter-rouge&quot;&gt;Class&lt;/code&gt; instance (see how we need to pass it in &lt;code class=&quot;highlighter-rouge&quot;&gt;fromJson&lt;/code&gt; / &lt;code class=&quot;highlighter-rouge&quot;&gt;toJson&lt;/code&gt; function).&lt;/p&gt;

&lt;p&gt;And now for the class that will store all info about members of a particular class:&lt;/p&gt;

&lt;pre class=&quot;vs-code&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;template&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;typename&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;Class&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppClassTemplate - identifier - (TRANSIENT)&quot;&gt;ClassMetaInfo&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;:&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppStaticMemberFunction - identifier - (TRANSIENT)&quot;&gt;serialize&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;Class&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;amp;&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppParameter - identifier - (TRANSIENT)&quot;&gt;obj&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;json&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;amp;&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppParameter - identifier - (TRANSIENT)&quot;&gt;j&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;)&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;{&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;auto&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;amp;&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppLocalVariable - identifier - (TRANSIENT)&quot;&gt;pair&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;:&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppStaticMemberField - identifier - (TRANSIENT)&quot;&gt;members&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;)&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;{&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;auto&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;amp;&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppLocalVariable - identifier - (TRANSIENT)&quot;&gt;memberName&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppLocalVariable - identifier - (TRANSIENT)&quot;&gt;pair&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;identifier&quot;&gt;first&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;auto&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;amp;&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppLocalVariable - identifier - (TRANSIENT)&quot;&gt;memberPtr&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppLocalVariable - identifier - (TRANSIENT)&quot;&gt;pair&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;identifier&quot;&gt;second&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;cppLocalVariable - identifier - (TRANSIENT)&quot;&gt;memberPtr&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;identifier&quot;&gt;fromJson&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;cppParameter - identifier - (TRANSIENT)&quot;&gt;obj&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppParameter - identifier - (TRANSIENT)&quot;&gt;j&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;cppLocalVariable - identifier - (TRANSIENT)&quot;&gt;memberName&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;]);&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;}&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;}&lt;/span&gt;

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;json&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppStaticMemberFunction - identifier - (TRANSIENT)&quot;&gt;deserialize&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;Class&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;amp;&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppParameter - identifier - (TRANSIENT)&quot;&gt;obj&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;)&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;{&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;json&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppLocalVariable - identifier - (TRANSIENT)&quot;&gt;j&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;auto&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;amp;&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppLocalVariable - identifier - (TRANSIENT)&quot;&gt;pair&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;:&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppStaticMemberField - identifier - (TRANSIENT)&quot;&gt;members&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;)&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;{&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;auto&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;amp;&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppLocalVariable - identifier - (TRANSIENT)&quot;&gt;memberName&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppLocalVariable - identifier - (TRANSIENT)&quot;&gt;pair&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;identifier&quot;&gt;first&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;auto&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;amp;&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppLocalVariable - identifier - (TRANSIENT)&quot;&gt;memberPtr&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppLocalVariable - identifier - (TRANSIENT)&quot;&gt;pair&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;identifier&quot;&gt;second&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;cppLocalVariable - identifier - (TRANSIENT)&quot;&gt;j&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;cppLocalVariable - identifier - (TRANSIENT)&quot;&gt;memberName&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;]&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppLocalVariable - identifier - (TRANSIENT)&quot;&gt;memberPtr&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;identifier&quot;&gt;toJson&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;cppParameter - identifier - (TRANSIENT)&quot;&gt;obj&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;);&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;}&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppLocalVariable - identifier - (TRANSIENT)&quot;&gt;j&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;}&lt;/span&gt;

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;template&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;typename&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;gt;&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppStaticMemberFunction - identifier - (TRANSIENT)&quot;&gt;registerMember&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;char&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;*&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppParameter - identifier - (TRANSIENT)&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;T&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;Class&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::*&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppParameter - identifier - (TRANSIENT)&quot;&gt;ptr&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;)&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;{&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;cppStaticMemberField - identifier - (TRANSIENT)&quot;&gt;members&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;identifier&quot;&gt;emplace&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;cppParameter - identifier - (TRANSIENT)&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppNamespace - identifier - (TRANSIENT)&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;identifier&quot;&gt;make_unique&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;Member&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;Class&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;gt;&amp;gt;(&lt;/span&gt;&lt;span class=&quot;cppParameter - identifier - (TRANSIENT)&quot;&gt;ptr&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;));&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;}&lt;/span&gt;

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;using&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;MemberPtrType&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppNamespace - identifier - (TRANSIENT)&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;unique_ptr&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;IMember&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;Class&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;gt;&amp;gt;;&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;using&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;MemberMapType&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppNamespace - identifier - (TRANSIENT)&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;unordered_map&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;cppNamespace - identifier - (TRANSIENT)&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;MemberPtrType&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;gt;;&lt;/span&gt;
&lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;:&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;MemberMapType&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppStaticMemberField - identifier - (TRANSIENT)&quot;&gt;members&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;operator&quot;&gt;};&lt;/span&gt;

&lt;span class=&quot;keyword&quot;&gt;template&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;typename&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;Class&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;keyword&quot;&gt;typename&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppClassTemplate - identifier - (TRANSIENT)&quot;&gt;ClassMetaInfo&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;Class&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;gt;::&lt;/span&gt;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;MemberMapType&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppClassTemplate - identifier - (TRANSIENT)&quot;&gt;ClassMetaInfo&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;Class&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;gt;::&lt;/span&gt;&lt;span class=&quot;cppStaticMemberField - identifier - (TRANSIENT)&quot;&gt;members&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;&lt;/pre&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;ClassMetaInfo&lt;/code&gt; class stores all members in members &lt;code class=&quot;highlighter-rouge&quot;&gt;unordered_map&lt;/code&gt;. We can’t store objects of different classes inside &lt;code class=&quot;highlighter-rouge&quot;&gt;unordered_map&lt;/code&gt;, because &lt;code class=&quot;highlighter-rouge&quot;&gt;Member&amp;lt;Class, int&amp;gt;&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;Member&amp;lt;Class, std::string&amp;gt;&lt;/code&gt; have different types. That’s why they have the common base class and virtual functions which will help us get the original type back (at least for a function call).&lt;/p&gt;

&lt;p&gt;Let’s use it:&lt;/p&gt;

&lt;pre class=&quot;vs-code&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;Person&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;{&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;cppNamespace - identifier - (TRANSIENT)&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;string&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppMemberField - identifier - (TRANSIENT)&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppMemberField - identifier - (TRANSIENT)&quot;&gt;age&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppStaticMemberFunction - identifier - (TRANSIENT)&quot;&gt;registerClass&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;()&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;{&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;ClassMetaInfo&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;Person&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;gt;::&lt;/span&gt;&lt;span class=&quot;cppStaticMemberFunction - identifier - (TRANSIENT)&quot;&gt;registerMember&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;string&quot;&gt;&amp;quot;name&amp;quot;&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;Person&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppMemberField - identifier - (TRANSIENT)&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;);&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;ClassMetaInfo&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;Person&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;gt;::&lt;/span&gt;&lt;span class=&quot;cppStaticMemberFunction - identifier - (TRANSIENT)&quot;&gt;registerMember&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;string&quot;&gt;&amp;quot;age&amp;quot;&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;Person&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppMemberField - identifier - (TRANSIENT)&quot;&gt;age&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;);&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;operator&quot;&gt;};&lt;/span&gt;

&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppFunction - identifier - (TRANSIENT)&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;operator&quot;&gt;{&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;Person&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppStaticMemberFunction - identifier - (TRANSIENT)&quot;&gt;registerClass&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;();&lt;/span&gt;

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;Person&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppLocalVariable - identifier - (TRANSIENT)&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;{&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;string&quot;&gt;&amp;quot;John&amp;quot;&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;number&quot;&gt;30&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;};&lt;/span&gt;

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;json&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppLocalVariable - identifier - (TRANSIENT)&quot;&gt;j&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;ClassMetaInfo&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;Person&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;gt;::&lt;/span&gt;&lt;span class=&quot;cppStaticMemberFunction - identifier - (TRANSIENT)&quot;&gt;deserialize&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;cppLocalVariable - identifier - (TRANSIENT)&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;);&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;cppNamespace - identifier - (TRANSIENT)&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppGlobalVariable - identifier - (TRANSIENT)&quot;&gt;cout&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppOperator - operator - (TRANSIENT)&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppNamespace - identifier - (TRANSIENT)&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppFunction - identifier - (TRANSIENT)&quot;&gt;setw&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;)&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppOperator - operator - (TRANSIENT)&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppLocalVariable - identifier - (TRANSIENT)&quot;&gt;j&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppMemberOperator - operator - (TRANSIENT)&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppNamespace - identifier - (TRANSIENT)&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppFunctionTemplate - identifier - (TRANSIENT)&quot;&gt;endl&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;Person&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppLocalVariable - identifier - (TRANSIENT)&quot;&gt;p2&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;ClassMetaInfo&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;Person&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;gt;::&lt;/span&gt;&lt;span class=&quot;cppStaticMemberFunction - identifier - (TRANSIENT)&quot;&gt;serialize&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;cppLocalVariable - identifier - (TRANSIENT)&quot;&gt;p2&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppLocalVariable - identifier - (TRANSIENT)&quot;&gt;j&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;);&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;cppNamespace - identifier - (TRANSIENT)&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppGlobalVariable - identifier - (TRANSIENT)&quot;&gt;cout&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppOperator - operator - (TRANSIENT)&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;string&quot;&gt;&amp;quot;Name&amp;nbsp;=&amp;nbsp;&amp;quot;&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppOperator - operator - (TRANSIENT)&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppLocalVariable - identifier - (TRANSIENT)&quot;&gt;p2&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;cppMemberField - identifier - (TRANSIENT)&quot;&gt;name&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppOperator - operator - (TRANSIENT)&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;string&quot;&gt;&amp;quot;,&amp;nbsp;age&amp;nbsp;=&amp;nbsp;&amp;quot;&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppMemberOperator - operator - (TRANSIENT)&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppLocalVariable - identifier - (TRANSIENT)&quot;&gt;p2&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;cppMemberField - identifier - (TRANSIENT)&quot;&gt;age&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppOperator - operator - (TRANSIENT)&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;string&quot;&gt;&amp;quot;\n&amp;quot;&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;operator&quot;&gt;}&lt;/span&gt;&lt;/pre&gt;

&lt;p&gt;Output:&lt;/p&gt;

&lt;pre class=&quot;console-output&quot;&gt;{
    &quot;age&quot;: 30,
    &quot;name&quot;: &quot;John&quot;
}
Name = John, age = 30&lt;/pre&gt;

&lt;p&gt;Okay, that worked!
This system worked well for me, until I understood that if I wanted to add another format (for example, XML), I’d have to add new &lt;code class=&quot;highlighter-rouge&quot;&gt;toXml&lt;/code&gt; / &lt;code class=&quot;highlighter-rouge&quot;&gt;fromXml&lt;/code&gt; virtual functions everywhere. Same for ImGui and anything else. The other problem was the need to call &lt;code class=&quot;highlighter-rouge&quot;&gt;registerClass&lt;/code&gt; function. If I forgot to do it, the “members” map will be empty for the corresponding class. It’s also very hard to implement serializer which will handle nested classes, as shown with &lt;code class=&quot;highlighter-rouge&quot;&gt;Hero&lt;/code&gt; / &lt;code class=&quot;highlighter-rouge&quot;&gt;Health&lt;/code&gt; example shown previously.&lt;/p&gt;

&lt;h2 id=&quot;implementation-of-metastuff&quot;&gt;Implementation of MetaStuff&lt;/h2&gt;

&lt;p&gt;Let’s see what had to be changed from a previous meta-library to get this functionality.&lt;/p&gt;

&lt;p&gt;First of all, instead of storing members in an &lt;code class=&quot;highlighter-rouge&quot;&gt;unordered_map&lt;/code&gt;, I store them in a &lt;code class=&quot;highlighter-rouge&quot;&gt;tuple&lt;/code&gt;. It looks like this for a &lt;code class=&quot;highlighter-rouge&quot;&gt;Person&lt;/code&gt; class:&lt;/p&gt;

&lt;pre class=&quot;vs-code&quot;&gt;&lt;span class=&quot;cppNamespace - identifier - (TRANSIENT)&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;tuple&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;Member&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;Person&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppNamespace - identifier - (TRANSIENT)&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;gt;,&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;Member&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;Person&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;gt;&amp;gt;&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppLocalVariable - identifier - (TRANSIENT)&quot;&gt;members&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;
&lt;/pre&gt;

&lt;p&gt;With some template magic and Vittorio Romero’s help (see &lt;a href=&quot;https://www.youtube.com/watch?v=Za92Tz_g0zQ&quot;&gt;this awesome video&lt;/a&gt;), I implemented a function which calls some lambda for each member of the tuple. And that’s what &lt;code class=&quot;highlighter-rouge&quot;&gt;meta::doForAllMembers&lt;/code&gt; does: it iterates over all Member objects inside of members tuple and calls lambda passed as the function parameter for each of them. The lambda which is used is a &lt;a href=&quot;https://isocpp.org/wiki/faq/cpp14-language#generic-lambdas&quot;&gt;generic one&lt;/a&gt;, so on each call you get a &lt;code class=&quot;highlighter-rouge&quot;&gt;Member&amp;lt;Class, T&amp;gt;&lt;/code&gt; object without type erasure!&lt;/p&gt;

&lt;p&gt;Let’s look at class registration. To register &lt;code class=&quot;highlighter-rouge&quot;&gt;Person&lt;/code&gt; class, you have to write this:&lt;/p&gt;

&lt;pre class=&quot;vs-code&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;namespace&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppNamespace - identifier - (TRANSIENT)&quot;&gt;meta&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;{&lt;/span&gt;

&lt;span class=&quot;keyword&quot;&gt;template&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;&amp;lt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;keyword&quot;&gt;inline&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;auto&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppFunction - identifier - (TRANSIENT)&quot;&gt;registerMembers&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;Person&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;gt;()&lt;/span&gt;
&lt;span class=&quot;operator&quot;&gt;{&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppFunction - identifier - (TRANSIENT)&quot;&gt;members&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;cppFunction - identifier - (TRANSIENT)&quot;&gt;member&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;string&quot;&gt;&amp;quot;age&amp;quot;&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;Person&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppMemberField - identifier - (TRANSIENT)&quot;&gt;age&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;),&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;cppFunction - identifier - (TRANSIENT)&quot;&gt;member&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;string&quot;&gt;&amp;quot;name&amp;quot;&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;Person&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppMemberField - identifier - (TRANSIENT)&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;)&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;operator&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;operator&quot;&gt;}&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;comment&quot;&gt;//&amp;nbsp;end&amp;nbsp;of&amp;nbsp;namespace&amp;nbsp;meta&lt;/span&gt;&lt;/pre&gt;

&lt;p&gt;Note the &lt;code class=&quot;highlighter-rouge&quot;&gt;auto&lt;/code&gt; as the return type. You don’t want to write &lt;code class=&quot;highlighter-rouge&quot;&gt;std::tuple&amp;lt;Member&amp;lt;Person, std::string&amp;gt;, Member&amp;lt;Person, int&amp;gt;&amp;gt;&lt;/code&gt;, the compiler can just deduce it! Imagine the class with 50 members. The return type would be gigantic and the compiler does all the work for you.&lt;/p&gt;

&lt;p&gt;Okay, how do we make sure that this &lt;code class=&quot;highlighter-rouge&quot;&gt;registerMembers&amp;lt;T&amp;gt;&lt;/code&gt; function gets called? Simple! I just made class called &lt;a href=&quot;https://github.com/eliasdaler/MetaStuff/blob/master/include/detail/MetaHolder.h&quot;&gt;MetaHolder&lt;/a&gt;, which uses one nice trick. Let’s look at the implementation:&lt;/p&gt;

&lt;pre class=&quot;vs-code&quot;&gt;&lt;span class=&quot;preprocessor keyword&quot;&gt;#pragma&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;preprocessor keyword&quot;&gt;once&lt;/span&gt;

&lt;span class=&quot;preprocessor keyword&quot;&gt;#include&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;string&quot;&gt;&amp;lt;tuple&amp;gt;&lt;/span&gt;

&lt;span class=&quot;keyword&quot;&gt;namespace&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppNamespace - identifier - (TRANSIENT)&quot;&gt;meta&lt;/span&gt;
&lt;span class=&quot;operator&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;keyword&quot;&gt;namespace&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppNamespace - identifier - (TRANSIENT)&quot;&gt;detail&lt;/span&gt;
&lt;span class=&quot;operator&quot;&gt;{&lt;/span&gt;

&lt;span class=&quot;keyword&quot;&gt;template&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;typename&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;typename&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;TupleType&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppClassTemplate - identifier - (TRANSIENT)&quot;&gt;MetaHolder&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;{&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;TupleType&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppStaticMemberField - identifier - (TRANSIENT)&quot;&gt;members&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;char&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;*&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppStaticMemberFunction - identifier - (TRANSIENT)&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;()&lt;/span&gt;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;{&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppFunctionTemplate - identifier - (TRANSIENT)&quot;&gt;registerName&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;gt;();&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;operator&quot;&gt;};&lt;/span&gt;

&lt;span class=&quot;keyword&quot;&gt;template&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;typename&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;typename&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;TupleType&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;TupleType&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppClassTemplate - identifier - (TRANSIENT)&quot;&gt;MetaHolder&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;TupleType&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;gt;::&lt;/span&gt;&lt;span class=&quot;cppStaticMemberField - identifier - (TRANSIENT)&quot;&gt;members&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppFunctionTemplate - identifier - (TRANSIENT)&quot;&gt;registerMembers&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;gt;();&lt;/span&gt;

&lt;span class=&quot;operator&quot;&gt;}&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;comment&quot;&gt;//&amp;nbsp;end&amp;nbsp;of&amp;nbsp;namespace&amp;nbsp;detail&lt;/span&gt;
&lt;span class=&quot;operator&quot;&gt;}&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;comment&quot;&gt;//&amp;nbsp;end&amp;nbsp;of&amp;nbsp;namespace&amp;nbsp;meta&lt;/span&gt;&lt;/pre&gt;

&lt;p&gt;How do we force the instantiation of this template to get generated? Simple, we just use some function from namespace &lt;code class=&quot;highlighter-rouge&quot;&gt;meta&lt;/code&gt;! For example, if you call &lt;code class=&quot;highlighter-rouge&quot;&gt;meta::doForAllMembers&amp;lt;Person&amp;gt;&lt;/code&gt;, it will use &lt;code class=&quot;highlighter-rouge&quot;&gt;MetaHolder&amp;lt;Person, TupleType&amp;gt;&lt;/code&gt; class, which will get compiler to generate this class! Its tuple is initialized by calling &lt;code class=&quot;highlighter-rouge&quot;&gt;meta::registerMembers&amp;lt;Person&amp;gt;&lt;/code&gt;, when the initialization of &lt;code class=&quot;highlighter-rouge&quot;&gt;members&lt;/code&gt; tuple is performed. But wait, how do I get &lt;code class=&quot;highlighter-rouge&quot;&gt;TupleType&lt;/code&gt;? I get it from &lt;code class=&quot;highlighter-rouge&quot;&gt;registerMember&amp;lt;T&amp;gt;&lt;/code&gt; function! So, &lt;code class=&quot;highlighter-rouge&quot;&gt;TupleType = decltype(registerMembers&amp;lt;T&amp;gt;())&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;So, we get a function like this:&lt;/p&gt;

&lt;pre class=&quot;vs-code&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;template&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;typename&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;Class&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;auto&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;amp;&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppFunctionTemplate - identifier - (TRANSIENT)&quot;&gt;getMembers&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;operator&quot;&gt;{&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppNamespace - identifier - (TRANSIENT)&quot;&gt;detail&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;MetaHolder&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;Class&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;decltype&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;cppFunctionTemplate - identifier - (TRANSIENT)&quot;&gt;registerMembers&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;Class&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;gt;())&amp;gt;::&lt;/span&gt;&lt;span class=&quot;identifier&quot;&gt;members&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;operator&quot;&gt;}&lt;/span&gt;&lt;/pre&gt;

&lt;h3 id=&quot;doing-something-for-one-member&quot;&gt;Doing something for one member&lt;/h3&gt;

&lt;p&gt;Suppose we want to do some things only for member called “name” using MetaStuff:&lt;/p&gt;

&lt;pre class=&quot;vs-code&quot;&gt;&lt;span class=&quot;cppNamespace - identifier - (TRANSIENT)&quot;&gt;meta&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppFunction - identifier - (TRANSIENT)&quot;&gt;doForAllMembers&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;Person&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;gt;(&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;[&amp;amp;&lt;/span&gt;&lt;span class=&quot;cppLocalVariable - identifier - (TRANSIENT)&quot;&gt;person&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;](&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;auto&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;amp;&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppParameter - identifier - (TRANSIENT)&quot;&gt;member&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;)&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;{&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;cppParameter - identifier - (TRANSIENT)&quot;&gt;member&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;identifier&quot;&gt;getName&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;()&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;==&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;string&quot;&gt;&amp;quot;name&amp;quot;&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;)&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;{&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;cppNamespace - identifier - (TRANSIENT)&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppGlobalVariable - identifier - (TRANSIENT)&quot;&gt;cout&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppOperator - operator - (TRANSIENT)&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;string&quot;&gt;&amp;quot;Name&amp;nbsp;starts&amp;nbsp;with&amp;nbsp;&amp;quot;&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppParameter - identifier - (TRANSIENT)&quot;&gt;member&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;identifier&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;identifier&quot;&gt;person&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;)[&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;]&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;string&quot;&gt;&amp;#39;\n&amp;#39;&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;}&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;});&lt;/span&gt;&lt;/pre&gt;

&lt;p&gt;Sadly, this doesn’t work! Why? Because lambda gets generated for all registered types! Not just for strings, but for &lt;code class=&quot;highlighter-rouge&quot;&gt;Person::age&lt;/code&gt;, which is an &lt;code class=&quot;highlighter-rouge&quot;&gt;int&lt;/code&gt;. The code &lt;code class=&quot;highlighter-rouge&quot;&gt;member.get(person)[0]&lt;/code&gt; is not valid for &lt;code class=&quot;highlighter-rouge&quot;&gt;Member&lt;/code&gt; whose type is &lt;code class=&quot;highlighter-rouge&quot;&gt;int&lt;/code&gt;, so the compilation fails.&lt;/p&gt;

&lt;p&gt;We can use special &lt;code class=&quot;highlighter-rouge&quot;&gt;doForMember&lt;/code&gt; function, which will work well:&lt;/p&gt;

&lt;pre class=&quot;vs-code&quot;&gt;&lt;span class=&quot;cppNamespace - identifier - (TRANSIENT)&quot;&gt;meta&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppFunctionTemplate - identifier - (TRANSIENT)&quot;&gt;doForMember&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;Person&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppNamespace - identifier - (TRANSIENT)&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;gt;(&lt;/span&gt;&lt;span class=&quot;string&quot;&gt;&amp;quot;name&amp;quot;&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;[&amp;amp;&lt;/span&gt;&lt;span class=&quot;cppLocalVariable - identifier - (TRANSIENT)&quot;&gt;person&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;](&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;auto&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;amp;&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppParameter - identifier - (TRANSIENT)&quot;&gt;member&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;)&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;{&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;cppNamespace - identifier - (TRANSIENT)&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppGlobalVariable - identifier - (TRANSIENT)&quot;&gt;cout&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppOperator - operator - (TRANSIENT)&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;string&quot;&gt;&amp;quot;Name&amp;nbsp;starts&amp;nbsp;with&amp;nbsp;&amp;quot;&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppParameter - identifier - (TRANSIENT)&quot;&gt;member&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;identifier&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;cppLocalVariable - identifier - (TRANSIENT)&quot;&gt;person&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;)[&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;]&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;string&quot;&gt;&amp;#39;\n&amp;#39;&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;});&lt;/span&gt;&lt;/pre&gt;

&lt;p&gt;How does it work? With some SFINAE:&lt;/p&gt;

&lt;pre class=&quot;vs-code&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;template&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;bool&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;identifier&quot;&gt;Test&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;typename&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;F&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;typename&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;...&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;Args&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;typename&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppNamespace - identifier - (TRANSIENT)&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;enable_if_t&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;identifier&quot;&gt;Test&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppFunctionTemplate - identifier - (TRANSIENT)&quot;&gt;call_if&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;F&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppParameter - identifier - (TRANSIENT)&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;Args&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;amp;&amp;amp;...&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppParameter - identifier - (TRANSIENT)&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;operator&quot;&gt;{&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;cppParameter - identifier - (TRANSIENT)&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;cppNamespace - identifier - (TRANSIENT)&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;identifier&quot;&gt;forward&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;Args&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;gt;(&lt;/span&gt;&lt;span class=&quot;cppParameter - identifier - (TRANSIENT)&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;)...);&lt;/span&gt;
&lt;span class=&quot;operator&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;keyword&quot;&gt;template&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;bool&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;identifier&quot;&gt;Test&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;typename&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;F&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;typename&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;...&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;Args&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;typename&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;typename&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppFunctionTemplate - identifier - (TRANSIENT)&quot;&gt;call_if&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;F&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;comment&quot;&gt;/*&amp;nbsp;f&amp;nbsp;*/&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;Args&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;amp;&amp;amp;...&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;comment&quot;&gt;/*&amp;nbsp;args&amp;nbsp;*/&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;operator&quot;&gt;{&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;comment&quot;&gt;/*&amp;nbsp;do&amp;nbsp;nothing&amp;nbsp;*/&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;}&lt;/span&gt;&lt;/pre&gt;

&lt;p&gt;And then I do this in &lt;code class=&quot;highlighter-rouge&quot;&gt;doForMember&lt;/code&gt;:&lt;/p&gt;

&lt;pre class=&quot;vs-code&quot;&gt;&lt;span class=&quot;cppNamespace - identifier - (TRANSIENT)&quot;&gt;detail&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;identifier&quot;&gt;call_if&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;cppNamespace - identifier - (TRANSIENT)&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;is_same&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;MemberT&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;gt;::&lt;/span&gt;&lt;span class=&quot;identifier&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;gt;(&lt;/span&gt;&lt;span class=&quot;cppNamespace - identifier - (TRANSIENT)&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;identifier&quot;&gt;forward&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;F&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;gt;(&lt;/span&gt;&lt;span class=&quot;cppParameter - identifier - (TRANSIENT)&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;),&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppParameter - identifier - (TRANSIENT)&quot;&gt;member&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;);&lt;/span&gt;
&lt;/pre&gt;

&lt;p&gt;If &lt;code class=&quot;highlighter-rouge&quot;&gt;std::is_same&lt;/code&gt; returns &lt;code class=&quot;highlighter-rouge&quot;&gt;true&lt;/code&gt;, then &lt;code class=&quot;highlighter-rouge&quot;&gt;call_if&lt;/code&gt; with function call gets generated, otherwise &lt;code class=&quot;highlighter-rouge&quot;&gt;call_if&lt;/code&gt; function will be empty. Remember that “f” is most likely to be generic lambda, so if it doesn’t get called with some argument, then template instantiation for this type is not generated and everything works as expected.&lt;/p&gt;

&lt;h2 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h2&gt;

&lt;p&gt;And that’s mostly how MetaStuff works! The library is a bit more complicated than that, because it lets you register classes without default constructors, register getters and setters and more.&lt;/p&gt;

&lt;p&gt;The library is still very simple and needs much more work on it. But it’s certainly one of the hardest things I’ve ever written and I’m very proud of it. I’ve learned a lot about templates, and I hope you did too. Maybe this article even will inspire you to write your own library or start using MetaStuff for you projects.&lt;/p&gt;

&lt;p&gt;Thank you for reading!&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>Re:creation dev log. December 2016 - March 2017.</title>
   <link href="https://eliasdaler.github.io/re-creation-devlog-december-march/"/>
   <updated>2017-04-19T23:00:00+03:00</updated>
   <id>https://eliasdaler.github.io/re-creation-devlog-december-march</id>
   <content type="html">
&lt;p&gt;No posts in four months! And I haven’t worked on the game for the last one and a half. Is the project dead? No! Let’s pretend that nothing happened and I’ll show what I did since December and will tell about my future plans in the end.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/re_creation_dev_log_dec_march/child_parent.gif&quot; alt=&quot;Child-parent example&quot; /&gt;&lt;/p&gt;

&lt;!--more--&gt;
&lt;p&gt;&lt;a class=&quot;anchor&quot; id=&quot;read-more&quot;&gt;&lt;/a&gt;&lt;/p&gt;

&lt;h2 class=&quot;no_toc&quot; id=&quot;table-of-contents&quot;&gt;Table of contents&lt;/h2&gt;

&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#lots-of-work-moving-everything-to-lua&quot; id=&quot;markdown-toc-lots-of-work-moving-everything-to-lua&quot;&gt;Lots of work! Moving everything to Lua&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#gui&quot; id=&quot;markdown-toc-gui&quot;&gt;GUI&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#some-small-c-related-refactorings&quot; id=&quot;markdown-toc-some-small-c-related-refactorings&quot;&gt;Some small C++ related refactorings&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#levels-and-tile-maps&quot; id=&quot;markdown-toc-levels-and-tile-maps&quot;&gt;Levels and tile maps&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#child-parent-hierarchy-and-relative-transforms&quot; id=&quot;markdown-toc-child-parent-hierarchy-and-relative-transforms&quot;&gt;Child-parent hierarchy and relative transforms&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#other-small-things&quot; id=&quot;markdown-toc-other-small-things&quot;&gt;Other small things&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#conclusion-and-plans&quot; id=&quot;markdown-toc-conclusion-and-plans&quot;&gt;Conclusion and plans&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;lots-of-work-moving-everything-to-lua&quot;&gt;Lots of work! Moving everything to Lua&lt;/h2&gt;

&lt;p&gt;I moved a lot of code to Lua! For quite some time I thought that this didn’t make much sense or was very difficult, but turns out it’s easier as the more and more code gets moved to Lua. Here’s a comparison of lines of code between two dates.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;27.11.2016&lt;/strong&gt;&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;Language&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;files&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;blank&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;comment&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;code&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;C++&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;103&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;2420&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;533&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;13073&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Lua&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;116&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;510&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;154&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;5071&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;C/C++ header&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;123&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;1386&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;158&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;4315&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;&lt;strong&gt;22.02.2017&lt;/strong&gt;&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;Language&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;files&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;blank&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;comment&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;code&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;C++&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;109&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;1938&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;330&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;10590&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Lua&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;127&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;706&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;135&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;5167&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;C/C++ header&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;133&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;1296&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;90&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;4014&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;Note, that even though I’ve added a lot of new code, the resulting code is still smaller. And Lua code became larger just by 100 lines, even though I moved a lot of C++ code here! This may also look as a little work was done, but &lt;code class=&quot;highlighter-rouge&quot;&gt;git diff&lt;/code&gt; between commits made in December and March results in this:&lt;/p&gt;

&lt;pre&gt;460 files changed, 14486 insertions(+), 16035 deletions(-)&lt;/pre&gt;

&lt;p&gt;That’s a lot of changes!&lt;/p&gt;

&lt;p&gt;All game-specific components are now in Lua. For example, inventory, health components and others can be implemented in Lua efficiently because I don’t have to iterate them in tight loops in every frame. They’re mostly used for some basic logic and data storage. Only the following components are implemented in C++ now: Transform, Hierarchy, Graphics, Movement, Sound. As you can see, these components are pretty low-level and are mostly not tied to my game at all, which is great.
Here’s an example of a game specific component defined in Lua:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;
  &lt;pre&gt;&lt;code class=&quot;language-lua&quot; data-lang=&quot;lua&quot;&gt;&lt;span class=&quot;c1&quot;&gt;-- ItemComponent.lua&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Component&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Component&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ItemComponent&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Component&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;subclass&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;ItemComponent&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;ItemComponent&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;initialize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;Component&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;initialize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;ItemComponent&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;loadData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;description&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;description&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;iconName&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;iconName&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;onEquipFunc&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;onEquip&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;onUnequipFunc&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;onUnequip&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;useFunc&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;use&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;ItemComponent&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;use&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;itemOwner&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;useFunc&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;useFunc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;itemOwner&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;ItemComponent&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;onEquip&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;itemOwner&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;onEquipFunc&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;onEquipFunc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;itemOwner&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;ItemComponent&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;onUnequip&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;itemOwner&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;onUnequipFunc&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;onUnequipFunc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;itemOwner&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;ItemComponent&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;getIconName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;iconName&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ItemComponent&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/figure&gt;

&lt;p&gt;I also moved all of GUI logic to Lua too. The most complex GUI is dialogue GUI. It does a lot of stuff: it displays text character by character, speaking entity’s portrait; highlights some words, handles player’s choice in dialogues. I didn’t think that moving it to Lua would be real as the logic was pretty complex… but I managed to do it! Here’s a reminder of how many things happen in dialogues:
&lt;img src=&quot;/assets/re_creation_dev_log_dec_march/dialogue_cat.gif&quot; alt=&quot;Nine patch example&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Now &lt;code class=&quot;highlighter-rouge&quot;&gt;GuiState&lt;/code&gt; in C++ just iterates over all GUIs in GUI stack and just calls update and draw functions, not caring about game-specific things. Oh yeah, I now have GUI stack, so I can implement complex GUI’s which stack on top of each other (e.g. pause screen GUI on top of game GUI)&lt;/p&gt;

&lt;p&gt;By moving some components and all GUI stuff to Lua I finished a pretty important thing: all the game logic is in Lua now! Absolutely everything! This makes me incredibly happy and lets me easily implement new things without caring how Lua and C++ will interact. And another great thing is that the code is now easier to read and it 2-3 times smaller!&lt;/p&gt;

&lt;p&gt;I also implemented game mode stack in Lua, which was previously handled in C++. This means that I can easily create new game modes without touching any C++ code.&lt;/p&gt;

&lt;p&gt;This makes my engine a lot more generic and separates it from the game, which is great. This means that I can easily reuse my engine in other projects later: I’ll just have to change scripts and resources and most of the C++ code will remain the same. I will probably explain my current engine structure a bit later, once I’m 100% confident that it works great.&lt;/p&gt;

&lt;h2 id=&quot;gui&quot;&gt;GUI&lt;/h2&gt;

&lt;p&gt;Let’s talk about GUI a bit more. First of all, now there’s a good parent-child relation between elements. I store child offset relative to parent, so I can easily group and move things together. For example, a portrait of talker is a child of a dialogue window and its relative position to the border of the window is (6,8). So if I render the dialogue window at (100, 200), I’ll render the dialogue portait at (106, 208) by combining local child’s transform and parent’s transform.&lt;/p&gt;

&lt;p&gt;I also implemented nine-patch windows. Previously I just stored a big sprites of windows, but now I can just store them like this:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/re_creation_dev_log_dec_march/gui_nine_patch.png&quot; alt=&quot;Nine patch example&quot; /&gt;
and with some texture repeating, flipping and mirroring, I can get the dialogue window!
&lt;img src=&quot;/assets/re_creation_dev_log_dec_march/dialogue_window.png&quot; alt=&quot;Dialogue window&quot; /&gt;
This not only saves texture space, but also allows me to easily create windows of different sizes.&lt;/p&gt;

&lt;h2 id=&quot;some-small-c-related-refactorings&quot;&gt;Some small C++ related refactorings&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;Added lots of &lt;code class=&quot;highlighter-rouge&quot;&gt;const&lt;/code&gt; where possible. The game was const correct most of the time, but there are quite a few places where I made non-const local variables which don’t change or failed to make some member function const, which they later became with some effort. Turns out that most of the time the things stay constant and very few things change, that’s why having most of the stuff const is great: you can easily see things that &lt;strong&gt;do&lt;/strong&gt; change.&lt;/li&gt;
  &lt;li&gt;Stopped passing pointers in most functions and now pass everything by reference unless the pointer is really needed. A lot of this was in very old code, when I didn’t realize how perfect references are.&lt;/li&gt;
  &lt;li&gt;Started using &lt;code class=&quot;highlighter-rouge&quot;&gt;std::reference_wrapper&lt;/code&gt; instead of raw non-owning pointers for storing references to stuff in &lt;code class=&quot;highlighter-rouge&quot;&gt;std::vector&lt;/code&gt;. This is a very useful indicator of “hey, this is just a reference!”&lt;/li&gt;
  &lt;li&gt;Stopped handling each axis separately in some places, making changes like this:&lt;/li&gt;
&lt;/ul&gt;

&lt;figure class=&quot;highlight&quot;&gt;
  &lt;pre&gt;&lt;code class=&quot;language-c--&quot; data-lang=&quot;c++&quot;&gt;&lt;span class=&quot;n&quot;&gt;someX&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;otherX&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;someY&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;otherY&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/figure&gt;

&lt;p&gt;and now I do this instead:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;
  &lt;pre&gt;&lt;code class=&quot;language-c--&quot; data-lang=&quot;c++&quot;&gt;&lt;span class=&quot;n&quot;&gt;someVector&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;otherVector&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sf&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Vector2f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/figure&gt;

&lt;p&gt;I used a lot of vectors before, but there were still places where I did computations for each vector’s coordinate or stored coordinates in two variables. It was pretty dumb, because most of the time you do the same thing for both X and Y, and duplicating the same code is not smart.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Introduced lots of type aliases, for example &lt;code class=&quot;highlighter-rouge&quot;&gt;TileIndex&lt;/code&gt; instead of &lt;code class=&quot;highlighter-rouge&quot;&gt;sf::Vector2i&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;ComponentList&lt;/code&gt; instead of &lt;code class=&quot;highlighter-rouge&quot;&gt;std::vector&amp;lt;std::reference_wrapper&amp;lt;Component&amp;gt;&amp;gt;&lt;/code&gt; and so on (wish there were strong typedefs in C++!). This made code much more readable, because it leaves you with less information and most of the time I just don’t care about the underlying type, I care about it’s meaning.&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;levels-and-tile-maps&quot;&gt;Levels and tile maps&lt;/h2&gt;

&lt;p&gt;A huge effort was put into remaking tile map system. Previously each tile map was a grid of chunks (each 8x8 tiles in size). This allowed me to save some space by not having to store a lot of empty tiles. But the data structure was pretty complicated. I used &lt;code class=&quot;highlighter-rouge&quot;&gt;std::vector&amp;lt;std::vector&amp;lt;TilemapChunk&amp;gt;&amp;gt;&lt;/code&gt; and so if some chunks were stored in negative coordinates, I had to store index of top-left chunk and make sure to keep it in mind when accessing other chunks, because I couldn’t store negative indices in &lt;code class=&quot;highlighter-rouge&quot;&gt;std::vector&amp;lt;std::vector&amp;lt;TilemapChunk&amp;gt;&amp;gt;&lt;/code&gt;. So, if &lt;code class=&quot;highlighter-rouge&quot;&gt;minChunkIndex&lt;/code&gt; was (-10, -20), I found real index of (-3, -4) chunk in vector of vectors by removing &lt;code class=&quot;highlighter-rouge&quot;&gt;minChunkIndex&lt;/code&gt;: (-3, -4) - (-10, -20) = (7, 16)&lt;/p&gt;

&lt;p&gt;It wasn’t very good system for various reasons, so I implemented a simpler structure: &lt;code class=&quot;highlighter-rouge&quot;&gt;std::unordered_map&amp;lt;ChunkIndex, LevelChunk&amp;gt;&lt;/code&gt; (&lt;code class=&quot;highlighter-rouge&quot;&gt;ChunkIndex&lt;/code&gt; is &lt;code class=&quot;highlighter-rouge&quot;&gt;sf::Vector2i&lt;/code&gt;). Now I don’t have to store &lt;code class=&quot;highlighter-rouge&quot;&gt;minChunkIndex&lt;/code&gt; and formulas are simplified. I also don’t waste space on empty chunks, which is another advantage of new system. It’s similar to implementing sparse matrices: instead of having large 2D array, I only store elements which are not zero (not empty in case of tile chunks).&lt;/p&gt;

&lt;p&gt;I also improved a lot of level editor code by completely removing all duplication, encapsulation breaks, etc. I previously thought like this:”It’s just a development tool, it doesn’t have to have very good code!”, but turns out that code here matters very much too! First of all, duplication is always bad. Secondly, encapsulation breaks make changes to other classes much harder.&lt;/p&gt;

&lt;p&gt;Thankfully, there weren’t much such breaks and I actually made a post previously about how having &lt;code class=&quot;highlighter-rouge&quot;&gt;TileMap::setTile&lt;/code&gt; function saved me a lot of time, as I could easily change data structures of level without having to modify level editor code. But there were still some places in which I had to access some private parts of &lt;code class=&quot;highlighter-rouge&quot;&gt;TileMap&lt;/code&gt;. So I made a lot of getters and setters. And it made &lt;code class=&quot;highlighter-rouge&quot;&gt;TileMap&lt;/code&gt; class not properly encapsulated and much longer than it needed to be. So I found a great alternative.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://en.wikibooks.org/wiki/More_C%2B%2B_Idioms/Friendship_and_the_Attorney-Client&quot;&gt;Attorney-Client pattern&lt;/a&gt; is a great way of solving this problem. Basically, I let some encapsulation breaks by creating LevelModifier structure and making it a friend of TileMap and other level related classes. Now if I need to create an encapsulation breaking function, I create something like this:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;
  &lt;pre&gt;&lt;code class=&quot;language-c--&quot; data-lang=&quot;c++&quot;&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;LevelModifier&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;setTile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Tilemap&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;tilemap&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;cm&quot;&gt;/* other args */&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;...&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// can access private data members and member functions of TileMap&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/figure&gt;

&lt;p&gt;This function is static, so I can later call it in LevelEditor like this:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;
  &lt;pre&gt;&lt;code class=&quot;language-c--&quot; data-lang=&quot;c++&quot;&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;cm&quot;&gt;/* left mouse button clicked */&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;LevelModifier&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;setTile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tileMap&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;selectedTile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/figure&gt;

&lt;p&gt;Awesome. In fact, the number of such encapsulation functions is just 10. Pretty low and easily controllable. If I find myself in a situation where I had to change TileMap class considerably, I’ll be confident that I’ll have to deal with breaking changes in just a few functions.&lt;/p&gt;

&lt;p&gt;After this experience, I wondered how many functions of other classes I can make private. Previously I made them public by default for some reason, even if they were only called in member functions of this class. I managed to make quite a lot functions private without making significant changes to any code and improved encapsulation by doing so. There’s a small advantage to it: I can be sure that changing private function of the class won’t need many changes in other places.&lt;/p&gt;

&lt;p&gt;Back to levels. Previously all entity positions were stored in a level file and during level loading I just created each entity and placed them in the right spots of the map. This made some things pretty hard to load/save. I had to store position where entity spawned, I had to know if some entity will be saved to level file or not, etc.&lt;/p&gt;

&lt;p&gt;But then I realized one simple thing: what I considered “entity info” in level files was actually “spawn points info”. So if I just stored info about spawn points in tile map, I could then easily spawn entities with them later and also change them in level editor, instead of working with concrete entity instances. So, when I move entity in level editor, I don’t just move instance of this entity, but also its corresponding spawn point.&lt;/p&gt;

&lt;p&gt;It’s just separation of concerns. Entity doesn’t have to know about it’s spawn point most of the time. And when I save level, I don’t care about particular entities, I just care about spawn points. I can iterate through them and just save their properties. Restoring initial level state is also easier: I can just remove all entities and spawn new ones using spawn points.&lt;/p&gt;

&lt;p&gt;Trying to restore each entity’s initial state is more error prone. I guess this method of doing things explains bugs with saves in some games. In Fallout: New Vegas some NPCs may become hostile and attack you because of your actions, and after you reload your save, they may still attack you, even though in the loaded save state they were neutral to you! Probably this is explained by a bug when restoring entity’s state, if you reload the game, the game works as usual.&lt;/p&gt;

&lt;p&gt;I also started storing tile maps in JSON. Previously I stored them in a custom plain text format, but as the format got progressively harder to maintain (lots of parsing/saving code), I remade the whole thing in JSON. The code is much simpler to read and expand, so it’s great!&lt;/p&gt;

&lt;p&gt;Another thing I made is ability to hold mouse button down and paint tiles. Yes, this seems like a very easy thing to implement, but it wasn’t! I had to make sure that I could properly undo this action, create new level chunks on the fly, etc. And now I can easily create maps in any direction with this feature:
&lt;img src=&quot;/assets/re_creation_dev_log_dec_march/infinite_maps.gif&quot; alt=&quot;Infinite maps&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;child-parent-hierarchy-and-relative-transforms&quot;&gt;Child-parent hierarchy and relative transforms&lt;/h2&gt;

&lt;p&gt;Okay, if I made a more complex game, I would have made this a lot earlier, but here we go. Look at the gif:
&lt;img src=&quot;/assets/re_creation_dev_log_dec_march/child_parent.gif&quot; alt=&quot;Child-parent example&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Hat entity is a child of Renatus entity. Renatus is a child of moving platform entity. This simple hierarchy is easy to handle: the only thing that moves is a platform. It stores coordinate of Renatus relative to it and uses it for relative movement. As Renatus gets moved, the hat moves by the same offset as well. The system is very easy, I just traverse through hierarchy and apply the same movement delta to each entity.&lt;/p&gt;

&lt;p&gt;One small thing had given me lots of headache: sometimes the relative movement was a bit shaky. It was because of float rounding, the picture explains the problem:
&lt;img src=&quot;/assets/re_creation_dev_log_dec_march/floor_problem.png&quot; alt=&quot;Floor problem&quot; /&gt;
In the example both entities move by 0.2 pixels, but due to rounding on the screen, you can see a gap between the two appearing. This was unacceptable!&lt;/p&gt;

&lt;p&gt;Check out the &lt;a href=&quot;https://en.sfml-dev.org/forums/index.php?topic=21626&quot;&gt;thread I made about this&lt;/a&gt;, if you’re interested in my solution. There were some interesting points made in the thread as well.&lt;/p&gt;

&lt;h2 id=&quot;other-small-things&quot;&gt;Other small things&lt;/h2&gt;

&lt;p&gt;And here are some other small things which I don’t want to write about, but if you’re interested in some, feel free to ask about them!&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Previously all side animations had copies in a sprite sheet (e.g. left and right walking animations). Now I just flip them on GPU by setting texture rect’s width to be negative, when I want to flip animation. I’ll be doing the same with mirrored/rotated tiles a bit later.&lt;/li&gt;
  &lt;li&gt;Stupid collision optimization: I stopped checking collisions between static entities. There’s no need to check if static, unmovable tree collides with house or not. Both entities can’t move The number of collision checks reduced greatly in the result and collision is very fast now.&lt;/li&gt;
  &lt;li&gt;Started using entity handles (see &lt;a href=&quot;https://eliasdaler.github.io/game-object-references/&quot;&gt;my article&lt;/a&gt; about them)&lt;/li&gt;
  &lt;li&gt;Camera is an entity now. Of course, it has properties of an entity: transform, movement component, AI component (used for following the path). So I don’t have to rewrite the same code twice and can script all camera logic in Lua.&lt;/li&gt;
  &lt;li&gt;Started using seconds instead of milliseconds everywhere. &lt;code class=&quot;highlighter-rouge&quot;&gt;sf::Time::asSeconds&lt;/code&gt; returns a &lt;code class=&quot;highlighter-rouge&quot;&gt;float&lt;/code&gt;, while &lt;code class=&quot;highlighter-rouge&quot;&gt;sf::Time::asMilliseconds&lt;/code&gt; returns a rounded &lt;code class=&quot;highlighter-rouge&quot;&gt;int&lt;/code&gt; (usually 16, corresponding to 60 FPS), the results are terrible for pixel perfect games, especially during camera scrolling. It results in camera having non-smooth movement, which has been a problem I was trying to fix for ages and finally did with such a simple change. Here’s &lt;a href=&quot;https://plus.google.com/+flibitijibibo/posts/PysMth9Y5kN&quot;&gt;a post about the similar problem which FEZ apparently also had&lt;/a&gt; which inspired me to do this.&lt;/li&gt;
  &lt;li&gt;Made some multi-threading during loading. Basically, I can do most of the loading in another thread: sounds, scripts, level data, etc. But not textures, because OpenGL is not multi-threaded. The solution is simple: I load textures in RAM first and then move them to GPU in a main thread. It blocks the main thread, but it’s pretty fast and not really noticeable.&lt;/li&gt;
  &lt;li&gt;Worked on diagonal collision. I previously worked on it, but it was very buggy, as the player could get stuck between tiles (I noticed that some SNES and GBA games have this problem, e.g. Earthbound, Mother 3). But I fixed it! I hope that I’ll never have to deal with tile collision in the near future. It’s so hard!
&lt;img src=&quot;/assets/re_creation_dev_log_dec_march/tile_collision.gif&quot; alt=&quot;Tile collision&quot; /&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;There are probably a lot of things I missed, but I hope that it’s enough to show you how much stuff I’ve done.&lt;/p&gt;

&lt;h2 id=&quot;conclusion-and-plans&quot;&gt;Conclusion and plans&lt;/h2&gt;

&lt;p&gt;This semester is very intense. Lots of homework, project assignments and so on. This was the reason I stopped working on a game for a 1.5 months and probably won’t be working on it for another two and a half. In the meantime, I will be doing small things about the game which don’t require coding: improve plot, think about game mechanics and puzzles, limit my scope, etc. I also plan to read stuff about game development and think how I can further improve my code and engine structure. It’s not the main priority now, however. I’m mostly happy with most of my code and don’t think that a huge changes will come.&lt;/p&gt;

&lt;p&gt;What I want to have in the future is a stable foundation. You know, just some level with a lot of things going on: AI, NPCs, complex tile map, basic combat, particles and so on. A vertical slice of the game, working just fine. The confidence in the code base: that it works well and doesn’t require me write a lot of boilerplate code and that I’m not limited by it. Good resource system, neat organization in files, smooth content creation and so on.&lt;/p&gt;

&lt;p&gt;These are some things which take a lot of time, but once they’re achieved, they can provide a lot of confidence and comfort in the future and save me from having to change a lot of things at once.&lt;/p&gt;

&lt;p&gt;Don’t worry about the project: I’ve taken a few breaks from it before and coming back was as exciting as ever. As the time goes on, I don’t lose any motivation or confidence in it, in fact I love it more and more. And some of you may be disappointed in my slow progress, and I’m sorry for it, but not rushing is what makes it such a nice experience for me. And hey, even if you don’t get the playable game in the end, you can still learn something from my dev logs and tutorials. If I didn’t spend lots of time reiterating, researching, refactoring, I would have never figured out a lot of things which helped a lot of people.
One more thing: art, dialogue, plot, atmosphere and whole concept just got a lot better as the time went by. If I finished the game with the art, plot and gameplay it had two years ago, it would not be very good. But as my skills improve, I apply them to the game and make it considerably better than before.&lt;/p&gt;

&lt;p&gt;Thanks for reading!&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>Making and storing references to game objects (entities) in C++ and Lua</title>
   <link href="https://eliasdaler.github.io/game-object-references/"/>
   <updated>2017-01-22T14:00:00+03:00</updated>
   <id>https://eliasdaler.github.io/game-object-references</id>
   <content type="html">&lt;h1 id=&quot;table-of-contents&quot;&gt;Table of Contents&lt;/h1&gt;
&lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;#introduction&quot;&gt;Introduction&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=&quot;#shared_ptr-and-weak_ptr&quot;&gt;shared_ptr and weak_ptr&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=&quot;#using-unique-ids&quot;&gt;Using unique ids&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=&quot;#storing-references-to-entities-in-lua&quot;&gt;Storing references to entities in Lua&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=&quot;#conclusion&quot;&gt;Conclusion&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;introduction&quot;&gt;Introduction&lt;/h1&gt;

&lt;p&gt;&lt;img src=&quot;/assets/ids.png&quot; alt=&quot;Ids&quot; style=&quot;display:block; margin: 0 auto;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;The problem of handling references to game objects (I’ll call them &lt;em&gt;entities&lt;/em&gt;) comes up very often. Sometimes it’s child-parent relationship between the entities, sometimes it’s useful to store a reference to an object in event data, some task scheduling class and so on.&lt;/p&gt;

&lt;p&gt;Sometimes a simple pointer, reference or &lt;code class=&quot;highlighter-rouge&quot;&gt;std::reference_wrapper&lt;/code&gt; is enough. But the problem with raw pointers and references is that once you use them, you have to make sure that the entity which is being referenced stays alive and is not moved in memory without notifying objects which hold references. And with good design you’ll probably be able to achieve that.&lt;/p&gt;

&lt;p&gt;But stale pointers/references give some of the worst bugs, which are difficult to track, crash your game and may not be easily identifiable. Some entities may start to occupy different addresses in memory (for example, after you reload a level and decide to create all entities from scratch). While it’s possible to manually update all pointers to previously referenced entities, it’s certainly will be better to do so automatically and without a chance of forgetting some pointers which will be stale.&lt;/p&gt;

&lt;p&gt;Let’s see all these problems can be solved. The latest solution (about storing references to Lua) was discovered by me not long ago and it is the point of me writing the article, but I want to show some other ways of solving the problem. Let’s start!&lt;/p&gt;

&lt;!--more--&gt;
&lt;p&gt;&lt;a class=&quot;anchor&quot; id=&quot;read-more&quot;&gt;&lt;/a&gt;&lt;/p&gt;

&lt;h1 id=&quot;shared_ptr-and-weak_ptr&quot;&gt;shared_ptr and weak_ptr&lt;/h1&gt;

&lt;p&gt;Some of the problems with raw references can be solved with &lt;code class=&quot;highlighter-rouge&quot;&gt;std::shared_ptr&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;std::weak_ptr&lt;/code&gt;. First, you create your entities as with &lt;code class=&quot;highlighter-rouge&quot;&gt;std::make_shared&lt;/code&gt;. After that you’ll create all references to it with &lt;code class=&quot;highlighter-rouge&quot;&gt;std::weak_ptr&lt;/code&gt;s which won’t affect your entity’s lifetime. After that you can use &lt;code class=&quot;highlighter-rouge&quot;&gt;std::weak_ptr&amp;lt;T&amp;gt;::expired&lt;/code&gt; function to check if the reference is still valid.&lt;/p&gt;

&lt;p&gt;The solution is not perfect. First of all, it requires you to create all your entities as &lt;code class=&quot;highlighter-rouge&quot;&gt;shared_ptr&lt;/code&gt;s which may have some significant overhead compared to &lt;code class=&quot;highlighter-rouge&quot;&gt;unique_ptr&lt;/code&gt;s. And after all, it’s better for the lifetime of entities not to be shared and that semantic is better expressed with &lt;code class=&quot;highlighter-rouge&quot;&gt;unique_ptr&lt;/code&gt;. Shared pointers also don’t solve the problem of moving entities in memory: you can’t swap what’s inside the &lt;code class=&quot;highlighter-rouge&quot;&gt;shared_ptr&lt;/code&gt; and have all &lt;code class=&quot;highlighter-rouge&quot;&gt;weak_ptr&lt;/code&gt;s automatically update their pointers.&lt;/p&gt;

&lt;h1 id=&quot;using-unique-ids&quot;&gt;Using unique ids&lt;/h1&gt;

&lt;p&gt;One solution to the problem is just creating unique ids for entities and storing those ids instead of raw pointers or references. There a lots of ways to generate and represent entity ids. Ids can just be integers with &lt;code class=&quot;highlighter-rouge&quot;&gt;EntityManager&lt;/code&gt; having a counter which will be incremented as new entities are created: the first entity will get id=0, the second one id=1 and so on. Another way to generate ids is to use some hashing algorithm or &lt;a href=&quot;https://en.wikipedia.org/wiki/Universally_unique_identifier&quot;&gt;UUID&lt;/a&gt;s. No matter what, your ids should stay unique, unless you add some additional info (like entity creation time or some tags) to your id.&lt;/p&gt;

&lt;p&gt;Here’s how your &lt;code class=&quot;highlighter-rouge&quot;&gt;EntityManager&lt;/code&gt; class may look:&lt;/p&gt;
&lt;pre class=&quot;vs-code&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;EntityManager&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;:&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;Entity&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;*&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppMemberFunction - identifier - (TRANSIENT)&quot;&gt;getEntity&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;EntityId&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppParameter - identifier - (TRANSIENT)&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;)&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;bool&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppMemberFunction - identifier - (TRANSIENT)&quot;&gt;entityExists&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;EntityId&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppParameter - identifier - (TRANSIENT)&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;)&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;comment&quot;&gt;//&amp;nbsp;...&lt;/span&gt;
&lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;:&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;cppNamespace - identifier - (TRANSIENT)&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;unordered_map&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;EntityId&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppNamespace - identifier - (TRANSIENT)&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;unique_ptr&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;Entity&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;gt;&amp;gt;&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppMemberField - identifier - (TRANSIENT)&quot;&gt;entities&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;comment&quot;&gt;//&amp;nbsp;...&lt;/span&gt;
&lt;span class=&quot;operator&quot;&gt;};&lt;/span&gt;&lt;/pre&gt;

&lt;p&gt;Using ids also helps with recreation problem: you can easily reload/recreate the entity and just assign the same id to it as before. It will have a different adress in memory, but the next time someone calls &lt;code class=&quot;highlighter-rouge&quot;&gt;getEntity&lt;/code&gt; the updated entity is returned. You can also easily send these ids over the network or save them in your save files.&lt;/p&gt;

&lt;p&gt;Your code when using entity id becomes something like this:&lt;/p&gt;

&lt;pre class=&quot;vs-code&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;auto&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppLocalVariable&quot;&gt;entityPtr&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppGlobalVariable&quot;&gt;g_EntityManager&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;cppMemberFunction&quot;&gt;getEntity&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;cppLocalVariable&quot;&gt;entityId&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;cppLocalVariable&quot;&gt;entityPtr&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;cppMemberFunction&quot;&gt;doSomething&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;();&lt;/span&gt;&lt;/pre&gt;

&lt;p&gt;Of course this creates some overhead because you now have a layer of indirection: you have to search &lt;code class=&quot;highlighter-rouge&quot;&gt;unordered_map&lt;/code&gt; inside the &lt;code class=&quot;highlighter-rouge&quot;&gt;EntityManager&lt;/code&gt; to get the raw reference to the entity, but if you don’t do it too often (and you most likely won’t), you’ll be fine!&lt;/p&gt;

&lt;p&gt;There’s another improvement which can be done: you can wrap your id inside the struct and then overload &lt;code class=&quot;highlighter-rouge&quot;&gt;operator-&amp;gt;&lt;/code&gt; for handle to act like a raw pointer:&lt;/p&gt;

&lt;pre class=&quot;vs-code&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;EntityHandle&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;{&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;EntityId&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppMemberField - identifier - (TRANSIENT)&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;EntityManager&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;*&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppMemberField - identifier - (TRANSIENT)&quot;&gt;entityManager&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;cppMemberFunction - identifier - (TRANSIENT)&quot;&gt;EntityHandle&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;EntityId&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppParameter - identifier - (TRANSIENT)&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;EntityManager&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;*&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppParameter - identifier - (TRANSIENT)&quot;&gt;entityManager&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;)&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;:&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;cppMemberField - identifier - (TRANSIENT)&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;cppParameter - identifier - (TRANSIENT)&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;),&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppMemberField - identifier - (TRANSIENT)&quot;&gt;entityManager&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;cppParameter - identifier - (TRANSIENT)&quot;&gt;entityManager&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;)&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;{}&lt;/span&gt;

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;Entity&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;*&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppMemberOperator - keyword - (TRANSIENT)&quot;&gt;operator&lt;/span&gt;&lt;span class=&quot;cppMemberOperator - operator - (TRANSIENT)&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;()&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;{&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppMemberFunction - identifier - (TRANSIENT)&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;();&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;}&lt;/span&gt;

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;Entity&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;*&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppMemberFunction - identifier - (TRANSIENT)&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;()&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;{&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;cppMacro - identifier - (TRANSIENT)&quot;&gt;assert&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;cppMemberField - identifier - (TRANSIENT)&quot;&gt;entityManager&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;identifier&quot;&gt;entityExists&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;cppMemberField - identifier - (TRANSIENT)&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;));&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppMemberField - identifier - (TRANSIENT)&quot;&gt;entityManager&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;cppMemberFunction - identifier - (TRANSIENT)&quot;&gt;getEntity&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;cppMemberField - identifier - (TRANSIENT)&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;);&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;operator&quot;&gt;};&lt;/span&gt;&lt;/pre&gt;

&lt;p&gt;Now you can do things like this:&lt;/p&gt;

&lt;pre class=&quot;vs-code&quot;&gt;&lt;span class=&quot;cppType&quot;&gt;EntityHandle&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppLocalVariable&quot;&gt;handle&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;cppLocalVariable&quot;&gt;someEntityId&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;cppGlobalVariable&quot;&gt;g_EntityManager&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;cppLocalVariable&quot;&gt;handle&lt;/span&gt;&lt;span class=&quot;cppMemberOperator&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;cppMemberFunction&quot;&gt;doSomething&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;();&lt;/span&gt;

&lt;span class=&quot;comment&quot;&gt;//&amp;nbsp;or...&lt;/span&gt;

&lt;span class=&quot;keyword&quot;&gt;auto&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppLocalVariable&quot;&gt;entityPtr&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppLocalVariable&quot;&gt;handle&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;cppMemberFunction&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;cppLocalVariable&quot;&gt;entityPtr&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;cppMemberFunction&quot;&gt;doSomething&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;();&lt;/span&gt;&lt;/pre&gt;

&lt;p&gt;Notice that we also get some error checking with assert which checks validity of the reference.
Great! Now let’s see how we can reference entities in Lua scripts.&lt;/p&gt;

&lt;h1 id=&quot;storing-references-to-entities-in-lua&quot;&gt;Storing references to entities in Lua&lt;/h1&gt;

&lt;p class=&quot;message&quot;&gt;Full implementation can be found here: &lt;i class=&quot;fa fa-github&quot; aria-hidden=&quot;true&quot;&gt;&lt;/i&gt;&lt;a href=&quot;https://gist.github.com/eliasdaler/f5c2ee50fc7e42bf3ee18ad7d46d18f8&quot;&gt;C++ part&lt;/a&gt;, &lt;i class=&quot;fa fa-github&quot; aria-hidden=&quot;true&quot;&gt;&lt;/i&gt;&lt;a href=&quot;https://gist.github.com/eliasdaler/f3516d3deabc32b465a7c244ff082cf0&quot;&gt;Lua part&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;First of all, it’s obvious that you can use the same approach in Lua. Your handle can just be a number or a table with &lt;code class=&quot;highlighter-rouge&quot;&gt;__index&lt;/code&gt; meta-method so that you can use your handle as if it was the raw reference. But there’s a neater method I recently came up with. Let’s see how it works.&lt;/p&gt;

&lt;p&gt;First of all, our handles will be tables with raw C++ references stored in them as userdata. They’ll also have a bool named &lt;code class=&quot;highlighter-rouge&quot;&gt;isValid&lt;/code&gt; which will help us test if the handle is still valid. We’ll also have a global table of references in Lua, so that you can easily get handle from any place without calling C++. What’s neat is that you’ll get &lt;strong&gt;references&lt;/strong&gt; to your handles, not a copy. It’s great, because you can easily compare two handles or even use them as table keys. You also don’t waste your memory, but that’s not a big concern as our handles are very light.&lt;/p&gt;

&lt;p&gt;If you want to remove and recreate some entity, you’ll just have to notify the main Lua handle which will be stored inside some global Lua table. And because all your handles in Lua will be references to original handle you won’t have to care about them: once you update the main handle, it’s updated everywhere.&lt;/p&gt;

&lt;p&gt;Another good thing is that once the entity is removed, we can just set &lt;code class=&quot;highlighter-rouge&quot;&gt;isValid&lt;/code&gt; to &lt;code class=&quot;highlighter-rouge&quot;&gt;false&lt;/code&gt; and raw reference to &lt;code class=&quot;highlighter-rouge&quot;&gt;nil&lt;/code&gt; just to be extra safe.&lt;/p&gt;

&lt;p&gt;Let’s get to implementation! We’ll use &lt;i class=&quot;fa fa-github&quot; aria-hidden=&quot;true&quot;&gt;&lt;/i&gt;&lt;a href=&quot;https://github.com/ThePhD/sol2&quot;&gt;sol2&lt;/a&gt; as our Lua/C++ binding library. Let’s write a simple &lt;code class=&quot;highlighter-rouge&quot;&gt;Entity&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;EntityManager&lt;/code&gt; classes for testing:&lt;/p&gt;

&lt;pre class=&quot;vs-code&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;using&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;EntityId&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;Entity&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;:&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;explicit&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppMemberFunction - identifier - (TRANSIENT)&quot;&gt;Entity&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;EntityId&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppParameter - identifier - (TRANSIENT)&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;)&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;:&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;cppMemberField - identifier - (TRANSIENT)&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;string&quot;&gt;&amp;quot;John&amp;quot;&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;),&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppMemberField - identifier - (TRANSIENT)&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;cppParameter - identifier - (TRANSIENT)&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;)&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;{}&lt;/span&gt;

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppNamespace - identifier - (TRANSIENT)&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;amp;&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppMemberFunction - identifier - (TRANSIENT)&quot;&gt;getName&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;()&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;{&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppMemberField - identifier - (TRANSIENT)&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;}&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppMemberFunction - identifier - (TRANSIENT)&quot;&gt;setName&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppNamespace - identifier - (TRANSIENT)&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;amp;&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppParameter - identifier - (TRANSIENT)&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;)&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;{&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppMemberField - identifier - (TRANSIENT)&quot;&gt;name&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppMemberOperator - operator - (TRANSIENT)&quot;&gt;=&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppParameter - identifier - (TRANSIENT)&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;}&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;EntityId&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppMemberFunction - identifier - (TRANSIENT)&quot;&gt;getId&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;()&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;{&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppMemberField - identifier - (TRANSIENT)&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;:&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;cppNamespace - identifier - (TRANSIENT)&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;string&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppMemberField - identifier - (TRANSIENT)&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;EntityId&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppMemberField - identifier - (TRANSIENT)&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;operator&quot;&gt;};&lt;/span&gt;

&lt;span class=&quot;cppNamespace - identifier - (TRANSIENT)&quot;&gt;sol&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;state&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppGlobalVariable - identifier - (TRANSIENT)&quot;&gt;lua&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;comment&quot;&gt;//&amp;nbsp;globals&amp;nbsp;are&amp;nbsp;bad,&amp;nbsp;but&amp;nbsp;we&amp;#39;ll&amp;nbsp;use&amp;nbsp;it&amp;nbsp;for&amp;nbsp;simpler&amp;nbsp;implementation&lt;/span&gt;

&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;EntityManager&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;:&lt;/span&gt;&amp;nbsp;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;cppMemberFunction - identifier - (TRANSIENT)&quot;&gt;EntityManager&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;()&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;:&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppMemberField - identifier - (TRANSIENT)&quot;&gt;idCounter&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;)&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;{}&lt;/span&gt;

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;Entity&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;amp;&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppMemberFunction - identifier - (TRANSIENT)&quot;&gt;createEntity&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;()&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;{&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;auto&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppLocalVariable - identifier - (TRANSIENT)&quot;&gt;id&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppMemberField - identifier - (TRANSIENT)&quot;&gt;idCounter&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;cppMemberField - identifier - (TRANSIENT)&quot;&gt;idCounter&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;auto&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppLocalVariable - identifier - (TRANSIENT)&quot;&gt;inserted&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppMemberField - identifier - (TRANSIENT)&quot;&gt;entities&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;cppMemberFunction - identifier - (TRANSIENT)&quot;&gt;emplace&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;cppLocalVariable - identifier - (TRANSIENT)&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppNamespace - identifier - (TRANSIENT)&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppFunction - identifier - (TRANSIENT)&quot;&gt;make_unique&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;Entity&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;gt;(&lt;/span&gt;&lt;span class=&quot;cppLocalVariable - identifier - (TRANSIENT)&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;));&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;auto&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppLocalVariable - identifier - (TRANSIENT)&quot;&gt;it&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppLocalVariable - identifier - (TRANSIENT)&quot;&gt;inserted&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;cppMemberField - identifier - (TRANSIENT)&quot;&gt;first&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;comment&quot;&gt;//&amp;nbsp;iterator&amp;nbsp;to&amp;nbsp;created&amp;nbsp;id/Entity&amp;nbsp;pair&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;auto&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;amp;&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppLocalVariable - identifier - (TRANSIENT)&quot;&gt;e&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppMemberOperator - operator - (TRANSIENT)&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;cppLocalVariable - identifier - (TRANSIENT)&quot;&gt;it&lt;/span&gt;&lt;span class=&quot;cppMemberOperator - operator - (TRANSIENT)&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;cppMemberField - identifier - (TRANSIENT)&quot;&gt;second&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;comment&quot;&gt;//&amp;nbsp;created&amp;nbsp;entity&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;cppGlobalVariable - identifier - (TRANSIENT)&quot;&gt;lua&lt;/span&gt;&lt;span class=&quot;cppMemberOperator - operator - (TRANSIENT)&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;string&quot;&gt;&amp;quot;createHandle&amp;quot;&lt;/span&gt;&lt;span class=&quot;cppMemberOperator - operator - (TRANSIENT)&quot;&gt;](&lt;/span&gt;&lt;span class=&quot;cppLocalVariable - identifier - (TRANSIENT)&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;cppMemberOperator - operator - (TRANSIENT)&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppLocalVariable - identifier - (TRANSIENT)&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;}&lt;/span&gt;

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppMemberFunction - identifier - (TRANSIENT)&quot;&gt;removeEntity&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;EntityId&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppParameter - identifier - (TRANSIENT)&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;)&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;{&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;cppGlobalVariable - identifier - (TRANSIENT)&quot;&gt;lua&lt;/span&gt;&lt;span class=&quot;cppMemberOperator - operator - (TRANSIENT)&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;string&quot;&gt;&amp;quot;onEntityRemoved&amp;quot;&lt;/span&gt;&lt;span class=&quot;cppMemberOperator - operator - (TRANSIENT)&quot;&gt;](&lt;/span&gt;&lt;span class=&quot;cppParameter - identifier - (TRANSIENT)&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;cppMemberOperator - operator - (TRANSIENT)&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;cppMemberField - identifier - (TRANSIENT)&quot;&gt;entities&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;cppMemberFunction - identifier - (TRANSIENT)&quot;&gt;erase&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;cppParameter - identifier - (TRANSIENT)&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;);&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;operator&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;:&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;cppNamespace - identifier - (TRANSIENT)&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;unordered_map&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;EntityId&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppNamespace - identifier - (TRANSIENT)&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;unique_ptr&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;Entity&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;gt;&amp;gt;&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppMemberField - identifier - (TRANSIENT)&quot;&gt;entities&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span class=&quot;cppType - identifier - (TRANSIENT)&quot;&gt;EntityId&lt;/span&gt;&amp;nbsp;&lt;span class=&quot;cppMemberField - identifier - (TRANSIENT)&quot;&gt;idCounter&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;operator&quot;&gt;};&lt;/span&gt;&lt;/pre&gt;

&lt;p&gt;Here’s how we will create our handle in Lua:&lt;/p&gt;

&lt;div class=&quot;language-lua highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;createHandle&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cppRef&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;handle&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;cppRef&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cppRef&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;isValid&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;setmetatable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;handle&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;mt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;Handles&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cppRef&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;getId&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;handle&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;handle&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The &lt;code class=&quot;highlighter-rouge&quot;&gt;Handles&lt;/code&gt; global table stores all handles so that we can easily get them later. As you can see, we still use integer ids for it as a tables key so that when we remove an entity, we can easily find its handle and modify it appropriately.&lt;/p&gt;

&lt;p&gt;The metatable has an important function: it will let us use the handle as if it was the original reference. Here’s how it’s written:&lt;/p&gt;

&lt;div class=&quot;language-lua highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;mt&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;mt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;__index&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;handle&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;handle&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;isValid&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then&lt;/span&gt;
        &lt;span class=&quot;nb&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;debug.traceback&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;())&lt;/span&gt;
        &lt;span class=&quot;nb&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Error: handle is not valid!&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;handle&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Entity&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;](&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;handle&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cppRef&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Just a quick reminder: metatable’s &lt;code class=&quot;highlighter-rouge&quot;&gt;__index&lt;/code&gt; function gets called when the key in the table is not found and the table (our handle) and missing key are passed.&lt;/p&gt;

&lt;p&gt;Here’s an example of how it all works. When we do this:&lt;/p&gt;

&lt;div class=&quot;language-lua highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;handle&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;setName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;John&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Lua checks if handle table has “setName” key, but it doesn’t, so it calls metatable’s &lt;code class=&quot;highlighter-rouge&quot;&gt;__index&lt;/code&gt; function with handle and “John” as parameters. The wrapper around &lt;code class=&quot;highlighter-rouge&quot;&gt;Entity&lt;/code&gt;’s member function is returned and it gets called. The function which gets returned is a closure which calls the &lt;code class=&quot;highlighter-rouge&quot;&gt;Entity&lt;/code&gt;’s class member function on original raw reference. Why can’t we just return &lt;code class=&quot;highlighter-rouge&quot;&gt;Entity[key]&lt;/code&gt;? The problem with that is that our handle will get passed into it while the function expects raw reference to be passed (&lt;code class=&quot;highlighter-rouge&quot;&gt;cppRef:setName(&quot;John&quot;)&lt;/code&gt; is the same as calling &lt;code class=&quot;highlighter-rouge&quot;&gt;Entity.setName(cppRef, &quot;John&quot;)&lt;/code&gt;).&lt;/p&gt;

&lt;p&gt;The error checking that we have here is extremely important and useful! It allows us to easily debug problems with our code: we even print the call stack to find the place where our code crashed!&lt;/p&gt;
&lt;p class=&quot;message&quot;&gt;
Notice that we pass &quot;2&quot; as the second argument in `error` function. It tells it that the problem is not the function which called it, the bad one was below it in a call stack.
&lt;/p&gt;

&lt;p&gt;Another great thing about this implementation is that it lets us handle error on Lua side, not C++ side. Once the C++ function is called from Lua, it’s hard to properly throw and catch an error from C++. You’ll have to compile Lua as C++ to do it without a crash. Throwing the error before calling C++ allows us to safely catch it on Lua side and handle it appropriately. We’ll see how it can be done a bit later.&lt;/p&gt;

&lt;p&gt;Let’s test out reference first:&lt;/p&gt;

&lt;div class=&quot;language-lua highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;test&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cppRef&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;handle&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;createHandle&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cppRef&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;testHandle&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;handle&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;testHandle&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;handle&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Hello, my name is &quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;..&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;handle&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;getName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;())&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;handle&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;setName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Mark&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;My name is &quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;..&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;handle&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;getName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;..&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot; now!&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Output:&lt;/p&gt;

&lt;pre style=&quot;background-color:black;color:white&quot;&gt;Hello, my name is John
My name is Mark now!&lt;/pre&gt;

&lt;p&gt;It works! What should we do when entity gets removed? Let’s create a function for that:&lt;/p&gt;

&lt;div class=&quot;language-lua highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;onEntityRemoved&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;handle&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Handles&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;handle&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cppRef&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;nil&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;handle&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;isValid&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;false&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;Handles&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;nil&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We need to call it before our entity gets removed and you can place it into &lt;code class=&quot;highlighter-rouge&quot;&gt;Entity&lt;/code&gt;’s destructor or into &lt;code class=&quot;highlighter-rouge&quot;&gt;EntityManager&lt;/code&gt;’s &lt;code class=&quot;highlighter-rouge&quot;&gt;removeEntity&lt;/code&gt; function. Note, that this doesn’t remove the handle itself: someone may still be referencing it, but setting corresponding value in &lt;code class=&quot;highlighter-rouge&quot;&gt;Handles&lt;/code&gt; table to &lt;code class=&quot;highlighter-rouge&quot;&gt;nil&lt;/code&gt; is still useful because if someone tries to grab a handle later, &lt;code class=&quot;highlighter-rouge&quot;&gt;nil&lt;/code&gt; will be returned. What’s more important is that &lt;code class=&quot;highlighter-rouge&quot;&gt;isValid&lt;/code&gt; is set to false so that the next time someone tries to use the handle, the error will be raised.&lt;/p&gt;

&lt;p&gt;Now let’s see what happens when we try to use invalid reference. We can even do our error handling in Lua now!&lt;/p&gt;

&lt;div class=&quot;language-lua highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;testBadReference&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;handle&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Handles&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;-- this handle exists and is okay&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;handle&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;isValid&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;false&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;-- but suppose that entity was removed!&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;err&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;pcall&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;testHandle&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;handle&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;err&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then&lt;/span&gt;
        &lt;span class=&quot;nb&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;err&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;When we call this function from C++ we don’t get a crash which would have been caused by using stale reference. Instead, we get a helpful error message and call stack:&lt;/p&gt;
&lt;pre style=&quot;background-color:black;color:white&quot;&gt;stack traceback:
    script.lua:23: in function 'getName'
    script.lua:57: in function &amp;lt;script.lua:56&amp;gt;
    [C]: in function 'pcall'
    script.lua:65: in function &amp;lt;script.lua:62&amp;gt;
script.lua:57: Error: handle is not valid!&lt;/pre&gt;

&lt;p&gt;What about the performance? My tests show that it’s around &lt;strong&gt;600 nanoseconds&lt;/strong&gt; per C++ member function call. It’s not that bad, but still may be not good enough for some people. In that case it’s easy to get a raw reference and then use it without any additional overhead of error checking:&lt;/p&gt;

&lt;div class=&quot;language-lua highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rawRef&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;handle&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cppRef&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Raw reference used. Name: &quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;..&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rawRef&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;getName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;())&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We can also speed up &lt;code class=&quot;highlighter-rouge&quot;&gt;__index&lt;/code&gt; function. I’ve found that its biggest overhead is creating a closure every time… so let’s memoize our wrapper functions! First of all, we’ll create a table which will store our wrapper functions:&lt;/p&gt;

&lt;div class=&quot;language-lua highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;memoizedFuncs&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And then we change our &lt;code class=&quot;highlighter-rouge&quot;&gt;__index&lt;/code&gt; method to this:&lt;/p&gt;

&lt;div class=&quot;language-lua highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;mt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;__index&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;handle&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;handle&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;isValid&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then&lt;/span&gt;
        &lt;span class=&quot;nb&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;debug.traceback&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;())&lt;/span&gt;
        &lt;span class=&quot;nb&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Error: handle is not valid!&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

    &lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;memoizedFuncs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;handle&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Entity&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;](&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;handle&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cppRef&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;memoizedFuncs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The closure for each function will be created once and then will get reused. This speeds up things considerably! The overhead is roughly &lt;strong&gt;200 nanoseconds&lt;/strong&gt; per call.&lt;/p&gt;

&lt;p&gt;What else? Calling the function through &lt;code class=&quot;highlighter-rouge&quot;&gt;__index&lt;/code&gt; produces additional overhead too. Suppose that we use &lt;code class=&quot;highlighter-rouge&quot;&gt;getName&lt;/code&gt; function very often and want it to be part of our handle table so that it’s called directly. Ok, let’s do this!&lt;/p&gt;

&lt;div class=&quot;language-lua highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;createHandle&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cppRef&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;handle&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;cppRef&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cppRef&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;isValid&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;handle&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;getName&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;handle&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Entity&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;getName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;handle&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cppRef&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

    &lt;span class=&quot;nb&quot;&gt;setmetatable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;handle&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;mt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;Handles&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cppRef&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;getId&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;handle&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;handle&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Wait a second… what happens when we call getName on bad handle? There’s no error checking! Let’s fix that:&lt;/p&gt;

&lt;div class=&quot;language-lua highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;getWrappedSafeFunction&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;handle&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;handle&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;isValid&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then&lt;/span&gt;
                &lt;span class=&quot;nb&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;debug.traceback&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;())&lt;/span&gt;
                &lt;span class=&quot;nb&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Error: handle is not valid!&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;handle&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cppRef&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and then in createHandle we’ll write:&lt;/p&gt;

&lt;div class=&quot;language-lua highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;handle&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;getName&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;getWrappedSafeFunction&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Entity&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;getName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Now the overhead is just &lt;strong&gt;70 nanoseconds&lt;/strong&gt;. The only added overhead is additional function call, validity check and retrieval of raw reference from handle table, but I think it’s pretty small for gained benefits.&lt;/p&gt;

&lt;h1 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h1&gt;

&lt;p&gt;In this article I’ve shown how to use different approaches to solving the “dangling pointer” problem and how to add additional safety layer to Lua scripts with very small overhead. Are there any awesome solutions that I’ve missed? Feel free to share them in comments.&lt;/p&gt;

&lt;p&gt;Hope you’ve enjoyed this article. Thanks for reading!&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>Re:creation dev log. July - November 2016</title>
   <link href="https://eliasdaler.github.io/re-creation-devlog-july-november2016/"/>
   <updated>2016-11-27T21:39:58+03:00</updated>
   <id>https://eliasdaler.github.io/re-creation-devlog-july-november2016</id>
   <content type="html">&lt;p&gt;The last five months were really important for the game. It finally feels like I can work on the game itself now, not just the engine and basic systems which will let me implement different stuff in the game. It’s not just abstract stuff, stuff which I do “just in case”. No, I try to be pragmatic and implement things which are needed for the game and which will let me create stuff without much restrictions.&lt;/p&gt;

&lt;p&gt;I’m very glad to say this, but I feel like the core engine is almost done. There are still some important things which I’ll have to implement, but it still feels like I’m finally happy with the design I have. Mostly, it’s because I’ve removed lots of stuff and find lots of ways to minimize my code which in the end gives me ability to implement new stuff easier and makes the whole thing easier to expand, modify and debug.&lt;/p&gt;

&lt;p&gt;I’m finally ready to do a lot of prototyping. I’ve already done a lot of stuff about the game, but I still have the feeling that it’s just the beginning of the “real” development! And it feels great, because I feel like I’m in total control of every aspect of the game. There are no restrictions, no boundaries. Let’s see how it goes.&lt;/p&gt;

&lt;p&gt;One more small thing: I’ve got a new laptop! I’ve had it for two weeks now. It feels really great. I’m able to do stuff a lot quicker and without frustration (having a great mood is important to be productive)! I’ve had my previous laptop for six years and it was slowing me down a lot. It was constantly overheating, everything was running poorly, compilation took a long time, etc… And recently I’ve realized how much it hurt my working process. There were lots of distractions, because even small change could take 1-2 minutes of recompilation. This means, that fast iteration was impossible. This also means that I constantly lost flow and couldn’t debug quickly. Hours of slow progress made it all exhausting. Won’t happen anymore!&lt;/p&gt;

&lt;p&gt;Okay, let’s begin!&lt;/p&gt;

&lt;!--more--&gt;
&lt;p&gt;&lt;a class=&quot;anchor&quot; id=&quot;read-more&quot;&gt;&lt;/a&gt;&lt;/p&gt;

&lt;h1 id=&quot;art&quot;&gt;Art&lt;/h1&gt;
&lt;p&gt;I haven’t done much art in the last months and most of the stuff I’ve done is still not finished, so I’ll show them a bit later. There’s a next graphics improvement coming and I’m glad that I didn’t have a lot of graphics done, because I’d have to redraw tons of stuff. Let’s hope it will be the last huge change!&lt;/p&gt;

&lt;p&gt;I’ve improved Renatus’ design and walking animation, it’s nice to see how much my art improved over time:
&lt;img src=&quot;http://i.imgur.com/bCdBa80.gif&quot; alt=&quot;Re:creation walk cycle improvements&quot; style=&quot;display:block; margin: 0 auto;width:512px;height: auto;&quot; /&gt;
I’ve also made some very small, but cool things…
Unsynched idle animations make everything look more alive!
&lt;img src=&quot;http://i.imgur.com/36HyuEh.gif&quot; alt=&quot;Unsynched animations&quot; style=&quot;display:block; margin: 0 auto;&quot; /&gt;
Cat doesn’t “talk” during “translation”
&lt;img src=&quot;http://i.imgur.com/dKRkCKn.gif&quot; alt=&quot;Cat talking&quot; style=&quot;display:block; margin: 0 auto;&quot; /&gt;&lt;/p&gt;

&lt;h1 id=&quot;multiple-tilemaps-in-one-level&quot;&gt;Multiple tilemaps in one level&lt;/h1&gt;

&lt;p&gt;Previously the level was limited to one tile map. That meant that if I wanted to make indoor places I either had to switch to another level (which isn’t fast!) or place the indoor area somewhere far away and teleport the player there. The second approach is highly used in 3d games, but I’ve realized that it wasn’t as good in 2d tile-based games because it’s harder to move tiles and you have to account for empty areas in your tilemap which are created by placing some area far away.&lt;/p&gt;

&lt;p&gt;Eventually, I’ve made a decision to make levels which support multiple tilemaps. It wasn’t easy to make, because lots of assumptions were made about Level having only one tilemap, but fortunately it wasn’t that bad, so I’ve done it fairly quickly. Now I can easily switch tilemaps during the fade in / fade out effect during scene transitions.&lt;/p&gt;

&lt;h1 id=&quot;input&quot;&gt;Input&lt;/h1&gt;
&lt;p&gt;Previously I’ve used polling for input, but realized that events are a lot more efficient and let me easily move all the input in Lua! One more part of game logic moved from C++ to Lua again! Great.&lt;/p&gt;

&lt;p&gt;I’ve also made much better system for input in general. Now all keys can be mapped to “actions” or “axes” (plural of “axis”, not “axe”!). “Actions” and “Axes” can be binded to C++ or Lua callback. This makes low-level input decoupled from game input logic in a nice way.&lt;/p&gt;

&lt;p&gt;One advantage of event based scripting is being able to set only one callback for particular action at given time. For example, during dialogues the “Primary Action” input action will be assigned to “Skip dialogue”, not “Attack/Use Primary Item”, so I don’t have to worry that somehow the player will be able to attack during dialogues.&lt;/p&gt;

&lt;p&gt;My input manager now also has complete gamepad support (sticks and triggers are also supported and it’s possible to connect gamepad in-game!). Event based input will later make it easy to implement replay system which will just send input events at needed times, simulating real player pressing buttons. Easy to implement and very useful for debugging!&lt;/p&gt;

&lt;h1 id=&quot;moved-entity-states-from-c-to-lua&quot;&gt;Moved Entity states from C++ to Lua&lt;/h1&gt;

&lt;p&gt;This is a thing that I wanted to make for a long time. Basically, most of the game logic lives in entity states. State like &lt;code class=&quot;highlighter-rouge&quot;&gt;MoveState&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;AttackState&lt;/code&gt;, etc. Previously they were hard-coded in C++ which made them hard to modify and control with Lua. Another problem was that the more stuff I added to Lua, the harder it became for me to access stuff one Lua side.&lt;/p&gt;

&lt;p&gt;For example, once I’ve implemented Action Lists in Lua, I’ve realized that some entity states can highly benefit from using them. But this meant that a lot of calls between Lua and C++ would happen.&lt;/p&gt;

&lt;p&gt;Rewriting entity states was extremely easy and I’ve discovered and fixed a lot of bugs along the way. I’ve also made entity states a lot more reusable, so that different entities can use the same code while adding bits that are different. For example, the same AttackState is used by player character, enemies with melee weapons and archers!&lt;/p&gt;

&lt;p&gt;Action lists are used to make code much easier to follow, basically the lists goes like this:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;Pre-attack animation (starting to swing a sword / aiming the arrow)&lt;/li&gt;
  &lt;li&gt;Attack animation (continuing to swing a sword / shooting the arrow)
During this step the damage is created during some frame. For melee attackers it’s defined in their AttackComponent, for archer the damage is “arrow” entity which is created on the first frame of “shoot” animation&lt;/li&gt;
  &lt;li&gt;Post attack animation&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;I’ve also implemented multiple state machines for entities. Most of the time the entity will have only one state machine which will describe it’s “main” state, but sometimes it’s useful to have another state machine which will, for example, describe it’s health state, so that if the entity has low health, it will play different “idle” animation.&lt;/p&gt;

&lt;h1 id=&quot;private-messages-in-event-system&quot;&gt;Private messages in event system&lt;/h1&gt;

&lt;p&gt;I’ve effectively used event system with global queue for quite some time, but then I’ve realized that it’s not efficient for some events to be implemented that way. One example of this is collision callbacks. When two entities collide, each entity’s onCollide function needs to be called with some additional info about which entity collided with it and maybe how it happened. In global queue each entity interested in collision event would receive this event and it would have to check if the collision happened with it or not. Of course that’s a huge waste of time, so that’s why I’ve made “private message” system which let’s entities specify sender and receiver for each event and then EventManager just sends this event to receiver object.&lt;/p&gt;

&lt;h1 id=&quot;improved-dialogues-a-lot&quot;&gt;Improved dialogues a lot&lt;/h1&gt;

&lt;p&gt;Dialogue system got some needed improvements! One such improvement is ability to insert delays and even function calls between words! It looks like this in a text:&lt;/p&gt;
&lt;div class=&quot;language-json highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;SOME_TEXT_TAG&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Hello...[DELAY 500][X] I've been waiting for you&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;[DELAY 500]&lt;/code&gt; creates a 500 ms delay. &lt;code class=&quot;highlighter-rouge&quot;&gt;[X]&lt;/code&gt; indicates that the function with tag “X” will be called. In scripts, it looks something like this:&lt;/p&gt;
&lt;div class=&quot;language-lua highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;DialogueAction&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;text&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;SOME_TEXT_TAG&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;functions&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;talker&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;talker&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;setAnimation&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;smile&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I later plan to add shaking or wave effects to text for better expression of characters’ emotions.&lt;/p&gt;

&lt;h1 id=&quot;dev-tools&quot;&gt;Dev tools&lt;/h1&gt;

&lt;p&gt;I’ve made some useful in-game dev tools with ImGui. One such tool is in-game console which lets me execute Lua easily. Here’s a little demo of it in action!
&lt;img src=&quot;http://i.imgur.com/DdKtJqU.gif&quot; alt=&quot;Console demo&quot; style=&quot;display:block; margin: 0 auto;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;I’ve also made a tool for controlling time. Now it’s possible to slow down and pause the game at any moment. The game doesn’t slow down or stop, I just change deltaTime, so I can easily debug everything in Visual Studio.
&lt;img src=&quot;http://i.imgur.com/R2F7YLf.gif&quot; alt=&quot;Time dev tools&quot; style=&quot;display:block; margin: 0 auto;&quot; /&gt;&lt;/p&gt;

&lt;h1 id=&quot;removed-tons-of-components&quot;&gt;Removed tons of components&lt;/h1&gt;
&lt;p&gt;I’ve also removed a lot of components which I found redundant and easily made with other components which have much larger role. Here’s what I’ve removed.&lt;/p&gt;

&lt;h2 id=&quot;direction-component&quot;&gt;Direction Component&lt;/h2&gt;
&lt;p&gt;Direction component stored just one thing: entity’s direction. But that meant that to access entity’s direction I had to get DirectionComponent and then get the direction. Getting component from entity isn’t very fast (because it involves a &lt;code class=&quot;highlighter-rouge&quot;&gt;dynamic_cast&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;std::unordered_map&lt;/code&gt; search) so I’ve just started to store entity’s direction in Entity class. Yes, some entities won’t have a direction (invisible entities or trees, for example), but I just assign &lt;code class=&quot;highlighter-rouge&quot;&gt;Direction::None&lt;/code&gt; to them. Storing 1 additional byte inside of Entity isn’t a big deal!&lt;/p&gt;

&lt;h2 id=&quot;trigger-component&quot;&gt;Trigger Component&lt;/h2&gt;

&lt;p&gt;I’ve also removed trigger component. Previously it was used for triggers and made possible to realize the following callbacks: &lt;code class=&quot;highlighter-rouge&quot;&gt;onEnter&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;onStay&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;onExit&lt;/code&gt;. But how did I check when to call them? I checked if trigger collides with potentially interesting entities or not… but then I’ve realized: why not just use &lt;code class=&quot;highlighter-rouge&quot;&gt;CollisionComponent&lt;/code&gt; for that and make a simple entity state machine which will track entities state which are: Idle or Triggered. OnEnter is called on transition from Idle to Triggered state, onStay is called when Triggered state is active and onExit is called during transition from Triggered to Idle state. &lt;code class=&quot;highlighter-rouge&quot;&gt;CollisionEnter&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;CollisionExit&lt;/code&gt; events trigger state transitions. This means that TriggerComponent wasn’t needed anymore and I got rid of it with a huge satisfaction.&lt;/p&gt;

&lt;p&gt;I’ve also made “directed” triggers which are called only when the player faces the specific direction, for example cafe has a trigger which lets player exit it when his direction is “Down”.&lt;/p&gt;

&lt;h2 id=&quot;interaction-component&quot;&gt;Interaction Component&lt;/h2&gt;

&lt;p&gt;Interaction Component was used for player-entity interactions, for example speaking with NPCs. When the player enters the “interaction area”, the input changes and pressing a specific button will start dialogue. Hmmm… seems familiar, isn’t it? Yes, this component isn’t needed too, because I can just make a trigger which will just change the input during onEnter/onExit function calls. Using it with “directed” triggers makes it perfect, because now it’s easy to make interaction possible only when the player faces the entity. (Previously it was possible to talk with NPCs while turning away from them, not cool!)&lt;/p&gt;

&lt;h1 id=&quot;remade-damage-system&quot;&gt;Remade damage system&lt;/h1&gt;

&lt;p&gt;Previously when player attacked, the “damage” entity was created and then destroyed. If something collided with it, the damage was registered. But on one random forum I’ve found much better solution: just have “damage” rect with melee attackers all the time and activate it only during attack. Simple and much more efficient!&lt;/p&gt;

&lt;h1 id=&quot;sat-separating-axis-theorem-collision&quot;&gt;SAT (Separating Axis Theorem) collision&lt;/h1&gt;

&lt;p&gt;After a lot of trying and failing, I’ve implemented SAT collision detection and response which will be used for some complex level geometry.
&lt;img src=&quot;http://i.imgur.com/eEg9lEp.gif&quot; alt=&quot;SAT&quot; style=&quot;display:block; margin: 0 auto;&quot; /&gt;
I’ve put some source code of &lt;i class=&quot;fa fa-github&quot; aria-hidden=&quot;true&quot;&gt;&lt;/i&gt;&lt;a href=&quot;https://gist.github.com/eliasdaler/502b54fcf1b515bcc50360ce874e81bc&quot;&gt;here&lt;/a&gt;, by the way, feel free to use it for your projects.&lt;/p&gt;

&lt;h1 id=&quot;refactoring&quot;&gt;Refactoring&lt;/h1&gt;
&lt;p&gt;I’ve also done &lt;strong&gt;a lot&lt;/strong&gt; of refactoring. I’m mostly satisfied with most of my codebase, but there was some bad stuff that I needed to fix once and for all!
Mostly, I’ve been fixing pretty typical problems: unnecessary dependencies, some code duplication, problems with ownerships, etc. Not too much to say about that!
But the good thing about refactoring is that it just made my codebase a lot shorter. At some point it’s not a refactoring anymore, it’s restructuring, implementing better code, moving some stuff to Lua, etc.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;C++&lt;/strong&gt;: -4345 lines of code&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Lua&lt;/strong&gt;: +540 lines of code&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Total&lt;/strong&gt;: -3814 lines of code&lt;/p&gt;

&lt;p&gt;This makes me extremely happy, because shorter and cleaner code is much easier to manage and improve. Writing negative code feels great!&lt;/p&gt;

&lt;h1 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h1&gt;

&lt;p&gt;The last few months were very important and productive! While there wasn’t a huge progress about the game itself, the engine is almost done, I’m very happy with the code and engine structure now. The next few months will be spent prototyping and making “vertical slice” of the game and I hope I’ll be able to make game truly fun and enjoyable. See ya!&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>Using ImGui with modern C++ and STL for creating awesome game dev tools. Part 2. Some tips and tricks.</title>
   <link href="https://eliasdaler.github.io/using-imgui-with-sfml-pt2/"/>
   <updated>2016-07-21T20:34:00+03:00</updated>
   <id>https://eliasdaler.github.io/using-imgui-with-sfml-pt2</id>
   <content type="html">&lt;p&gt;Hello, welcome to my second article about ImGui! This article is a collection of useful things, hacks and other stuff I’ve found while using ImGui. Mostly it’s focused on using modern C++ and some parts of STL with ImGui.&lt;/p&gt;

&lt;p class=&quot;message&quot;&gt;If you use SFML and want to learn how to use it with ImGui, use &lt;i class=&quot;fa fa-github&quot; aria-hidden=&quot;true&quot;&gt;&lt;/i&gt;&lt;a href=&quot;https://github.com/eliasdaler/imgui-sfml&quot;&gt;my binding&lt;/a&gt; and refer to &lt;a href=&quot;https://eliasdaler.github.io/using-imgui-with-sfml-pt1&quot;&gt;this tutorial&lt;/a&gt; about setting it up!&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://eliasdaler.files.wordpress.com/2016/05/examples_01.png?w=662&quot; alt=&quot;ImGui widgets&quot; style=&quot;display:block; margin: 0 auto;&quot; /&gt;&lt;/p&gt;
&lt;p style=&quot;text-align: center;&quot;&gt;&lt;i&gt;Different ImGui widgets (taken from ImGui's github page)&lt;/i&gt;&lt;/p&gt;

&lt;!--more--&gt;
&lt;p&gt;&lt;a class=&quot;anchor&quot; id=&quot;read-more&quot;&gt;&lt;/a&gt;&lt;/p&gt;

&lt;h1 id=&quot;contents&quot;&gt;Contents&lt;/h1&gt;

&lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;#introduction&quot;&gt;Introduction&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=&quot;#imgui-demo-window&quot;&gt;ImGui Demo Window&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=&quot;#labels&quot;&gt;Labels&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=&quot;#getting-back-to-the-context-of-the-window-tree-etc&quot;&gt;Getting back to the context of the window, tree, etc.&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=&quot;#inputfloatn--struct&quot;&gt;InputFloatN + struct&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=&quot;#using-imgui-with-stl&quot;&gt;Using ImGui with STL&lt;/a&gt;&lt;/li&gt;
    &lt;ul&gt;
        &lt;li&gt;&lt;a href=&quot;#arrays&quot;&gt;Arrays&lt;/a&gt;&lt;/li&gt;
        &lt;li&gt;&lt;a href=&quot;#combobox-listbox&quot;&gt;ComboBox, ListBox&lt;/a&gt;&lt;/li&gt;
        &lt;li&gt;&lt;a href=&quot;#inputtext-and-stdstring&quot;&gt;InputText and std::string&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
    &lt;li&gt;&lt;a href=&quot;#callbacks&quot;&gt;Callbacks&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=&quot;#conclusion&quot;&gt;Conclusion&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr /&gt;

&lt;h1 id=&quot;introduction&quot;&gt;Introduction&lt;/h1&gt;

&lt;p&gt;If you didn’t read &lt;a href=&quot;https://eliasdaler.github.io/using-imgui-with-sfml-pt1&quot;&gt;the first article&lt;/a&gt;, here’s a short recap to get you started.&lt;/p&gt;

&lt;p&gt;&lt;i class=&quot;fa fa-github&quot; aria-hidden=&quot;true&quot;&gt;&lt;/i&gt;&lt;a href=&quot;https://github.com/ocornut/imgui&quot;&gt;Dear ImGui&lt;/a&gt; is an amazing library which can be used to create fast GUI for your game dev (and not only!) tools in very short amount of time. The resulting code is very simple to use and modify, you don’t have to store GUI widgets or register callbacks. Here’s some stuff that I’ve made in ImGui for &lt;a href=&quot;http://en.sfml-dev.org/forums/index.php?topic=18062.0&quot;&gt;my game&lt;/a&gt;:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://i2.wp.com/i.imgur.com/iQibpSk.gif&quot; alt=&quot;Level editor&quot; style=&quot;display:block; margin: 0 auto;&quot; /&gt;&lt;/p&gt;
&lt;p style=&quot;text-align: center;&quot;&gt;&lt;i&gt;Level Editor&lt;/i&gt;&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;
&lt;img src=&quot;https://i0.wp.com/i.imgur.com/A44zLlb.gif&quot; alt=&quot;Animation editor&quot; style=&quot;display:block; margin: 0 auto;&quot; /&gt;&lt;/p&gt;
&lt;p style=&quot;text-align: center;&quot;&gt;&lt;i&gt;Animation editor&lt;/i&gt;&lt;/p&gt;

&lt;p&gt;Okay, enough of intros, let’s get right to tips.&lt;/p&gt;

&lt;h1 id=&quot;imgui-demo-window&quot;&gt;ImGui demo window&lt;/h1&gt;

&lt;p&gt;First of all, it’s very useful to check out ImGui test window and its source to see how various things can be done. You have to add &lt;strong&gt;imgui_demo.cpp&lt;/strong&gt; to your build and then call &lt;code class=&quot;highlighter-rouge&quot;&gt;ImGui::ShowTestWindow&lt;/code&gt; to show the window. Because there are so many examples, I won’t go over them and just focus on other stuff.&lt;/p&gt;

&lt;h1 id=&quot;labels&quot;&gt;Labels&lt;/h1&gt;

&lt;p&gt;Labels are used in ImGui as unique IDs for widgets. You shouldn’t use same labels for two different widgets as it will introduce collisions between widgets and that will lead to some unwanted behavior.&lt;/p&gt;

&lt;p&gt;Suppose you have two buttons with label “Meow” and you have a code like this:&lt;/p&gt;

&lt;pre class=&quot;vs-code&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;cppNamespace&quot;&gt;ImGui&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppFunction&quot;&gt;Button&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;string&quot;&gt;&amp;quot;Meow&amp;quot;&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;cppNamespace&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppGlobalVariable&quot;&gt;cout&lt;/span&gt; &lt;span class=&quot;cppOperator&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&amp;quot;Meow\n&amp;quot;&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;operator&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;cppNamespace&quot;&gt;ImGui&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppFunction&quot;&gt;Button&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;string&quot;&gt;&amp;quot;Meow&amp;quot;&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;cppNamespace&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppGlobalVariable&quot;&gt;cout&lt;/span&gt; &lt;span class=&quot;cppOperator&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&amp;quot;Purr\n&amp;quot;&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;operator&quot;&gt;}&lt;/span&gt;&lt;/pre&gt;

&lt;p&gt;The first button works as expected, but the second doesn’t work at all! These are the things that can happen when collisions occur between IDs. This won’t happen most of the time, after all there’s mostly no need to place two buttons which say the same thing in one window. But what if you &lt;em&gt;really&lt;/em&gt; need these two “Meow” buttons? The solution is simple: you just have to add “##” and some stuff after that to resolve the collision:&lt;/p&gt;

&lt;pre class=&quot;vs-code&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;cppNamespace&quot;&gt;ImGui&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppFunction&quot;&gt;Button&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;string&quot;&gt;&amp;quot;Meow&amp;quot;&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;cppNamespace&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppGlobalVariable&quot;&gt;cout&lt;/span&gt; &lt;span class=&quot;cppOperator&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&amp;quot;Meow\n&amp;quot;&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;operator&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;cppNamespace&quot;&gt;ImGui&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppFunction&quot;&gt;Button&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;string&quot;&gt;&amp;quot;Meow##Second&amp;quot;&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;cppNamespace&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppGlobalVariable&quot;&gt;cout&lt;/span&gt; &lt;span class=&quot;cppOperator&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&amp;quot;Purr\n&amp;quot;&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;operator&quot;&gt;}&lt;/span&gt;&lt;/pre&gt;

&lt;p&gt;All the text after “##” is not displayed and only used to give unique IDs to widgets with same labels.
IDs should be unique in the same scope, so it’s okay to have two widgets with the same label in two different windows or have one of them in some tree or list (trees, lists and some other widgets have their own scopes, so collisions won’t happen between items in them and other items).&lt;/p&gt;

&lt;p&gt;Let’s look at another situation. Suppose you have an array of &lt;code class=&quot;highlighter-rouge&quot;&gt;int&lt;/code&gt;s:&lt;/p&gt;
&lt;pre class=&quot;vs-code&quot;&gt;&lt;span class=&quot;cppNamespace&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppType - keyword - (TRANSIENT)&quot;&gt;array&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;cppLocalVariable&quot;&gt;arr&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;};&lt;/span&gt;
&lt;/pre&gt;

&lt;p&gt;And now you want to create a bunch of &lt;code class=&quot;highlighter-rouge&quot;&gt;InputInt&lt;/code&gt; widgets for each array element. &lt;code class=&quot;highlighter-rouge&quot;&gt;ImGui::PushID&lt;/code&gt;/&lt;code class=&quot;highlighter-rouge&quot;&gt;PopID&lt;/code&gt; come to the rescue! You can push &lt;code class=&quot;highlighter-rouge&quot;&gt;int&lt;/code&gt;s, &lt;code class=&quot;highlighter-rouge&quot;&gt;const char*&lt;/code&gt; or &lt;code class=&quot;highlighter-rouge&quot;&gt;void*&lt;/code&gt; as IDs which will be appended to the label of the next created widget (but won’t be shown). For example, you can do this:&lt;/p&gt;

&lt;pre class=&quot;vs-code&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;cppLocalVariable&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;cppLocalVariable&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;cppLocalVariable&quot;&gt;arr&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;cppMemberFunction&quot;&gt;size&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;();&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;cppLocalVariable&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;cppNamespace&quot;&gt;ImGui&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppFunction&quot;&gt;PushID&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;cppLocalVariable&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;cppNamespace&quot;&gt;ImGui&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppFunction&quot;&gt;InputInt&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;string&quot;&gt;&amp;quot;##&amp;quot;&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;cppLocalVariable&quot;&gt;arr&lt;/span&gt;&lt;span class=&quot;cppMemberOperator&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;cppLocalVariable&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;cppMemberOperator&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;cppNamespace&quot;&gt;ImGui&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppFunction&quot;&gt;PopID&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;operator&quot;&gt;}&lt;/span&gt;&lt;/pre&gt;

&lt;p&gt;There are some situations where you don’t have an &lt;code class=&quot;highlighter-rouge&quot;&gt;int&lt;/code&gt; which you can use as part of ID, for example if you want to use for-ranged loop with the &lt;code class=&quot;highlighter-rouge&quot;&gt;std::array&lt;/code&gt;. In that case, you can use pointers to elements of the array which will be unique:&lt;/p&gt;
&lt;pre class=&quot;vs-code&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;auto&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&quot;cppLocalVariable&quot;&gt;elem&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;cppLocalVariable&quot;&gt;arr&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;cppNamespace&quot;&gt;ImGui&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppFunction&quot;&gt;PushID&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&amp;amp;&lt;/span&gt;&lt;span class=&quot;cppLocalVariable&quot;&gt;elem&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;cppNamespace&quot;&gt;ImGui&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppFunction&quot;&gt;InputInt&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;string&quot;&gt;&amp;quot;##&amp;quot;&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;cppLocalVariable&quot;&gt;elem&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;cppNamespace&quot;&gt;ImGui&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppFunction&quot;&gt;PopID&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;operator&quot;&gt;}&lt;/span&gt;&lt;/pre&gt;

&lt;h1 id=&quot;getting-back-to-the-context-of-the-window-tree-etc&quot;&gt;Getting back to the context of the window, tree, etc.&lt;/h1&gt;

&lt;p&gt;Suppose that you need to add some stuff to the window you’ve created before but you already called &lt;code class=&quot;highlighter-rouge&quot;&gt;ImGui::End&lt;/code&gt;. No problem, just call &lt;code class=&quot;highlighter-rouge&quot;&gt;ImGui::Begin&lt;/code&gt; with the name of the window in which you want to append stuff. Here’s an example:&lt;/p&gt;
&lt;pre class=&quot;vs-code&quot;&gt;&lt;span class=&quot;cppNamespace&quot;&gt;ImGui&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppFunction&quot;&gt;Begin&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;string&quot;&gt;&amp;quot;First window&amp;quot;&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;comment&quot;&gt;// begin first window&lt;/span&gt;
&lt;span class=&quot;comment&quot;&gt;// some stuff&lt;/span&gt;
&lt;span class=&quot;cppNamespace&quot;&gt;ImGui&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppFunction&quot;&gt;End&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;();&lt;/span&gt;

&lt;span class=&quot;cppNamespace&quot;&gt;ImGui&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppFunction&quot;&gt;Begin&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;string&quot;&gt;&amp;quot;Another window&amp;quot;&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;comment&quot;&gt;// begin second window&lt;/span&gt;
&lt;span class=&quot;comment&quot;&gt;// some another stuff&lt;/span&gt;
&lt;span class=&quot;cppNamespace&quot;&gt;ImGui&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppFunction&quot;&gt;End&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;();&lt;/span&gt;

&lt;span class=&quot;comment&quot;&gt;// oops, forgot to add some stuff!&lt;/span&gt;
&lt;span class=&quot;comment&quot;&gt;// let&amp;#39;s go back to the context of the first window&lt;/span&gt;
&lt;span class=&quot;cppNamespace&quot;&gt;ImGui&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppFunction&quot;&gt;Begin&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;string&quot;&gt;&amp;quot;First window&amp;quot;&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;comment&quot;&gt;// forgotten stuff&lt;/span&gt;
&lt;span class=&quot;cppNamespace&quot;&gt;ImGui&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppFunction&quot;&gt;End&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;();&lt;/span&gt;&lt;/pre&gt;

&lt;h1 id=&quot;inputfloatn--struct&quot;&gt;InputFloatN + struct&lt;/h1&gt;

&lt;p&gt;Sometimes it’s useful to use &lt;code class=&quot;highlighter-rouge&quot;&gt;InputFloat2&lt;/code&gt; or &lt;code class=&quot;highlighter-rouge&quot;&gt;InputFloat4&lt;/code&gt; with your point or rectangle structs which can be defined like this:&lt;/p&gt;

&lt;pre class=&quot;vs-code&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;cppType&quot;&gt;Point&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;keyword&quot;&gt;float&lt;/span&gt; &lt;span class=&quot;cppMemberField&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;keyword&quot;&gt;float&lt;/span&gt; &lt;span class=&quot;cppMemberField&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;operator&quot;&gt;};&lt;/span&gt;

&lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;cppType&quot;&gt;Rect&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;keyword&quot;&gt;float&lt;/span&gt; &lt;span class=&quot;cppMemberField&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;keyword&quot;&gt;float&lt;/span&gt; &lt;span class=&quot;cppMemberField&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;keyword&quot;&gt;float&lt;/span&gt; &lt;span class=&quot;cppMemberField&quot;&gt;w&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;keyword&quot;&gt;float&lt;/span&gt; &lt;span class=&quot;cppMemberField&quot;&gt;h&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;operator&quot;&gt;};&lt;/span&gt;&lt;/pre&gt;

&lt;p&gt;Using them with &lt;code class=&quot;highlighter-rouge&quot;&gt;InputFloat2&lt;/code&gt; or &lt;code class=&quot;highlighter-rouge&quot;&gt;InputFloat4&lt;/code&gt; is easy:&lt;/p&gt;

&lt;pre class=&quot;vs-code&quot;&gt;&lt;span class=&quot;cppType&quot;&gt;Point&lt;/span&gt; &lt;span class=&quot;cppLocalVariable&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;0.f&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;0.f&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;};&lt;/span&gt;
&lt;span class=&quot;cppType&quot;&gt;Rect&lt;/span&gt; &lt;span class=&quot;cppLocalVariable&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;0.f&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;0.f&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;0.f&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;0.f&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;};&lt;/span&gt;&lt;/pre&gt;

&lt;pre class=&quot;vs-code&quot;&gt;&lt;span class=&quot;cppNamespace&quot;&gt;ImGui&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppFunction&quot;&gt;InputFloat2&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;string&quot;&gt;&amp;quot;Point&amp;quot;&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;cppLocalVariable&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;cppMemberField&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;cppNamespace&quot;&gt;ImGui&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppFunction&quot;&gt;InputFloat4&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;string&quot;&gt;&amp;quot;Rect&amp;quot;&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;cppLocalVariable&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;cppMemberField&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;);&lt;/span&gt;&lt;/pre&gt;

&lt;p&gt;This works because both &lt;code class=&quot;highlighter-rouge&quot;&gt;Point&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;Rect&lt;/code&gt; structs are &lt;a href=&quot;http://en.cppreference.com/w/cpp/concept/PODType&quot;&gt;POD&lt;/a&gt; and don’t have “holes” in them, so the data they store is contiguous and can be interpreted as array of floats.&lt;/p&gt;

&lt;p&gt;This method is not very safe, of course, so use it at your own risk. Someone can modify the struct and this may break your code which assumed that the floats you want to modify are stored contiguously. Unfortunately, there’s no way to pass array of pointers to &lt;code class=&quot;highlighter-rouge&quot;&gt;InputFloat2&lt;/code&gt; or &lt;code class=&quot;highlighter-rouge&quot;&gt;InputFloat4&lt;/code&gt;, but you can easily create your own solution. Let’s make a function which creates a widget similar to &lt;code class=&quot;highlighter-rouge&quot;&gt;InputFloat4&lt;/code&gt; and uses members of &lt;code class=&quot;highlighter-rouge&quot;&gt;Rect&lt;/code&gt; struct explicitly:&lt;/p&gt;

&lt;pre class=&quot;vs-code&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;namespace&lt;/span&gt; &lt;span class=&quot;cppNamespace&quot;&gt;ImGui&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;{&lt;/span&gt;

&lt;span class=&quot;keyword&quot;&gt;bool&lt;/span&gt; &lt;span class=&quot;cppFunction&quot;&gt;InputRect&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;char&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;cppParameter&quot;&gt;label&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;cppType&quot;&gt;Rect&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;cppParameter&quot;&gt;rectPtr&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;cppParameter&quot;&gt;decimal_precision&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;cppType&quot;&gt;ImGuiInputTextFlags&lt;/span&gt; &lt;span class=&quot;cppParameter&quot;&gt;extra_flags&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;operator&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;cppNamespace&quot;&gt;ImGui&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppFunction&quot;&gt;PushID&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;cppParameter&quot;&gt;label&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;cppNamespace&quot;&gt;ImGui&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppFunction&quot;&gt;BeginGroup&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;();&lt;/span&gt;

    &lt;span class=&quot;keyword&quot;&gt;bool&lt;/span&gt; &lt;span class=&quot;cppLocalVariable&quot;&gt;valueChanged&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;cppNamespace&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppType - keyword - (TRANSIENT)&quot;&gt;array&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;float&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;*,&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;cppLocalVariable&quot;&gt;arr&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;cppParameter&quot;&gt;rectPtr&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;cppMemberField&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;cppParameter&quot;&gt;rectPtr&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;cppMemberField&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt;
                                  &lt;span class=&quot;operator&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;cppParameter&quot;&gt;rectPtr&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;cppMemberField&quot;&gt;w&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;cppParameter&quot;&gt;rectPtr&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;cppMemberField&quot;&gt;h&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;};&lt;/span&gt;

    &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;auto&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&quot;cppLocalVariable&quot;&gt;elem&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;cppLocalVariable&quot;&gt;arr&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;cppNamespace&quot;&gt;ImGui&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppFunction&quot;&gt;PushID&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;cppLocalVariable&quot;&gt;elem&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;cppNamespace&quot;&gt;ImGui&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppFunction&quot;&gt;PushItemWidth&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;64.f&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;cppLocalVariable&quot;&gt;valueChanged&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;|=&lt;/span&gt; &lt;span class=&quot;cppNamespace&quot;&gt;ImGui&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppFunction&quot;&gt;InputFloat&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;string&quot;&gt;&amp;quot;##arr&amp;quot;&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;cppLocalVariable&quot;&gt;elem&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;cppParameter&quot;&gt;decimal_precision&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;cppParameter&quot;&gt;extra_flags&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;cppNamespace&quot;&gt;ImGui&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppFunction&quot;&gt;PopID&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;();&lt;/span&gt;
        &lt;span class=&quot;cppNamespace&quot;&gt;ImGui&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppFunction&quot;&gt;SameLine&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;operator&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;cppNamespace&quot;&gt;ImGui&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppFunction&quot;&gt;SameLine&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;cppNamespace&quot;&gt;ImGui&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppFunction&quot;&gt;TextUnformatted&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;cppParameter&quot;&gt;label&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;cppNamespace&quot;&gt;ImGui&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppFunction&quot;&gt;EndGroup&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;();&lt;/span&gt;

    &lt;span class=&quot;cppNamespace&quot;&gt;ImGui&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppFunction&quot;&gt;PopID&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;();&lt;/span&gt; &lt;span class=&quot;comment&quot;&gt;// pop label id;&lt;/span&gt;

    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;cppLocalVariable&quot;&gt;valueChanged&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;operator&quot;&gt;}&lt;/span&gt;&lt;/pre&gt;
&lt;p&gt;And now you can do this:&lt;/p&gt;
&lt;pre class=&quot;vs-code&quot;&gt;&lt;span class=&quot;cppNamespace&quot;&gt;ImGui&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppFunction&quot;&gt;InputRect&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;string&quot;&gt;&amp;quot;Rect&amp;quot;&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;cppLocalVariable&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;);&lt;/span&gt;
&lt;/pre&gt;

&lt;h1 id=&quot;using-imgui-with-stl&quot;&gt;Using ImGui with STL&lt;/h1&gt;

&lt;p&gt;There are lots of things to be said about using ImGui with STL. ImGui doesn’t use STL at all and users have to pass raw arrays and &lt;code class=&quot;highlighter-rouge&quot;&gt;const char*&lt;/code&gt;s instead of &lt;code class=&quot;highlighter-rouge&quot;&gt;std::vector&lt;/code&gt;s and &lt;code class=&quot;highlighter-rouge&quot;&gt;std::string&lt;/code&gt;s, so you can’t just use STL and some modern C++ right away, but it can be done with some work.&lt;/p&gt;

&lt;h2 id=&quot;arrays&quot;&gt;Arrays&lt;/h2&gt;

&lt;p&gt;Some widgets require you to use raw arrays but those are not the best because you can’t use them with algorithms, for ranged loops, etc. And the other problem is that you have to manage the memory of variable size arrays yourself using &lt;code class=&quot;highlighter-rouge&quot;&gt;new&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;delete&lt;/code&gt;. Using &lt;code class=&quot;highlighter-rouge&quot;&gt;std::array&lt;/code&gt; with &lt;code class=&quot;highlighter-rouge&quot;&gt;Imgui::InputInt4&lt;/code&gt; which expects you to pass raw array is easy, just do it like this:&lt;/p&gt;
&lt;pre class=&quot;vs-code&quot;&gt;&lt;span class=&quot;cppNamespace&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppType - keyword - (TRANSIENT)&quot;&gt;array&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;cppLocalVariable&quot;&gt;arr2&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;};&lt;/span&gt;
&lt;/pre&gt;
&lt;pre class=&quot;vs-code&quot;&gt;&lt;span class=&quot;cppNamespace&quot;&gt;ImGui&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppFunction&quot;&gt;InputInt4&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;string&quot;&gt;&amp;quot;IntRect&amp;quot;&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;cppLocalVariable&quot;&gt;arr2&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;cppMemberFunction&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;());&lt;/span&gt;
&lt;/pre&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;std::array::data&lt;/code&gt; returns a pointer to raw int array which can be passed to &lt;code class=&quot;highlighter-rouge&quot;&gt;ImGui::InputInt4&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;The same can be done with &lt;code class=&quot;highlighter-rouge&quot;&gt;std::vector&lt;/code&gt;s which are guaranteed to be contiguous, so you can just use &lt;code class=&quot;highlighter-rouge&quot;&gt;std::vector::data&lt;/code&gt; the same way:&lt;/p&gt;

&lt;pre class=&quot;vs-code&quot;&gt;&lt;span class=&quot;cppNamespace&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppType&quot;&gt;vector&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;cppLocalVariable&quot;&gt;arr3&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;);&lt;/span&gt;
&lt;/pre&gt;
&lt;pre class=&quot;vs-code&quot;&gt;&lt;span class=&quot;cppNamespace&quot;&gt;ImGui&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppFunction&quot;&gt;InputInt4&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;string&quot;&gt;&amp;quot;IntRect&amp;quot;&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;cppLocalVariable&quot;&gt;arr3&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;cppMemberFunction&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;());&lt;/span&gt;
&lt;/pre&gt;

&lt;h2 id=&quot;combobox-listbox&quot;&gt;ComboBox, ListBox&lt;/h2&gt;
&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;ComboBox&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;ListBox&lt;/code&gt; can be used with arrays of &lt;code class=&quot;highlighter-rouge&quot;&gt;const char&lt;/code&gt;s, but what if you have &lt;code class=&quot;highlighter-rouge&quot;&gt;std::vector&amp;lt;std::string&amp;gt;&lt;/code&gt; instead? You have to redefine callback which ImGui calls to get next item of the array. Here’s how you can write &lt;code class=&quot;highlighter-rouge&quot;&gt;Combo&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;ListBox&lt;/code&gt; wrappers for &lt;code class=&quot;highlighter-rouge&quot;&gt;std::vector&amp;lt;std::string&amp;gt;&lt;/code&gt;:&lt;/p&gt;

&lt;pre class=&quot;vs-code&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;namespace&lt;/span&gt; &lt;span class=&quot;cppNamespace&quot;&gt;ImGui&lt;/span&gt;
&lt;span class=&quot;operator&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;auto&lt;/span&gt; &lt;span class=&quot;cppGlobalVariable&quot;&gt;vector_getter&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;[](&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;cppParameter&quot;&gt;vec&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;cppParameter&quot;&gt;idx&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;char&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;**&lt;/span&gt; &lt;span class=&quot;cppParameter&quot;&gt;out_text&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;operator&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;keyword&quot;&gt;auto&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&quot;cppLocalVariable&quot;&gt;vector&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;static_cast&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;cppNamespace&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppType&quot;&gt;vector&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;cppNamespace&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppType&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;gt;*&amp;gt;(&lt;/span&gt;&lt;span class=&quot;cppParameter&quot;&gt;vec&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;cppParameter&quot;&gt;idx&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;cppParameter&quot;&gt;idx&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;&amp;gt;=&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static_cast&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;gt;(&lt;/span&gt;&lt;span class=&quot;cppLocalVariable&quot;&gt;vector&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;cppMemberFunction&quot;&gt;size&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;()))&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;cppParameter&quot;&gt;out_text&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;cppLocalVariable&quot;&gt;vector&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;cppMemberFunction&quot;&gt;at&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;cppParameter&quot;&gt;idx&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;cppMemberFunction&quot;&gt;c_str&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;operator&quot;&gt;};&lt;/span&gt;

&lt;span class=&quot;keyword&quot;&gt;bool&lt;/span&gt; &lt;span class=&quot;cppFunction&quot;&gt;Combo&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;char&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;cppParameter&quot;&gt;label&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;cppParameter&quot;&gt;currIndex&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;cppNamespace&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppType&quot;&gt;vector&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;cppNamespace&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppType&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;gt;&amp;amp;&lt;/span&gt; &lt;span class=&quot;cppParameter&quot;&gt;values&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;operator&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;cppParameter&quot;&gt;values&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;cppMemberFunction&quot;&gt;empty&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;())&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;cppFunction&quot;&gt;Combo&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;cppParameter&quot;&gt;label&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;cppParameter&quot;&gt;currIndex&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;cppGlobalVariable&quot;&gt;vector_getter&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;keyword&quot;&gt;static_cast&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;*&amp;gt;(&amp;amp;&lt;/span&gt;&lt;span class=&quot;cppParameter&quot;&gt;values&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;cppParameter&quot;&gt;values&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;cppMemberFunction&quot;&gt;size&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;());&lt;/span&gt;
&lt;span class=&quot;operator&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;keyword&quot;&gt;bool&lt;/span&gt; &lt;span class=&quot;cppFunction&quot;&gt;ListBox&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;char&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;cppParameter&quot;&gt;label&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;cppParameter&quot;&gt;currIndex&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;cppNamespace&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppType&quot;&gt;vector&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;cppNamespace&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppType&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;gt;&amp;amp;&lt;/span&gt; &lt;span class=&quot;cppParameter&quot;&gt;values&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;operator&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;cppParameter&quot;&gt;values&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;cppMemberFunction&quot;&gt;empty&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;())&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;cppFunction&quot;&gt;ListBox&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;cppParameter&quot;&gt;label&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;cppParameter&quot;&gt;currIndex&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;cppGlobalVariable&quot;&gt;vector_getter&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;keyword&quot;&gt;static_cast&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;*&amp;gt;(&amp;amp;&lt;/span&gt;&lt;span class=&quot;cppParameter&quot;&gt;values&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;cppParameter&quot;&gt;values&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;cppMemberFunction&quot;&gt;size&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;());&lt;/span&gt;
&lt;span class=&quot;operator&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;operator&quot;&gt;}&lt;/span&gt;&lt;/pre&gt;

&lt;p&gt;Ugh, that’s not the prettiest code, but it works. We store pointer to our vector in &lt;code class=&quot;highlighter-rouge&quot;&gt;void*&lt;/code&gt; and cast it back to vector in our lambda. What’s good about that code is that we don’t create any copies of strings and just use &lt;code class=&quot;highlighter-rouge&quot;&gt;const char&lt;/code&gt; pointers stored in &lt;code class=&quot;highlighter-rouge&quot;&gt;std::string&lt;/code&gt;s from our &lt;code class=&quot;highlighter-rouge&quot;&gt;std::vector&lt;/code&gt;.&lt;/p&gt;

&lt;h2 id=&quot;inputtext-and-stdstring&quot;&gt;InputText and std::string&lt;/h2&gt;

&lt;p&gt;ImGui lets you pass char array in &lt;code class=&quot;highlighter-rouge&quot;&gt;InputText&lt;/code&gt; and then it modifies it when user enters some text in the input field. The problem is that it’s hard to know the size of input in advance, so you have to allocate large enough buffer and then pass it in &lt;code class=&quot;highlighter-rouge&quot;&gt;InputText&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;We can use &lt;code class=&quot;highlighter-rouge&quot;&gt;std::vector&amp;lt;char&amp;gt;&lt;/code&gt; as our buffer instead of using raw arrays. If the size of buffer is known at compile time, you can use &lt;code class=&quot;highlighter-rouge&quot;&gt;std::array&amp;lt;char, N&amp;gt;&lt;/code&gt;, where &lt;code class=&quot;highlighter-rouge&quot;&gt;N&lt;/code&gt; is the size of the buffer.&lt;/p&gt;

&lt;p&gt;You can then create &lt;code class=&quot;highlighter-rouge&quot;&gt;std::string&lt;/code&gt; from your buffer like this:&lt;/p&gt;
&lt;pre class=&quot;vs-code&quot;&gt;&lt;span class=&quot;cppNamespace&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppType&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;cppLocalVariable&quot;&gt;str&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;cppLocalVariable&quot;&gt;arr&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;cppMemberFunction&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;();&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;One of &lt;code class=&quot;highlighter-rouge&quot;&gt;std::string&lt;/code&gt; constructors takes &lt;code class=&quot;highlighter-rouge&quot;&gt;const char*&lt;/code&gt; so we get it by calling &lt;code class=&quot;highlighter-rouge&quot;&gt;data&lt;/code&gt;.&lt;/p&gt;

&lt;p class=&quot;message&quot;&gt;Be careful when using &lt;code&gt;std::string&lt;/code&gt; as input buffer! Sure, you can always call &lt;code&gt;std::string::resize&lt;/code&gt; and allocate enough space, but don't use it in string handling code, because the string may contain zeros or trash and this can lead to some nasty bugs. The size of the string may not be what you expect. Moreover, when ImGui changes &lt;code&gt;std::string&lt;/code&gt;'s internal char array, it doesn't modify it's size which can be another source of hard bugs.&lt;/p&gt;

&lt;h2 id=&quot;callbacks&quot;&gt;Callbacks&lt;/h2&gt;

&lt;p&gt;ImGui lets you add callbacks to different widgets. Let’s make a silly callback which replaces all user input with char ‘A’.&lt;/p&gt;

&lt;p&gt;First you define a free function:&lt;/p&gt;

&lt;pre class=&quot;vs-code&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;cppFunction&quot;&gt;callback&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;cppType&quot;&gt;ImGuiTextEditCallbackData&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;cppParameter&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;operator&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;cppParameter&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;cppMemberField&quot;&gt;EventChar&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&amp;#39;A&amp;#39;&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;operator&quot;&gt;}&lt;/span&gt;&lt;/pre&gt;
&lt;p&gt;And then pass it to &lt;code class=&quot;highlighter-rouge&quot;&gt;InputText&lt;/code&gt;:&lt;/p&gt;
&lt;pre class=&quot;vs-code&quot;&gt;&lt;span class=&quot;cppNamespace&quot;&gt;ImGui&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppFunction&quot;&gt;InputText&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;string&quot;&gt;&amp;quot;Text&amp;quot;&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;cppLocalVariable&quot;&gt;textArr&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;cppMemberFunction&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(),&lt;/span&gt; &lt;span class=&quot;cppLocalVariable&quot;&gt;textArr&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;cppMemberFunction&quot;&gt;size&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(),&lt;/span&gt;
    &lt;span class=&quot;cppEnumerator&quot;&gt;ImGuiInputTextFlags_CallbackCharFilter&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;cppFunction&quot;&gt;callback&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;);&lt;/span&gt;&lt;/pre&gt;

&lt;p&gt;You can also use stateless lambdas which can be used just as free functions:&lt;/p&gt;

&lt;pre class=&quot;vs-code&quot;&gt;&lt;span class=&quot;cppNamespace&quot;&gt;ImGui&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppFunction&quot;&gt;InputText&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;string&quot;&gt;&amp;quot;Text&amp;quot;&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;cppLocalVariable&quot;&gt;textArr&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;cppMemberFunction&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(),&lt;/span&gt; &lt;span class=&quot;cppLocalVariable&quot;&gt;textArr&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;cppMemberFunction&quot;&gt;size&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(),&lt;/span&gt;
    &lt;span class=&quot;cppEnumerator&quot;&gt;ImGuiInputTextFlags_CallbackCharFilter&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;operator&quot;&gt;[](&lt;/span&gt;&lt;span class=&quot;cppType&quot;&gt;ImGuiTextEditCallbackData&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;cppParameter&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;operator&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;cppParameter&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;cppMemberField&quot;&gt;EventChar&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&amp;#39;A&amp;#39;&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;operator&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;operator&quot;&gt;);&lt;/span&gt;&lt;/pre&gt;

&lt;p&gt;Suppose we don’t want to hard-code replacement character and want to use a char variable instead. We can’t capture the state in our lambda (it can’t be used as a free function), so we store the pointer to char in &lt;code class=&quot;highlighter-rouge&quot;&gt;ImGuiTextEditCallbackData::UserData&lt;/code&gt;:&lt;/p&gt;

&lt;pre class=&quot;vs-code&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;cppLocalVariable&quot;&gt;replacementChar&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&amp;#39;A&amp;#39;&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;
&lt;/pre&gt;
&lt;pre class=&quot;vs-code&quot;&gt;&lt;span class=&quot;cppNamespace&quot;&gt;ImGui&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppFunction&quot;&gt;InputText&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;string&quot;&gt;&amp;quot;Text2&amp;quot;&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;cppLocalVariable&quot;&gt;textArr&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;cppMemberFunction&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(),&lt;/span&gt; &lt;span class=&quot;cppLocalVariable&quot;&gt;textArr&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;cppMemberFunction&quot;&gt;size&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(),&lt;/span&gt;
    &lt;span class=&quot;cppEnumerator&quot;&gt;ImGuiInputTextFlags_CallbackCharFilter&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;operator&quot;&gt;[](&lt;/span&gt;&lt;span class=&quot;cppType&quot;&gt;ImGuiTextEditCallbackData&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;cppParameter&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;operator&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;cppParameter&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;cppMemberField&quot;&gt;EventChar&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;static_cast&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;char&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;*&amp;gt;(&lt;/span&gt;&lt;span class=&quot;cppParameter&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;cppMemberField&quot;&gt;UserData&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;operator&quot;&gt;},&lt;/span&gt;
    &lt;span class=&quot;keyword&quot;&gt;const_cast&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;char&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;*&amp;gt;(&amp;amp;&lt;/span&gt;&lt;span class=&quot;cppLocalVariable&quot;&gt;replacementChar&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;));&lt;/span&gt;&lt;/pre&gt;

&lt;p&gt;Not bad, but capturing the state is so much prettier! And what if you wanted to pass more than one variable? This would get much harder, so I’ll show you how to use lambdas with state with ImGui!&lt;/p&gt;

&lt;p&gt;Let’s define our own function which will lets us pass lambdas with state:&lt;/p&gt;

&lt;pre class=&quot;vs-code&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;namespace&lt;/span&gt; &lt;span class=&quot;cppNamespace&quot;&gt;ImGui&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;{&lt;/span&gt;

&lt;span class=&quot;keyword&quot;&gt;template&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;typename&lt;/span&gt; &lt;span class=&quot;cppType&quot;&gt;F&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;keyword&quot;&gt;bool&lt;/span&gt; &lt;span class=&quot;cppFunctionTemplate&quot;&gt;InputTextCool&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;char&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;cppParameter&quot;&gt;label&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;char&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;cppParameter&quot;&gt;buf&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;cppType&quot;&gt;size_t&lt;/span&gt; &lt;span class=&quot;cppParameter&quot;&gt;buf_size&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;cppType&quot;&gt;ImGuiInputTextFlags&lt;/span&gt; &lt;span class=&quot;cppParameter&quot;&gt;flags&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;cppType&quot;&gt;F&lt;/span&gt; &lt;span class=&quot;cppParameter&quot;&gt;callback&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;nullptr&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;cppParameter&quot;&gt;user_data&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;nullptr&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;operator&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;keyword&quot;&gt;auto&lt;/span&gt; &lt;span class=&quot;cppLocalVariable&quot;&gt;freeCallback&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;[](&lt;/span&gt;&lt;span class=&quot;cppType&quot;&gt;ImGuiTextEditCallbackData&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;cppParameter&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;keyword&quot;&gt;auto&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&quot;cppLocalVariable&quot;&gt;f&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;static_cast&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;cppType&quot;&gt;F&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;*&amp;gt;(&lt;/span&gt;&lt;span class=&quot;cppParameter&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;cppMemberField&quot;&gt;UserData&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;cppLocalVariable&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;cppParameter&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;operator&quot;&gt;};&lt;/span&gt;
    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;identifier&quot;&gt;InputText&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;cppParameter&quot;&gt;label&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;cppParameter&quot;&gt;buf&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;cppParameter&quot;&gt;buf_size&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;cppParameter&quot;&gt;flags&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;cppLocalVariable&quot;&gt;freeCallback&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;cppParameter&quot;&gt;callback&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;operator&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;operator&quot;&gt;}&lt;/span&gt;&lt;/pre&gt;

&lt;p&gt;Here’s how it works: we create another lambda which is stateless and calls our original lambda which is stored in &lt;code class=&quot;highlighter-rouge&quot;&gt;ImGuiTextEditCallbackData::UserData&lt;/code&gt;. And now we can pass lambda with state like this:&lt;/p&gt;

&lt;pre class=&quot;vs-code&quot;&gt;&lt;span class=&quot;cppNamespace&quot;&gt;ImGui&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppFunctionTemplate&quot;&gt;InputTextCool&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;string&quot;&gt;&amp;quot;Text3&amp;quot;&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;cppLocalVariable&quot;&gt;textArr&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;cppMemberFunction&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(),&lt;/span&gt; &lt;span class=&quot;cppLocalVariable&quot;&gt;textArr&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;cppMemberFunction&quot;&gt;size&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(),&lt;/span&gt;
    &lt;span class=&quot;cppEnumerator&quot;&gt;ImGuiInputTextFlags_CallbackCharFilter&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;operator&quot;&gt;[&amp;amp;&lt;/span&gt;&lt;span class=&quot;cppLocalVariable&quot;&gt;replacementChar&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;](&lt;/span&gt;&lt;span class=&quot;cppType&quot;&gt;ImGuiTextEditCallbackData&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;cppParameter&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;operator&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;cppParameter&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;cppMemberField&quot;&gt;EventChar&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;cppLocalVariable&quot;&gt;replacementChar&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;operator&quot;&gt;});&lt;/span&gt;&lt;/pre&gt;

&lt;p&gt;Nice! But we can do better, because if we want to do the same with other widgets, we have to do the same thing over and over again. So let’s generalize the approach. First of all, let’s create a function which returns stateless lambda from lambda with state:&lt;/p&gt;

&lt;pre class=&quot;vs-code&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;template&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;typename&lt;/span&gt; &lt;span class=&quot;cppType&quot;&gt;F&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;keyword&quot;&gt;auto&lt;/span&gt; &lt;span class=&quot;cppFunctionTemplate&quot;&gt;getFreeCallback&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;cppType&quot;&gt;F&lt;/span&gt; &lt;span class=&quot;cppParameter&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;operator&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;[](&lt;/span&gt;&lt;span class=&quot;cppType&quot;&gt;function_traits&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;cppType&quot;&gt;F&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;gt;::&lt;/span&gt;&lt;span class=&quot;identifier&quot;&gt;arg_t&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;cppParameter&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;keyword&quot;&gt;auto&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&quot;cppLocalVariable&quot;&gt;f&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;static_cast&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;cppType&quot;&gt;F&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;*&amp;gt;(&lt;/span&gt;&lt;span class=&quot;cppParameter&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;identifier&quot;&gt;UserData&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;cppLocalVariable&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;cppParameter&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;operator&quot;&gt;};&lt;/span&gt;
&lt;span class=&quot;operator&quot;&gt;}&lt;/span&gt;&lt;/pre&gt;

&lt;p&gt;This is the same approach we’ve used in &lt;code class=&quot;highlighter-rouge&quot;&gt;InputTextCool&lt;/code&gt; function. &lt;code class=&quot;highlighter-rouge&quot;&gt;function_traits&amp;lt;F&amp;gt;::arg_t&amp;lt;0&amp;gt;&lt;/code&gt; gets us the first argument of passed lambda. These traits can be defined like this:&lt;/p&gt;

&lt;pre class=&quot;vs-code&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;template&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;typename&lt;/span&gt; &lt;span class=&quot;cppType&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;cppClassTemplate&quot;&gt;function_traits&lt;/span&gt;
    &lt;span class=&quot;operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;cppType&quot;&gt;function_traits&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;decltype&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&amp;amp;&lt;/span&gt;&lt;span class=&quot;cppType&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;operator&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;())&amp;gt;&lt;/span&gt;
&lt;span class=&quot;operator&quot;&gt;{};&lt;/span&gt;

&lt;span class=&quot;keyword&quot;&gt;template&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;typename&lt;/span&gt; &lt;span class=&quot;cppType&quot;&gt;ClassType&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;typename&lt;/span&gt; &lt;span class=&quot;cppType&quot;&gt;ReturnType&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;typename&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;...&lt;/span&gt; &lt;span class=&quot;cppType&quot;&gt;Args&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;cppClassTemplate&quot;&gt;function_traits&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;cppType&quot;&gt;ReturnType&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;cppType&quot;&gt;ClassType&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::*)(&lt;/span&gt;&lt;span class=&quot;cppType&quot;&gt;Args&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;...)&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;operator&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;keyword&quot;&gt;template&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;cppType&quot;&gt;size_t&lt;/span&gt; &lt;span class=&quot;identifier&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;keyword&quot;&gt;using&lt;/span&gt; &lt;span class=&quot;cppClassTemplate&quot;&gt;arg_t&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;cppNamespace&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppType&quot;&gt;tuple_element_t&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;identifier&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;cppNamespace&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppType&quot;&gt;tuple&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;cppType&quot;&gt;Args&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;...&amp;gt;&amp;gt;;&lt;/span&gt;
&lt;span class=&quot;operator&quot;&gt;};&lt;/span&gt;
&lt;/pre&gt;

&lt;p&gt;And now we can do this:&lt;/p&gt;

&lt;pre class=&quot;vs-code&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;auto&lt;/span&gt; &lt;span class=&quot;cppLocalVariable&quot;&gt;replacementLambda&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;[&amp;amp;&lt;/span&gt;&lt;span class=&quot;cppLocalVariable&quot;&gt;replacementChar&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;](&lt;/span&gt;&lt;span class=&quot;cppType&quot;&gt;ImGuiTextEditCallbackData&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;cppParameter&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;operator&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;cppParameter&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;cppMemberField&quot;&gt;EventChar&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;cppLocalVariable&quot;&gt;replacementChar&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;operator&quot;&gt;};&lt;/span&gt;

&lt;span class=&quot;cppNamespace&quot;&gt;ImGui&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppFunction&quot;&gt;InputText&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;string&quot;&gt;&amp;quot;Text4&amp;quot;&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;cppLocalVariable&quot;&gt;textArr&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;cppMemberFunction&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(),&lt;/span&gt; &lt;span class=&quot;cppLocalVariable&quot;&gt;textArr&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;cppMemberFunction&quot;&gt;size&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(),&lt;/span&gt;
    &lt;span class=&quot;cppEnumerator&quot;&gt;ImGuiInputTextFlags_CallbackCharFilter&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;cppFunctionTemplate&quot;&gt;getFreeCallback&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;cppLocalVariable&quot;&gt;replacementLambda&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;cppLocalVariable&quot;&gt;replacementLambda&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;);&lt;/span&gt;&lt;/pre&gt;

&lt;p&gt;We can do the same thing “inline” like this:&lt;/p&gt;

&lt;pre class=&quot;vs-code&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;using&lt;/span&gt; &lt;span class=&quot;cppType&quot;&gt;ReplacementLambdaType&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;decltype&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;cppLocalVariable&quot;&gt;replacementLambda&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;cppNamespace&quot;&gt;ImGui&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppFunction&quot;&gt;InputText&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;string&quot;&gt;&amp;quot;Text5&amp;quot;&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;cppLocalVariable&quot;&gt;textArr&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;cppMemberFunction&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(),&lt;/span&gt; &lt;span class=&quot;cppLocalVariable&quot;&gt;textArr&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;cppMemberFunction&quot;&gt;size&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(),&lt;/span&gt;
    &lt;span class=&quot;cppEnumerator&quot;&gt;ImGuiInputTextFlags_CallbackCharFilter&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;operator&quot;&gt;[](&lt;/span&gt;&lt;span class=&quot;cppType&quot;&gt;ImGuiTextEditCallbackData&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;cppParameter&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;operator&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;keyword&quot;&gt;auto&lt;/span&gt; &lt;span class=&quot;cppLocalVariable&quot;&gt;f&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;static_cast&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;cppType&quot;&gt;ReplacementLambdaType&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;*&amp;gt;(&lt;/span&gt;&lt;span class=&quot;cppParameter&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;cppMemberField&quot;&gt;UserData&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;cppLocalVariable&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;cppParameter&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;operator&quot;&gt;},&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;cppLocalVariable&quot;&gt;replacementLambda&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;);&lt;/span&gt;&lt;/pre&gt;

&lt;p&gt;Note that we had to store our lambda type in &lt;code class=&quot;highlighter-rouge&quot;&gt;ReplacementLambdaType&lt;/code&gt; type alias to cast from &lt;code class=&quot;highlighter-rouge&quot;&gt;void*&lt;/code&gt; later. This is almost the same as the previous approach (which I like more!).&lt;/p&gt;

&lt;h1 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h1&gt;

&lt;p&gt;ImGui is a wonderful library and it’s cool that you can easily expand it and use with all the stuff you like. There are some other tricks and tips I have to share, but this article got pretty big and so another part of this article will probably happen some day.&lt;/p&gt;

&lt;p&gt;If you want to know about something or have something to share, feel free to do it in comments, I’ll use it for the next article. See ya!&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>Using ImGui with SFML for creating awesome game dev tools. Part 1.</title>
   <link href="https://eliasdaler.github.io/using-imgui-with-sfml-pt1/"/>
   <updated>2016-07-10T15:42:00+03:00</updated>
   <id>https://eliasdaler.github.io/using-imgui-with-sfml-pt1</id>
   <content type="html">
&lt;hr /&gt;

&lt;p&gt;Related article: &lt;a href=&quot;https://eliasdaler.github.io/using-imgui-with-sfml-pt2&quot;&gt;Using ImGui with modern C++ and STL&lt;/a&gt;&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;This is the first part of tutorial about Dear ImGui (AKA ImGui) and it’ll show you how to set it up with SFML. The second part will be library agnostic and will talk about common ways of doing stuff in ImGui, some awesome widgets and some useful STL overloads.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://eliasdaler.files.wordpress.com/2016/05/examples_01.png?w=662&quot; alt=&quot;ImGui widgets&quot; /&gt;&lt;/p&gt;

&lt;p class=&quot;img-desc&quot;&gt;Different ImGui widgets (taken from ImGui’s github page)&lt;/p&gt;

&lt;hr /&gt;

&lt;!--more--&gt;
&lt;p&gt;&lt;a class=&quot;anchor&quot; id=&quot;read-more&quot;&gt;&lt;/a&gt;&lt;/p&gt;

&lt;h2 class=&quot;no_toc&quot; id=&quot;table-of-contents&quot;&gt;Table of contents&lt;/h2&gt;

&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#introduction&quot; id=&quot;markdown-toc-introduction&quot;&gt;Introduction&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#dear-imgui-and-immediate-mode-gui-concept&quot; id=&quot;markdown-toc-dear-imgui-and-immediate-mode-gui-concept&quot;&gt;Dear ImGui and immediate mode GUI concept&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#using-imgui-sfml&quot; id=&quot;markdown-toc-using-imgui-sfml&quot;&gt;Using ImGui-SFML&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#option-a-using-imgui-sfml-with-cmake&quot; id=&quot;markdown-toc-option-a-using-imgui-sfml-with-cmake&quot;&gt;Option A. Using ImGui-SFML with CMake&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#option-b-manual-integration&quot; id=&quot;markdown-toc-option-b-manual-integration&quot;&gt;Option B. Manual integration&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#useful-overloads-for-sfml&quot; id=&quot;markdown-toc-useful-overloads-for-sfml&quot;&gt;Useful overloads for SFML&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#conclusion&quot; id=&quot;markdown-toc-conclusion&quot;&gt;Conclusion&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;introduction&quot;&gt;Introduction&lt;/h2&gt;

&lt;p&gt;Having good content creation (level editor, resource editor, etc.) and debugging
tools for your game is very important and can lead to productivity and
creativity boost. Here are some examples of tools I managed to make with ImGui
for my games.&lt;/p&gt;

&lt;p class=&quot;img-desc&quot;&gt;&lt;img src=&quot;https://i.imgur.com/vCXP1uu.png&quot; alt=&quot;Tomb Painter dev tools&quot; /&gt;
Level Editor in Tomb Painter&lt;/p&gt;

&lt;p class=&quot;img-desc&quot;&gt;&lt;img src=&quot;https://i.imgur.com/iQibpSk.gif&quot; alt=&quot;Level editor&quot; /&gt;
Level Editor&lt;/p&gt;

&lt;p class=&quot;img-desc&quot;&gt;&lt;img src=&quot;http://i.imgur.com/8yt6Y7E.gif&quot; alt=&quot;Lua console&quot; /&gt;
Lua console&lt;/p&gt;

&lt;p class=&quot;img-desc&quot;&gt;&lt;img src=&quot;https://i.imgur.com/A44zLlb.gif&quot; alt=&quot;Animation editor&quot; /&gt;
Animation editor&lt;/p&gt;

&lt;p&gt;As you can see there’s a wide range of widgets that ImGui provides and there are lots of other great examples of how other people use it here.&lt;/p&gt;

&lt;h2 id=&quot;dear-imgui-and-immediate-mode-gui-concept&quot;&gt;Dear ImGui and immediate mode GUI concept&lt;/h2&gt;

&lt;p&gt;Dear ImGui is an immediate mode GUI library which makes making GUI for all kinds of tools very easy.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Immediate mode GUI&lt;/strong&gt; is a bit different to what people think when they hear “GUI” (“retained mode” is a classic way of doing GUI).
Immediate mode GUI is a way of doing GUI which involves creating and drawing widgets in each frame. Instead of creating some &lt;code class=&quot;highlighter-rouge&quot;&gt;Button&lt;/code&gt; object and adding a callback to it, you write something like&lt;/p&gt;

&lt;div class=&quot;language-cpp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ImGui&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Button&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Some Button&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;...&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// code which will be called on button pressed&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Simple as that!&lt;/p&gt;

&lt;p&gt;For a great in-depth talk on this concept, I recommend to check out &lt;a href=&quot;https://mollyrocket.com/861&quot;&gt;Casey Muratori’s talk on IMGUI&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Back to Dear ImGui. It’s:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;MIT Licensed&lt;/li&gt;
  &lt;li&gt;Very fast and light&lt;/li&gt;
  &lt;li&gt;Constantly updated and expanded&lt;/li&gt;
  &lt;li&gt;Doesn’t do dynamic allocation/deallocation&lt;/li&gt;
  &lt;li&gt;Very portable – has lots of bindings for different libraries and frameworks&lt;/li&gt;
  &lt;li&gt;Easily expandable&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;using-imgui-sfml&quot;&gt;Using ImGui-SFML&lt;/h2&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/eliasdaler/imgui-sfml&quot;&gt;ImGui-SFML&lt;/a&gt; is a binding I wrote to
simplify usage of ImGui with SFML. Here’s how you can use it.&lt;/p&gt;

&lt;h3 id=&quot;option-a-using-imgui-sfml-with-cmake&quot;&gt;Option A. Using ImGui-SFML with CMake&lt;/h3&gt;

&lt;p class=&quot;message&quot;&gt;&lt;strong&gt;Important&lt;/strong&gt;: since ImGui-SFML v2.0 minimal version for SFML is 2.5.0 and. For ImGui it’s 1.68&lt;/p&gt;

&lt;p class=&quot;message&quot;&gt;Also you can see how you can get and ImGui, SFML and ImGui-SFML with amazing FetchContent CMake module &lt;a href=&quot;https://github.com/eliasdaler/imgui-sfml-fetchcontent&quot;&gt;here&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;First, you need to download ImGui, ImGui-SFML and build SFML somewhere.&lt;/p&gt;

&lt;p&gt;Then, run this where you want to build ImGui-SFML:&lt;/p&gt;
&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;cmake &amp;lt;ImGui-SFML repo folder&amp;gt; &lt;span class=&quot;nt&quot;&gt;-DIMGUI_DIR&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&amp;lt;ImGui repo folder&amp;gt; &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
                               &lt;span class=&quot;nt&quot;&gt;-DSFML_DIR&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&amp;lt;path with built SFML&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If you have SFML installed on your system, you don’t need to set SFML_DIR during
configuration.&lt;/p&gt;

&lt;p&gt;You can also specify &lt;code class=&quot;highlighter-rouge&quot;&gt;BUILD_SHARED_LIBS=ON&lt;/code&gt; to build ImGui-SFML as a shared library. To build ImGui-SFML examples, set &lt;code class=&quot;highlighter-rouge&quot;&gt;IMGUI_SFML_BUILD_EXAMPLES=ON&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;After the building, you can install the library on your system by running:&lt;/p&gt;
&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;cmake &lt;span class=&quot;nt&quot;&gt;--build&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;--target&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;install&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If you set &lt;code class=&quot;highlighter-rouge&quot;&gt;CMAKE_INSTALL_PREFIX&lt;/code&gt; during configuration, you can install ImGui-SFML locally.&lt;/p&gt;

&lt;p&gt;Integrating into your project is simple:&lt;/p&gt;
&lt;div class=&quot;language-cmake highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;find_package&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;ImGui-SFML REQUIRED&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;target_link_libraries&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;my_target PRIVATE ImGui-SFML::ImGui-SFML&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If CMake can’t find ImGui-SFML on your system (or you didn’t install it), just define &lt;code class=&quot;highlighter-rouge&quot;&gt;ImGui-SFML_DIR&lt;/code&gt; before calling &lt;code class=&quot;highlighter-rouge&quot;&gt;find_package&lt;/code&gt;.&lt;/p&gt;

&lt;h3 id=&quot;option-b-manual-integration&quot;&gt;Option B. Manual integration&lt;/h3&gt;

&lt;p&gt;This is slightly more complex…&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Use SFML to get a simple window to show up. Follow the “Getting started” tutorial &lt;a href=&quot;http://www.sfml-dev.org/tutorials/2.3/&quot;&gt;here&lt;/a&gt; if you have never done it before.&lt;/li&gt;
  &lt;li&gt;Download &lt;i class=&quot;fa fa-github&quot;&gt;&lt;/i&gt;&lt;a href=&quot;https://github.com/ocornut/imgui&quot;&gt;ImGui&lt;/a&gt;.&lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Download &lt;i class=&quot;fa fa-github&quot;&gt;&lt;/i&gt;&lt;a href=&quot;https://github.com/eliasdaler/imgui-sfml&quot;&gt;ImGui-SFML&lt;/a&gt;.&lt;/p&gt;

    &lt;p class=&quot;message&quot;&gt;&lt;strong&gt;Important&lt;/strong&gt;: you have to add the contents of &lt;strong&gt;imconfig-SFML.h&lt;/strong&gt; to ImGui’s &lt;strong&gt;imconfig.h&lt;/strong&gt; to get implicit &lt;code class=&quot;highlighter-rouge&quot;&gt;ImVec2&lt;/code&gt; &lt;i class=&quot;fa fa-arrows-h&quot;&gt;&lt;/i&gt; &lt;code class=&quot;highlighter-rouge&quot;&gt;sf::Vector2f&lt;/code&gt; conversion working!&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;Add ImGui and ImGui-SFML directories to your include directories.&lt;/li&gt;
  &lt;li&gt;Add these files to your build / project:
    &lt;ul&gt;
      &lt;li&gt;&lt;strong&gt;imgui.cpp&lt;/strong&gt;&lt;/li&gt;
      &lt;li&gt;&lt;strong&gt;imgui_draw.cpp&lt;/strong&gt;&lt;/li&gt;
      &lt;li&gt;&lt;strong&gt;imgui_widgets.cpp&lt;/strong&gt;&lt;/li&gt;
      &lt;li&gt;&lt;strong&gt;imgui-SFML.cpp&lt;/strong&gt;&lt;/li&gt;
      &lt;li&gt;&lt;strong&gt;imgui_demo.cpp&lt;/strong&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;(Optional) If you get linking errors, link OpenGL to your project.&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;Here’s a complete example of using ImGui and SMFL together.&lt;/p&gt;

&lt;pre class=&quot;vs-code&quot;&gt;&lt;span class=&quot;preprocessor keyword&quot;&gt;#include&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&amp;quot;imgui.h&amp;quot;&lt;/span&gt;
&lt;span class=&quot;preprocessor keyword&quot;&gt;#include&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&amp;quot;imgui-SFML.h&amp;quot;&lt;/span&gt;

&lt;span class=&quot;preprocessor keyword&quot;&gt;#include&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&amp;lt;SFML/Graphics/RenderWindow.hpp&amp;gt;&lt;/span&gt;
&lt;span class=&quot;preprocessor keyword&quot;&gt;#include&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&amp;lt;SFML/System/Clock.hpp&amp;gt;&lt;/span&gt;
&lt;span class=&quot;preprocessor keyword&quot;&gt;#include&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&amp;lt;SFML/Window/Event.hpp&amp;gt;&lt;/span&gt;

&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;cppFunction&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;operator&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;cppNamespace&quot;&gt;sf&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppType&quot;&gt;RenderWindow&lt;/span&gt; &lt;span class=&quot;cppLocalVariable&quot;&gt;window&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;cppNamespace&quot;&gt;sf&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppType&quot;&gt;VideoMode&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;640&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;480&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;cppLocalVariable&quot;&gt;window&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;cppMemberFunction&quot;&gt;setVerticalSyncEnabled&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;cppNamespace&quot;&gt;ImGui&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppNamespace&quot;&gt;SFML&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppFunction&quot;&gt;Init&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;cppLocalVariable&quot;&gt;window&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;);&lt;/span&gt;

    &lt;span class=&quot;cppNamespace&quot;&gt;sf&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppType&quot;&gt;Color&lt;/span&gt; &lt;span class=&quot;cppLocalVariable&quot;&gt;bgColor&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;keyword&quot;&gt;float&lt;/span&gt; &lt;span class=&quot;cppLocalVariable&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;0.f&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;0.f&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;0.f&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;};&lt;/span&gt;

    &lt;span class=&quot;comment&quot;&gt;// let&amp;#39;s use char array as buffer, see next part&lt;/span&gt;
    &lt;span class=&quot;comment&quot;&gt;// for instructions on using std::string with ImGui&lt;/span&gt;
    &lt;span class=&quot;keyword&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;cppLocalVariable&quot;&gt;windowTitle&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;255&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&amp;quot;ImGui + SFML = &amp;lt;3&amp;quot;&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;cppLocalVariable&quot;&gt;window&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;cppMemberFunction&quot;&gt;setTitle&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;cppLocalVariable&quot;&gt;windowTitle&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;cppLocalVariable&quot;&gt;window&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;cppMemberFunction&quot;&gt;resetGLStates&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;();&lt;/span&gt; &lt;span class=&quot;comment&quot;&gt;// call it if you only draw ImGui. Otherwise not needed.&lt;/span&gt;
    &lt;span class=&quot;cppNamespace&quot;&gt;sf&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppType&quot;&gt;Clock&lt;/span&gt; &lt;span class=&quot;cppLocalVariable&quot;&gt;deltaClock&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;keyword&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;cppLocalVariable&quot;&gt;window&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;cppMemberFunction&quot;&gt;isOpen&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;())&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;cppNamespace&quot;&gt;sf&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppType&quot;&gt;Event&lt;/span&gt; &lt;span class=&quot;cppLocalVariable&quot;&gt;event&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;keyword&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;cppLocalVariable&quot;&gt;window&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;cppMemberFunction&quot;&gt;pollEvent&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;cppLocalVariable&quot;&gt;event&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;cppNamespace&quot;&gt;ImGui&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppNamespace&quot;&gt;SFML&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppFunction&quot;&gt;ProcessEvent&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;cppLocalVariable&quot;&gt;event&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;);&lt;/span&gt;

            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;cppLocalVariable&quot;&gt;event&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;cppMemberField&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;cppNamespace&quot;&gt;sf&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppType&quot;&gt;Event&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppEnumerator&quot;&gt;Closed&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;cppLocalVariable&quot;&gt;window&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;cppMemberFunction&quot;&gt;close&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;();&lt;/span&gt;
            &lt;span class=&quot;operator&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;operator&quot;&gt;}&lt;/span&gt;

        &lt;span class=&quot;cppNamespace&quot;&gt;ImGui&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppNamespace&quot;&gt;SFML&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppFunction&quot;&gt;Update&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;cppLocalVariable&quot;&gt;window&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;cppLocalVariable&quot;&gt;deltaClock&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;cppMemberFunction&quot;&gt;restart&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;());&lt;/span&gt;

        &lt;span class=&quot;cppNamespace&quot;&gt;ImGui&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppFunction&quot;&gt;Begin&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;string&quot;&gt;&amp;quot;Sample window&amp;quot;&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;comment&quot;&gt;// begin window&lt;/span&gt;

                                       &lt;span class=&quot;comment&quot;&gt;// Background color edit&lt;/span&gt;
        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;cppNamespace&quot;&gt;ImGui&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppFunction&quot;&gt;ColorEdit3&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;string&quot;&gt;&amp;quot;Background color&amp;quot;&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;cppLocalVariable&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;comment&quot;&gt;// this code gets called if color value changes, so&lt;/span&gt;
            &lt;span class=&quot;comment&quot;&gt;// the background color is upgraded automatically!&lt;/span&gt;
            &lt;span class=&quot;cppLocalVariable&quot;&gt;bgColor&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;cppMemberField&quot;&gt;r&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static_cast&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;cppNamespace&quot;&gt;sf&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppType&quot;&gt;Uint8&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;gt;(&lt;/span&gt;&lt;span class=&quot;cppLocalVariable&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;255.f&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;);&lt;/span&gt;
            &lt;span class=&quot;cppLocalVariable&quot;&gt;bgColor&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;cppMemberField&quot;&gt;g&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static_cast&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;cppNamespace&quot;&gt;sf&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppType&quot;&gt;Uint8&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;gt;(&lt;/span&gt;&lt;span class=&quot;cppLocalVariable&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;255.f&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;);&lt;/span&gt;
            &lt;span class=&quot;cppLocalVariable&quot;&gt;bgColor&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;cppMemberField&quot;&gt;b&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static_cast&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;cppNamespace&quot;&gt;sf&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppType&quot;&gt;Uint8&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;gt;(&lt;/span&gt;&lt;span class=&quot;cppLocalVariable&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;255.f&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;operator&quot;&gt;}&lt;/span&gt;

        &lt;span class=&quot;comment&quot;&gt;// Window title text edit&lt;/span&gt;
        &lt;span class=&quot;cppNamespace&quot;&gt;ImGui&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppFunction&quot;&gt;InputText&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;string&quot;&gt;&amp;quot;Window title&amp;quot;&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;cppLocalVariable&quot;&gt;windowTitle&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;255&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;);&lt;/span&gt;

        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;cppNamespace&quot;&gt;ImGui&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppFunction&quot;&gt;Button&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;string&quot;&gt;&amp;quot;Update window title&amp;quot;&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;comment&quot;&gt;// this code gets if user clicks on the button&lt;/span&gt;
            &lt;span class=&quot;comment&quot;&gt;// yes, you could have written if(ImGui::InputText(...))&lt;/span&gt;
            &lt;span class=&quot;comment&quot;&gt;// but I do this to show how buttons work :)&lt;/span&gt;
            &lt;span class=&quot;cppLocalVariable&quot;&gt;window&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;cppMemberFunction&quot;&gt;setTitle&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;cppLocalVariable&quot;&gt;windowTitle&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;operator&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;cppNamespace&quot;&gt;ImGui&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppFunction&quot;&gt;End&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;();&lt;/span&gt; &lt;span class=&quot;comment&quot;&gt;// end window&lt;/span&gt;

        &lt;span class=&quot;cppLocalVariable&quot;&gt;window&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;cppMemberFunction&quot;&gt;clear&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;cppLocalVariable&quot;&gt;bgColor&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;comment&quot;&gt;// fill background with color&lt;/span&gt;
        &lt;span class=&quot;cppNamespace&quot;&gt;ImGui&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppNamespace&quot;&gt;SFML&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppFunction&quot;&gt;Render&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;span class=&quot;cppLocalVariable&quot;&gt;window&lt;/span&gt;);&lt;/span&gt;
        &lt;span class=&quot;cppLocalVariable&quot;&gt;window&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;cppMemberFunction&quot;&gt;display&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;operator&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;cppNamespace&quot;&gt;ImGui&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppNamespace&quot;&gt;SFML&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppFunction&quot;&gt;Shutdown&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;operator&quot;&gt;}&lt;/span&gt;&lt;/pre&gt;

&lt;p&gt;You’ll see something like this:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://i.imgur.com/1H6Jt6m.png&quot; alt=&quot;First example&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Try to change some stuff. Double click on r/g/b field to set values precisely, or just drag some widgets to change window’s background color. Press the button to change window title.
Here, it works!&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://i.imgur.com/06s334T.png&quot; alt=&quot;First example&quot; /&gt;
Awesome! Now let’s see how it works.&lt;/p&gt;

&lt;p&gt;ImGui is initialized by calling &lt;code class=&quot;highlighter-rouge&quot;&gt;ImGui::SFML::Init&lt;/code&gt; function to which you pass your &lt;code class=&quot;highlighter-rouge&quot;&gt;sf::RenderWindow&lt;/code&gt;. This creates internal default font atlas. See how you can use other fonts in &lt;a href=&quot;https://github.com/eliasdaler/imgui-sfml#fonts-how-to&quot;&gt;Fonts how-to section&lt;/a&gt; of imgui-sfml’s README.&lt;/p&gt;

&lt;p&gt;Shutting down is done with &lt;code class=&quot;highlighter-rouge&quot;&gt;ImGui::SFML::Shutdown&lt;/code&gt; call which cleans some things up. (Deleting internal font atlas, if it’s used, for example).&lt;/p&gt;

&lt;p&gt;There are two phases of using ImGui in your game loop: &lt;strong&gt;update&lt;/strong&gt; and &lt;strong&gt;render&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Updating&lt;/strong&gt; consists of &lt;em&gt;event processing&lt;/em&gt;, &lt;em&gt;state update&lt;/em&gt; and &lt;em&gt;widget update&lt;/em&gt;. Event processing is done by calling &lt;code class=&quot;highlighter-rouge&quot;&gt;ImGui::SFML::ProcessEvent&lt;/code&gt; and it’s almost the same as processing SFML events. It’s used to process keyboard and mouse input and handle window resize and focus events. State update (which is being done by calling &lt;code class=&quot;highlighter-rouge&quot;&gt;ImGui::SFML::Update&lt;/code&gt;) updates delta time which ImGui uses internally, so you have to pass it using your delta time clock, as well as mouse coordinates (or your window relative to which mouse coordinates will be taken). &lt;code class=&quot;highlighter-rouge&quot;&gt;ImGui::NewFrame&lt;/code&gt; is also being called here and you can call ImGui widget creation functions after that. Calling stuff like &lt;code class=&quot;highlighter-rouge&quot;&gt;ImGui::Button&lt;/code&gt; or &lt;code class=&quot;highlighter-rouge&quot;&gt;ImGui::Color3Edit&lt;/code&gt; updates widgets and it also generates one draw list which is used for rendering later.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Drawing&lt;/strong&gt; is done with &lt;code class=&quot;highlighter-rouge&quot;&gt;ImGui::SFML::Render&lt;/code&gt; call.&lt;/p&gt;

&lt;p class=&quot;message&quot;&gt;Don’t call &lt;code class=&quot;highlighter-rouge&quot;&gt;ImGui::Render&lt;/code&gt;, it may lead to some bugs which &lt;code class=&quot;highlighter-rouge&quot;&gt;ImGui::SFML::Render&lt;/code&gt; doesn’t have.&lt;/p&gt;

&lt;p class=&quot;message&quot;&gt;You must create all widgets between &lt;code class=&quot;highlighter-rouge&quot;&gt;ImGui::SFML::Update()&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;ImGui::Render()&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;If you’re updating more than you draw, then you can either update ImGui once per frame or call &lt;code class=&quot;highlighter-rouge&quot;&gt;ImGui::EndFrame&lt;/code&gt; at the end of your update function.&lt;/p&gt;

&lt;p&gt;Widgets are easily created by calling corresponding functions (more about them in the next part). For example, you can call &lt;code class=&quot;highlighter-rouge&quot;&gt;ImGui::InputInt&lt;/code&gt; and pass a pointer to int there.When you change widget’s value, the integer is changed too.
Buttons work pretty easy too – they don’t need callbacks, you just wrap code which you want to call after the button is pressed in &lt;code class=&quot;highlighter-rouge&quot;&gt;if(ImGui::Button(…)) { … }&lt;/code&gt; and that’s all you have to do.&lt;/p&gt;

&lt;p&gt;Call &lt;code class=&quot;highlighter-rouge&quot;&gt;ImGui::ShowTestWindow&lt;/code&gt; somewhere when you create widgets and you’ll get a nice window with lots of examples of ImGui stuff. This is very useful as example of how to do stuff with ImGui. Just look for the thing you want to make in this test window and you’ll easily find how to do it in corresponding part of imgui_demo.cpp.&lt;/p&gt;

&lt;h2 id=&quot;useful-overloads-for-sfml&quot;&gt;Useful overloads for SFML&lt;/h2&gt;

&lt;p&gt;There are also some useful overloads implemented in SFML ImGui binding. For example, you can use &lt;code class=&quot;highlighter-rouge&quot;&gt;ImGui::Image&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;ImGui::ImageButton&lt;/code&gt; with &lt;code class=&quot;highlighter-rouge&quot;&gt;sf::Textures&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;sf::Sprites&lt;/code&gt;! I’ve also defined implicit conversions between &lt;code class=&quot;highlighter-rouge&quot;&gt;ImVec2&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;sf::Vector2f&lt;/code&gt;, so you can pass &lt;code class=&quot;highlighter-rouge&quot;&gt;sf::Vector2f&lt;/code&gt; to ImGui’s functions without needing to cast explicitly. You can also draw lines and rects with &lt;code class=&quot;highlighter-rouge&quot;&gt;DrawLine&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;DrawRect&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;DrawRectFilled&lt;/code&gt;.&lt;/p&gt;

&lt;h2 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h2&gt;

&lt;p&gt;As you can see, using ImGui is easy and it’s easy to start doing really impressive and useful stuff with it right away. Thank you for reading this tutorial, I hope it was useful and that ImGui will help you make better tools and greater games as the result of having awesome tools.&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>Improving code highlighting on blogs</title>
   <link href="https://eliasdaler.github.io/better-highlighting/"/>
   <updated>2016-07-10T15:42:00+03:00</updated>
   <id>https://eliasdaler.github.io/better-highlighting</id>
   <content type="html">&lt;p&gt;Who knew that I’ll someday write about web programming, but here I am.&lt;/p&gt;

&lt;p class=&quot;message&quot;&gt;This advice applies to lots of languages and editors, I use C++ and Visual Studio as an example.&lt;/p&gt;

&lt;p&gt;Lots of sites use &lt;strong&gt;Pygments&lt;/strong&gt; or &lt;strong&gt;highlight.js&lt;/strong&gt; as a syntax highlighter and here’s how C++ code highlighted in &lt;strong&gt;Pygments&lt;/strong&gt; looks (&lt;strong&gt;highlight.js&lt;/strong&gt; produces almost identical output):&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-c--&quot; data-lang=&quot;c++&quot;&gt;&lt;span class=&quot;kt&quot;&gt;bool&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;LuaScriptManager&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;loadScript&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;filename&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;numberOrArgs&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;lua_gettop&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;L&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;auto&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;log&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;engine_system&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;LogManager&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;luaL_loadfile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;L&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;filename&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c_str&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;())&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;lua_pcall&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;L&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;numberOrArgs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;LogManager&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;MessageType&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Lua&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;Loaded script: &quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;filename&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// some error&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;LogManager&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;MessageType&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Lua_Exception&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;Failed to load: &quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;filename&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;LogManager&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;MessageType&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Lua_Exception&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;lua_tostring&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;L&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;lua_pop&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;L&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// pop error message from stack&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;But here’s what you can do with Visual Studio by copying HTML markup from it and applying some CSS:&lt;/p&gt;

&lt;pre class=&quot;vs-code&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;bool&lt;/span&gt; &lt;span class=&quot;cppType&quot;&gt;LuaScriptManager&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppMemberFunction&quot;&gt;loadScript&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;cppNamespace&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppType&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&quot;cppParameter&quot;&gt;filename&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;operator&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;cppLocalVariable&quot;&gt;numberOrArgs&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;cppFunction&quot;&gt;lua_gettop&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;cppMemberField&quot;&gt;L&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;keyword&quot;&gt;auto&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&quot;cppLocalVariable&quot;&gt;log&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;cppGlobalVariable&quot;&gt;engine_system&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;cppMemberFunction&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;cppType&quot;&gt;LogManager&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;gt;();&lt;/span&gt;
    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;(!(&lt;/span&gt;&lt;span class=&quot;cppMacro&quot;&gt;luaL_loadfile&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;cppMemberField&quot;&gt;L&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;cppParameter&quot;&gt;filename&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;cppMemberFunction&quot;&gt;c_str&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;())&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;cppMacro&quot;&gt;lua_pcall&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;cppMemberField&quot;&gt;L&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;cppLocalVariable&quot;&gt;numberOrArgs&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;)))&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;cppLocalVariable&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;cppMemberOperator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;cppType&quot;&gt;LogManager&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppType&quot;&gt;MessageType&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppEnumerator&quot;&gt;Lua&lt;/span&gt;&lt;span class=&quot;cppMemberOperator&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;cppMemberOperator&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&amp;quot;Loaded script: &amp;quot;&lt;/span&gt; &lt;span class=&quot;cppMemberOperator&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;cppParameter&quot;&gt;filename&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;operator&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;comment&quot;&gt;// some error&lt;/span&gt;
        &lt;span class=&quot;cppLocalVariable&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;cppMemberOperator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;cppType&quot;&gt;LogManager&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppType&quot;&gt;MessageType&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppEnumerator&quot;&gt;Lua_Exception&lt;/span&gt;&lt;span class=&quot;cppMemberOperator&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;cppMemberOperator&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&amp;quot;Failed to load: &amp;quot;&lt;/span&gt; &lt;span class=&quot;cppMemberOperator&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;cppParameter&quot;&gt;filename&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;cppLocalVariable&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;cppMemberOperator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;cppType&quot;&gt;LogManager&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppType&quot;&gt;MessageType&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppEnumerator&quot;&gt;Lua_Exception&lt;/span&gt;&lt;span class=&quot;cppMemberOperator&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;cppMemberOperator&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;cppMacro&quot;&gt;lua_tostring&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;cppMemberField&quot;&gt;L&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;cppMacro&quot;&gt;lua_pop&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;cppMemberField&quot;&gt;L&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;comment&quot;&gt;// pop error message from stack&lt;/span&gt;
        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;operator&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;operator&quot;&gt;}&lt;/span&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;That’s so much better&lt;/strong&gt;. Let’s see how it works and why it’s much more detailed.&lt;/p&gt;

&lt;!--more--&gt;
&lt;p&gt;&lt;a class=&quot;anchor&quot; id=&quot;read-more&quot;&gt;&lt;/a&gt;&lt;/p&gt;

&lt;h2 id=&quot;how-it-works&quot;&gt;How it works&lt;/h2&gt;

&lt;p&gt;Here’s stuff that is highlighted here and doesn’t get highlighted in Pygments:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Classes&lt;/li&gt;
  &lt;li&gt;Parameters&lt;/li&gt;
  &lt;li&gt;Macros&lt;/li&gt;
  &lt;li&gt;Enum values&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;If you set up the color theme in Visual Studio, you can highlight much more stuff:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Namespaces&lt;/li&gt;
  &lt;li&gt;Local variables&lt;/li&gt;
  &lt;li&gt;Member variables&lt;/li&gt;
  &lt;li&gt;Member functions&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;… and much more!&lt;/p&gt;

&lt;p&gt;Why? That’s because highlighters like &lt;strong&gt;Pygments&lt;/strong&gt;, &lt;strong&gt;highlight.js&lt;/strong&gt; highlight using syntax rules. This may be enough for easier languages like HTML, CSS or others, but this isn’t enough for languages as C++ where meanings of tokens are needed for detailed highlighting.&lt;/p&gt;

&lt;p&gt;Visual Studio can highlight classes, enum variables, macros etc. because it pre-compiles the code in your project and knows what different tokens mean. So let’s use all that info.&lt;/p&gt;

&lt;p class=&quot;message&quot;&gt;You don't have to use Visual Studio for this, I'm just showing this method which can be useful for people who already do. If you use other IDEs/editors, find out if they support copying HTML markup of your code and use that instead.&lt;/p&gt;

&lt;h2 id=&quot;copying-html-markup&quot;&gt;Copying HTML markup&lt;/h2&gt;

&lt;p&gt;Let’s see how better highlighting can be achieved.&lt;/p&gt;

&lt;p&gt;First of all, you have to install &lt;a href=&quot;https://visualstudiogallery.msdn.microsoft.com/d0d33361-18e2-46c0-8ff2-4adea1e34fef&quot;&gt;Productivity Power Tools&lt;/a&gt;. In &lt;strong&gt;Options, Productivity Power Tools, HTML Copy&lt;/strong&gt; you need to set &lt;strong&gt;EmitSpanClass&lt;/strong&gt; to &lt;strong&gt;true&lt;/strong&gt; and &lt;strong&gt;EmitSpanStyle&lt;/strong&gt; to &lt;strong&gt;false&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;Here’s a function signature for example:&lt;/p&gt;

&lt;pre class=&quot;vs-code&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;bool&lt;/span&gt; &lt;span class=&quot;cppType&quot;&gt;LuaScriptManager&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppMemberFunction&quot;&gt;loadScript&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;cppNamespace&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppType&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&quot;cppParameter&quot;&gt;filename&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;)&lt;/span&gt;&lt;/pre&gt;

&lt;p&gt;Copying markup from Visual Studio gets you this:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-html&quot; data-lang=&quot;html&quot;&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;pre&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;vs-code&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&amp;lt;span&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;keyword&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;bool&lt;span class=&quot;nt&quot;&gt;&amp;lt;/span&amp;gt;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;lt;span&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;cppType - identifier - (TRANSIENT)&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;LuaScriptManager&lt;span class=&quot;nt&quot;&gt;&amp;lt;/span&amp;gt;&amp;lt;span&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;operator&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;::&lt;span class=&quot;nt&quot;&gt;&amp;lt;/span&amp;gt;&amp;lt;span&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;cppMemberFunction - identifier - (TRANSIENT)&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;loadScript&lt;span class=&quot;nt&quot;&gt;&amp;lt;/span&amp;gt;&amp;lt;span&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;operator&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;(&lt;span class=&quot;nt&quot;&gt;&amp;lt;/span&amp;gt;&amp;lt;span&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;keyword&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;const&lt;span class=&quot;nt&quot;&gt;&amp;lt;/span&amp;gt;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;lt;span&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;cppNamespace - identifier - (TRANSIENT)&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;std&lt;span class=&quot;nt&quot;&gt;&amp;lt;/span&amp;gt;&amp;lt;span&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;operator&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;::&lt;span class=&quot;nt&quot;&gt;&amp;lt;/span&amp;gt;&amp;lt;span&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;cppType - identifier - (TRANSIENT)&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;string&lt;span class=&quot;nt&quot;&gt;&amp;lt;/span&amp;gt;&amp;lt;span&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;operator&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;ni&quot;&gt;&amp;amp;amp;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;/span&amp;gt;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;lt;span&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;cppParameter - identifier - (TRANSIENT)&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;filename&lt;span class=&quot;nt&quot;&gt;&amp;lt;/span&amp;gt;&amp;lt;span&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;operator&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;)&lt;span class=&quot;nt&quot;&gt;&amp;lt;/span&amp;gt;&amp;lt;/pre&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;By default Productivity Power tools adds stuff like background color, font, etc. but you can configure it to generate &lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;lt;pre class=&quot;vs-code&quot;&amp;gt;&lt;/code&gt; in the beginning (this selector will be shown later).&lt;/p&gt;

&lt;p&gt;Things like “- identifier - (TRANSIENT)” inside &lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;lt;span&amp;gt;&lt;/code&gt; elements can be safely removed. Let’s see what we got, here’s one of the generated &lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;lt;span&amp;gt;&lt;/code&gt; elements:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-html&quot; data-lang=&quot;html&quot;&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;span&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;cppParameter&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;filename&lt;span class=&quot;nt&quot;&gt;&amp;lt;/span&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;As you can see, the semantic meaning of &lt;code class=&quot;highlighter-rouge&quot;&gt;filename&lt;/code&gt; is not lost! We still know that it’s a function parameter and we can highlight it properly.&lt;/p&gt;

&lt;h2 id=&quot;setting-css&quot;&gt;Setting CSS&lt;/h2&gt;

&lt;p&gt;Using CSS we can define &lt;code class=&quot;highlighter-rouge&quot;&gt;vs-code&lt;/code&gt; like this:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-css&quot; data-lang=&quot;css&quot;&gt;&lt;span class=&quot;nc&quot;&gt;.vs-code&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nl&quot;&gt;font-family&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Consolas&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;nl&quot;&gt;font-size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;13&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;nl&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;#dfdfbf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;nl&quot;&gt;background&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;#2c2c2c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;err&quot;&gt;...&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;/* etc. */&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;And now we can define different colors for different C++ tokens:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-css&quot; data-lang=&quot;css&quot;&gt;&lt;span class=&quot;nc&quot;&gt;.vs-code&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;.comment&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;#7a987a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;}&lt;/span&gt;
&lt;span class=&quot;nc&quot;&gt;.vs-code&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;.keyword&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;#efc986&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;nc&quot;&gt;.vs-code&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;.cppMacro&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;#bd63c5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;nc&quot;&gt;.vs-code&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;.number&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;#6e96be&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;}&lt;/span&gt;
&lt;span class=&quot;nc&quot;&gt;.vs-code&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;.operator&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;#dfdfbf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;}&lt;/span&gt;
&lt;span class=&quot;nc&quot;&gt;.vs-code&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;.cppType&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;#8acccf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;...&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;/* etc. */&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;And that’s it! Enjoy more detailed highlighting and make your articles more readable with it.&lt;/p&gt;

&lt;p&gt;Thank you for reading, hope you find this method useful!&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>CppCast: Talking about Lua and C++ in game development</title>
   <link href="https://eliasdaler.github.io/cppcast/"/>
   <updated>2016-07-09T01:50:00+03:00</updated>
   <id>https://eliasdaler.github.io/cppcast</id>
   <content type="html">&lt;p&gt;&lt;img src=&quot;/assets/cppcast.jpg&quot; alt=&quot;Me on CppCast&quot; /&gt;&lt;/p&gt;

&lt;p&gt;I recently gave an interview on &lt;strong&gt;CppCast&lt;/strong&gt;!
Listen to it &lt;a href=&quot;http://cppcast.com/2016/07/elias-daler&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Here are my some thoughts about CppCast and the episode.
&lt;!--more--&gt;&lt;a class=&quot;anchor&quot; id=&quot;read-more&quot;&gt;&lt;/a&gt;&lt;/p&gt;

&lt;h2 id=&quot;about-cppcast&quot;&gt;About CppCast&lt;/h2&gt;

&lt;p&gt;If you’re never heard of &lt;strong&gt;CppCast&lt;/strong&gt; before - it’s one of the most amazing podcasts ever! The guests are always interesting and the discussions are very informative. The hosts know what to ask and what to talk about - they’re C++ developers themselves.
They also get awesome guests on the show. For example, there are episodes with people like &lt;a href=&quot;http://cppcast.com/2015/09/scott-meyers/&quot;&gt;Scott Meyers&lt;/a&gt;, &lt;a href=&quot;http://cppcast.com/2015/10/andrei-alexandrescu/&quot;&gt;Andrei Alexandrescu&lt;/a&gt; and &lt;a href=&quot;http://cppcast.com/2016/06/herb-sutter/&quot;&gt;Herb Sutter&lt;/a&gt;. These people are my heroes of programming, so it’s a big pleasure to be interviewed on the podcast of that caliber.&lt;/p&gt;

&lt;h2 id=&quot;episode-with-me&quot;&gt;Episode with me&lt;/h2&gt;

&lt;p&gt;I’ve never expected to be on the show so soon. I’ve joked about it: “Ah, I’ll be there in &lt;em&gt;X&lt;/em&gt; years when I get really successful”. It’s a big honor for me and I’m very thankful for Rob and Jason for making my dream of being on podcast come true.&lt;/p&gt;

&lt;p&gt;I’m sorry if I come of kinda derpy or awkward at times during the interview. First of all, I was pretty nervous and secondly, English is not my native language and I don’t speak in it in real life at all.
But still, I think I did pretty well and we discussed lots of neat stuff during the episode.&lt;/p&gt;

&lt;h2 id=&quot;if-you-want-to-learn-about-luac-integration-andor-read-my-other-blog-posts&quot;&gt;If you want to learn about Lua/C++ integration and/or read my other blog posts&lt;/h2&gt;

&lt;p&gt;This is my new blog, so check out my &lt;a href=&quot;https://eliasdaler.wordpress.com&quot;&gt;old blog&lt;/a&gt; for all the mentioned articles. If you want to start with Lua and C++, check out &lt;a href=&quot;https://eliasdaler.wordpress.com/2014/07/18/using-lua-with-cpp-luabridge/&quot;&gt;LuaBridge tutorial&lt;/a&gt; (though I recommend to use &lt;a href=&quot;https://github.com/ThePhD/sol2&quot;&gt;sol2&lt;/a&gt; as a binding library). If you want to see how you can use Lua in Practice, check out &lt;a href=&quot;https://eliasdaler.wordpress.com/2015/08/10/using-lua-and-cpp-in-practice/&quot;&gt;Using Lua in practice&lt;/a&gt; articles (there are five of them!). And check out &lt;a href=&quot;https://eliasdaler.wordpress.com/tag/dev-log/&quot;&gt;Re:creation dev logs&lt;/a&gt; for in-depth explanation of what I did about the game and how I make my game engine.&lt;/p&gt;

&lt;p&gt;The new articles are coming very soon, check out what I’m planning to write &lt;a href=&quot;https://eliasdaler.github.io/first-post&quot;&gt;here&lt;/a&gt; (I promised that there’ll be some when the podcast airs, but I didn’t think that episode will come out so soon, so sorry about that). I think these articles will be even better, there’s a lot of things I’ve learned during the last few years.&lt;/p&gt;

&lt;p&gt;Thanks for reading and listening. Please let me know what you thought of the episode in the comments!&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>New blog, new articles!</title>
   <link href="https://eliasdaler.github.io/first-post/"/>
   <updated>2016-07-07T14:50:20+03:00</updated>
   <id>https://eliasdaler.github.io/first-post</id>
   <content type="html">&lt;p&gt;Hello and welcome to my new blog!
After using my &lt;a href=&quot;https://eliasdaler.wordpress.com/&quot;&gt;old blog&lt;/a&gt; for several years, I’ve decided that it’s time to move on. This blog is made with &lt;strong&gt;Jekyll&lt;/strong&gt; and it’s currently hosted at &lt;strong&gt;GitHub&lt;/strong&gt;, though eventually I plan to register proper domain for my site once I feel that the blog is good enough.&lt;/p&gt;

&lt;p&gt;I feel that having a minimalist blog with great customization is awesome and it will improve looks of my blog posts a lot. Just look at that beautiful code block, that’s how the code will look from now on:&lt;/p&gt;

&lt;p&gt;In Pygments:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-c--&quot; data-lang=&quot;c++&quot;&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Entity&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;addComponent&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;componentName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ScriptDataLoader&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;loader&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;auto&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;componentManager&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;engine_system&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ComponentManager&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;auto&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;componentType&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;componentManager&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;getTypeIndex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;componentName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;hasComponent&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;componentType&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;auto&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;log&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;engine_system&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;LogManager&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;LogManager&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;MessageType&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Error&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;name&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;: Component with type &quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;componentName&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;already exists.&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;auto&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;c&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;componentManager&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;createComponent&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;componentType&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;componentManager&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;loadFromLua&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;componentType&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;loader&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;owner&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;init&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;addComponent&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;componentType&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;move&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;And this is a test of HTML markup from Visual Studio!&lt;/p&gt;
&lt;pre class=&quot;vs-code&quot;&gt;
&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;cppType&quot;&gt;Entity&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppMemberFunction&quot;&gt;addComponent&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;cppNamespace&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppType&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&quot;cppParameter&quot;&gt;componentName&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;cppType&quot;&gt;ScriptDataLoader&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&quot;cppParameter&quot;&gt;loader&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;
{&lt;/span&gt;
    &lt;span class=&quot;keyword&quot;&gt;auto&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&quot;cppLocalVariable&quot;&gt;componentManager&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;cppGlobalVariable&quot;&gt;engine_system&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;cppMemberFunction&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;cppType&quot;&gt;ComponentManager&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;gt;();&lt;/span&gt;
    &lt;span class=&quot;keyword&quot;&gt;auto&lt;/span&gt; &lt;span class=&quot;cppLocalVariable&quot;&gt;componentType&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;cppLocalVariable&quot;&gt;componentManager&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;cppMemberFunction&quot;&gt;getTypeIndex&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;cppParameter&quot;&gt;componentName&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;cppMemberFunction&quot;&gt;hasComponent&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;cppLocalVariable&quot;&gt;componentType&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;keyword&quot;&gt;auto&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&quot;cppLocalVariable&quot;&gt;log&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;cppGlobalVariable&quot;&gt;engine_system&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;cppMemberFunction&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;cppType&quot;&gt;LogManager&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;&amp;gt;();&lt;/span&gt;
        &lt;span class=&quot;cppLocalVariable&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;cppMemberOperator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;cppType&quot;&gt;LogManager&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppType&quot;&gt;MessageType&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppEnumerator&quot;&gt;Error&lt;/span&gt;&lt;span class=&quot;cppMemberOperator&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;cppMemberOperator&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;cppMemberField&quot;&gt;name&lt;/span&gt; &lt;span class=&quot;cppMemberOperator&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&amp;quot;: Component with type &amp;quot;&lt;/span&gt; &lt;span class=&quot;cppMemberOperator&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;cppParameter&quot;&gt;componentName&lt;/span&gt; &lt;span class=&quot;cppMemberOperator&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&amp;quot;already exists.&amp;quot;&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;operator&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;keyword&quot;&gt;auto&lt;/span&gt; &lt;span class=&quot;cppLocalVariable&quot;&gt;c&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;cppLocalVariable&quot;&gt;componentManager&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;cppMemberFunction&quot;&gt;createComponent&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;cppLocalVariable&quot;&gt;componentType&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;cppLocalVariable&quot;&gt;componentManager&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;cppMemberFunction&quot;&gt;loadFromLua&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;cppLocalVariable&quot;&gt;componentType&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;cppMemberOperator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;cppLocalVariable&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;cppMemberField&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;cppParameter&quot;&gt;loader&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;cppLocalVariable&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;cppMemberOperator&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;cppMemberField&quot;&gt;owner&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;cppLocalVariable&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;cppMemberOperator&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;cppMemberFunction&quot;&gt;init&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;cppMemberFunction&quot;&gt;addComponent&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;cppLocalVariable&quot;&gt;componentType&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;cppNamespace&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;cppFunction&quot;&gt;move&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;cppLocalVariable&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;operator&quot;&gt;));&lt;/span&gt;
&lt;span class=&quot;operator&quot;&gt;}&lt;/span&gt;
&lt;/pre&gt;

&lt;p&gt;There are some new articles coming soon and will be published on this blog, but first, let’s talk about it.&lt;/p&gt;

&lt;!--more--&gt;
&lt;p&gt;&lt;a class=&quot;anchor&quot; id=&quot;read-more&quot;&gt;&lt;/a&gt;&lt;/p&gt;

&lt;h2 id=&quot;why-i-created-a-new-blog&quot;&gt;Why I created a new blog&lt;/h2&gt;

&lt;p&gt;There were several reasons for that:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Not much customization was available&lt;/strong&gt;. I was using free version of Wordpress which limited me with what I can do about the site. I wasn’t very happy about most of the free themes on the site and the one I was using was the best one for me, but there were still some small problems with it which I wanted to fix but wasn’t able to.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Wordpress liked breaking my code&lt;/strong&gt;. It kept inserting &lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;amp;lt;&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;amp;gt;&lt;/code&gt; instead of &lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;lt;&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;gt;&lt;/code&gt; and stuff like that. No matter what I’ve tried, it always ended up doing it, even if the code was inside &lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;lt;pre&amp;gt;&lt;/code&gt; or &lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;lt;code&amp;gt;&lt;/code&gt; tags! It was really awful and even a small fix in the article was hard to make because of that.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;No Lua highlighting&lt;/strong&gt;. There was no support for Lua and for guy who writes so much about Lua it was really hard. I ended up using Python highlighting for most Lua code blocks but it wasn’t perfect.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Disqus&lt;/strong&gt;. I like Disqus very much, it’s better than Wordpress comment system and allows more people to comment on my articles.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Source control&lt;/strong&gt;. While Wordpress has source control system, it’s easier for me to use git for that. It wasn’t possible with free Wordpress account, of course.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;… and there are some other small reasons but I’ll stop at that.&lt;/p&gt;

&lt;h2 id=&quot;future-plans&quot;&gt;Future plans&lt;/h2&gt;

&lt;p&gt;There are several articles I plan to write and they’ll be published on this blog from now on:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Using ImGui (with SFML) Part Two&lt;/strong&gt;. This article will show some notable things about ImGui: some useful things, some hacks and tips about using it with modern C++ and STL.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;How I use modern C++&lt;/strong&gt;. In this article I’ll show how I use modern C++ while developing my game and how it makes my code more readable and safer. I’ll also address some myths about modern C++ which are mostly result of ignorance or false claims coming from “C with classes” programmers.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Using Lua with C++ series reboot&lt;/strong&gt;. Yeah, it’s coming! Let’s talk a bit more about it.&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;using-lua-with-c-reboot&quot;&gt;Using Lua with C++ reboot&lt;/h2&gt;

&lt;p&gt;&lt;img src=&quot;/assets/lua-logo.png&quot; alt=&quot;Lua logo&quot; style=&quot;display: block;margin: 0 auto;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;I wrote the first Lua/C++ articles almost three years ago! This was my first article which got really big and inspired me to continue writing lots of articles devoted to Lua and C++ integration.&lt;/p&gt;

&lt;p&gt;And now I feel like I need to re-write the tutorial series from the ground up because I’ve learned a lot during the last three years. I’ve also received lots of e-mails with different questions about Lua and C++ and I’ve noticed some things which need to be addressed and explained in detail.&lt;/p&gt;

&lt;p&gt;The series will start with me explaining why Lua is awesome and how it can be used in game development. I’ll start with explaining some things about how Lua works internally and how you can use Lua C API to interact with it. While there are some amazing Lua/C++ bindings out there, I feel that understanding how Lua and Lua C API work is very important and useful for using Lua efficiently.&lt;/p&gt;

&lt;p&gt;After some basic discussion the series will move on to practical examples of how I use Lua while developing &lt;strong&gt;Re:creation&lt;/strong&gt;. During years of using Lua I’ve discovered some useful scripting patterns which will be explained in these articles.&lt;/p&gt;

&lt;h2 id=&quot;feedback&quot;&gt;Feedback&lt;/h2&gt;

&lt;p&gt;Thank you for your feedback about all my articles! As I’m writing new articles, please tell me what you want to see in Lua/C++ or modern C++ articles. Your opinion is very important to me and I’ll try to answer your questions about different stuff in my new articles. See you soon!&lt;/p&gt;
</content>
 </entry>
 

</feed>
