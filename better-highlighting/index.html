<!DOCTYPE html>
<html lang="en-us">
  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Improving code highlighting on blogs &middot; Elias Daler's blog
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/lanyon.css">
  <link rel="stylesheet" href="/public/css/videoWrapper.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">
  <link rel="stylesheet" href="/css/main.css">

  <!-- Icons -->
  <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>

  <body>

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">

  <div class="sidebar-item">
    <h4 style="color:#FFFFFF;"><i class="fa fa-gamepad fa-3x" aria-hidden="true"></i><br>Elias Daler's blog
</h4>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="/"><i class="fa fa-home fa-fw" aria-hidden="true"></i>&nbsp; Home</a>
    <a class="sidebar-nav-item" href="/re-creation/"><i class="fa fa-gamepad fa-fw" aria-hidden="true"></i>&nbsp; Re:creation</a>
    <a class="sidebar-nav-item" href="/programming-and-gamedev-resources/"><i class="fa fa-list-ul fa-fw" aria-hidden="true"></i>&nbsp; Programming and game dev resources</a>
    <a class="sidebar-nav-item" href="/about/"><i class="fa fa-user fa-fw" aria-hidden="true"></i>&nbsp; About</a>
    <a class="sidebar-nav-item" href="/tags/"><i class="fa fa-tags fa-fw" aria-hidden="true"></i>&nbsp; Tags</a>
  </nav>

  <div class="sidebar-item">
    <h5 style="color:#FFFFFF;">
      &copy; 2021. Elias Daler. All rights reserved.
    </h5>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">Elias Daler's blog</a>
            <small></small>
          </h3>
        </div>
      </div>

      <div class="container content">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">Improving code highlighting on blogs</h1>
    <span class="post-meta"><time datetime="2016-07-10T15:42:00+03:00" itemprop="datePublished"><i class="fa fa-calendar" aria-hidden="true"></i> Posted on <b>Jul 10, 2016</b></time></span>
<ul class="tags">
  
    <li><a href="/tags#Code+highlighting" class="tag"><i class="fa fa-tag" aria-hidden="true"></i> Code highlighting</a></li>
  
    <li><a href="/tags#Tutorial" class="tag"><i class="fa fa-tag" aria-hidden="true"></i> Tutorial</a></li>
  
    <li><a href="/tags#HTML" class="tag"><i class="fa fa-tag" aria-hidden="true"></i> HTML</a></li>
  
    <li><a href="/tags#CSS" class="tag"><i class="fa fa-tag" aria-hidden="true"></i> CSS</a></li>
  
</ul>
  </header>
  <hr>

  <div class="post-content" itemprop="articleBody">
    <p>Who knew that I’ll someday write about web programming, but here I am.</p>

<p class="message">This advice applies to lots of languages and editors, I use C++ and Visual Studio as an example.</p>

<p>Lots of sites use <strong>Pygments</strong> or <strong>highlight.js</strong> as a syntax highlighter and here’s how C++ code highlighted in <strong>Pygments</strong> looks (<strong>highlight.js</strong> produces almost identical output):</p>

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="kt">bool</span> <span class="n">LuaScriptManager</span><span class="o">::</span><span class="n">loadScript</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">filename</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">numberOrArgs</span> <span class="o">=</span> <span class="n">lua_gettop</span><span class="p">(</span><span class="n">L</span><span class="p">);</span>
    <span class="k">auto</span><span class="o">&amp;</span> <span class="n">log</span> <span class="o">=</span> <span class="n">engine_system</span><span class="p">.</span><span class="n">get</span><span class="o">&lt;</span><span class="n">LogManager</span><span class="o">&gt;</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">luaL_loadfile</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">filename</span><span class="p">.</span><span class="n">c_str</span><span class="p">())</span> <span class="o">||</span> <span class="n">lua_pcall</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">numberOrArgs</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)))</span> <span class="p">{</span>
        <span class="n">log</span><span class="p">(</span><span class="n">LogManager</span><span class="o">::</span><span class="n">MessageType</span><span class="o">::</span><span class="n">Lua</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">"Loaded script: "</span> <span class="o">&lt;&lt;</span> <span class="n">filename</span><span class="p">;</span>
        <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="c1">// some error</span>
        <span class="n">log</span><span class="p">(</span><span class="n">LogManager</span><span class="o">::</span><span class="n">MessageType</span><span class="o">::</span><span class="n">Lua_Exception</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">"Failed to load: "</span> <span class="o">&lt;&lt;</span> <span class="n">filename</span><span class="p">;</span>
        <span class="n">log</span><span class="p">(</span><span class="n">LogManager</span><span class="o">::</span><span class="n">MessageType</span><span class="o">::</span><span class="n">Lua_Exception</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">lua_tostring</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span>
        <span class="n">lua_pop</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span> <span class="c1">// pop error message from stack</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>But here’s what you can do with Visual Studio by copying HTML markup from it and applying some CSS:</p>

<pre class="vs-code"><span class="keyword">bool</span> <span class="cppType">LuaScriptManager</span><span class="operator">::</span><span class="cppMemberFunction">loadScript</span><span class="operator">(</span><span class="keyword">const</span> <span class="cppNamespace">std</span><span class="operator">::</span><span class="cppType">string</span><span class="operator">&amp;</span> <span class="cppParameter">filename</span><span class="operator">)</span>
<span class="operator">{</span>
    <span class="keyword">int</span> <span class="cppLocalVariable">numberOrArgs</span> <span class="operator">=</span> <span class="cppFunction">lua_gettop</span><span class="operator">(</span><span class="cppMemberField">L</span><span class="operator">);</span>
    <span class="keyword">auto</span><span class="operator">&amp;</span> <span class="cppLocalVariable">log</span> <span class="operator">=</span> <span class="cppGlobalVariable">engine_system</span><span class="operator">.</span><span class="cppMemberFunction">get</span><span class="operator">&lt;</span><span class="cppType">LogManager</span><span class="operator">&gt;();</span>
    <span class="keyword">if</span> <span class="operator">(!(</span><span class="cppMacro">luaL_loadfile</span><span class="operator">(</span><span class="cppMemberField">L</span><span class="operator">,</span> <span class="cppParameter">filename</span><span class="operator">.</span><span class="cppMemberFunction">c_str</span><span class="operator">())</span> <span class="operator">||</span> <span class="cppMacro">lua_pcall</span><span class="operator">(</span><span class="cppMemberField">L</span><span class="operator">,</span> <span class="cppLocalVariable">numberOrArgs</span><span class="operator">,</span> <span class="number">0</span><span class="operator">,</span> <span class="number">0</span><span class="operator">)))</span> <span class="operator">{</span>
        <span class="cppLocalVariable">log</span><span class="cppMemberOperator">(</span><span class="cppType">LogManager</span><span class="operator">::</span><span class="cppType">MessageType</span><span class="operator">::</span><span class="cppEnumerator">Lua</span><span class="cppMemberOperator">)</span> <span class="cppMemberOperator">&lt;&lt;</span> <span class="string">&quot;Loaded script: &quot;</span> <span class="cppMemberOperator">&lt;&lt;</span> <span class="cppParameter">filename</span><span class="operator">;</span>
        <span class="keyword">return</span> <span class="keyword">true</span><span class="operator">;</span>
    <span class="operator">}</span> <span class="keyword">else</span> <span class="operator">{</span> <span class="comment">// some error</span>
        <span class="cppLocalVariable">log</span><span class="cppMemberOperator">(</span><span class="cppType">LogManager</span><span class="operator">::</span><span class="cppType">MessageType</span><span class="operator">::</span><span class="cppEnumerator">Lua_Exception</span><span class="cppMemberOperator">)</span> <span class="cppMemberOperator">&lt;&lt;</span> <span class="string">&quot;Failed to load: &quot;</span> <span class="cppMemberOperator">&lt;&lt;</span> <span class="cppParameter">filename</span><span class="operator">;</span>
        <span class="cppLocalVariable">log</span><span class="cppMemberOperator">(</span><span class="cppType">LogManager</span><span class="operator">::</span><span class="cppType">MessageType</span><span class="operator">::</span><span class="cppEnumerator">Lua_Exception</span><span class="cppMemberOperator">)</span> <span class="cppMemberOperator">&lt;&lt;</span> <span class="cppMacro">lua_tostring</span><span class="operator">(</span><span class="cppMemberField">L</span><span class="operator">,</span> <span class="operator">-</span><span class="number">1</span><span class="operator">);</span>
        <span class="cppMacro">lua_pop</span><span class="operator">(</span><span class="cppMemberField">L</span><span class="operator">,</span> <span class="number">1</span><span class="operator">);</span> <span class="comment">// pop error message from stack</span>
        <span class="keyword">return</span> <span class="keyword">false</span><span class="operator">;</span>
    <span class="operator">}</span>
<span class="operator">}</span></pre>

<p><strong>That’s so much better</strong>. Let’s see how it works and why it’s much more detailed.</p>

<!--more-->
<p><a class="anchor" id="read-more"></a></p>

<h2 id="how-it-works">How it works</h2>

<p>Here’s stuff that is highlighted here and doesn’t get highlighted in Pygments:</p>

<ul>
  <li>Classes</li>
  <li>Parameters</li>
  <li>Macros</li>
  <li>Enum values</li>
</ul>

<p>If you set up the color theme in Visual Studio, you can highlight much more stuff:</p>

<ul>
  <li>Namespaces</li>
  <li>Local variables</li>
  <li>Member variables</li>
  <li>Member functions</li>
</ul>

<p>… and much more!</p>

<p>Why? That’s because highlighters like <strong>Pygments</strong>, <strong>highlight.js</strong> highlight using syntax rules. This may be enough for easier languages like HTML, CSS or others, but this isn’t enough for languages as C++ where meanings of tokens are needed for detailed highlighting.</p>

<p>Visual Studio can highlight classes, enum variables, macros etc. because it pre-compiles the code in your project and knows what different tokens mean. So let’s use all that info.</p>

<p class="message">You don't have to use Visual Studio for this, I'm just showing this method which can be useful for people who already do. If you use other IDEs/editors, find out if they support copying HTML markup of your code and use that instead.</p>

<h2 id="copying-html-markup">Copying HTML markup</h2>

<p>Let’s see how better highlighting can be achieved.</p>

<p>First of all, you have to install <a href="https://visualstudiogallery.msdn.microsoft.com/d0d33361-18e2-46c0-8ff2-4adea1e34fef">Productivity Power Tools</a>. In <strong>Options, Productivity Power Tools, HTML Copy</strong> you need to set <strong>EmitSpanClass</strong> to <strong>true</strong> and <strong>EmitSpanStyle</strong> to <strong>false</strong>.</p>

<p>Here’s a function signature for example:</p>

<pre class="vs-code"><span class="keyword">bool</span> <span class="cppType">LuaScriptManager</span><span class="operator">::</span><span class="cppMemberFunction">loadScript</span><span class="operator">(</span><span class="keyword">const</span> <span class="cppNamespace">std</span><span class="operator">::</span><span class="cppType">string</span><span class="operator">&amp;</span> <span class="cppParameter">filename</span><span class="operator">)</span></pre>

<p>Copying markup from Visual Studio gets you this:</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;pre</span> <span class="na">class=</span><span class="s">"vs-code"</span><span class="nt">&gt;&lt;span</span> <span class="na">class=</span><span class="s">"keyword"</span><span class="nt">&gt;</span>bool<span class="nt">&lt;/span&gt;</span> <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"cppType - identifier - (TRANSIENT)"</span><span class="nt">&gt;</span>LuaScriptManager<span class="nt">&lt;/span&gt;&lt;span</span> <span class="na">class=</span><span class="s">"operator"</span><span class="nt">&gt;</span>::<span class="nt">&lt;/span&gt;&lt;span</span> <span class="na">class=</span><span class="s">"cppMemberFunction - identifier - (TRANSIENT)"</span><span class="nt">&gt;</span>loadScript<span class="nt">&lt;/span&gt;&lt;span</span> <span class="na">class=</span><span class="s">"operator"</span><span class="nt">&gt;</span>(<span class="nt">&lt;/span&gt;&lt;span</span> <span class="na">class=</span><span class="s">"keyword"</span><span class="nt">&gt;</span>const<span class="nt">&lt;/span&gt;</span> <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"cppNamespace - identifier - (TRANSIENT)"</span><span class="nt">&gt;</span>std<span class="nt">&lt;/span&gt;&lt;span</span> <span class="na">class=</span><span class="s">"operator"</span><span class="nt">&gt;</span>::<span class="nt">&lt;/span&gt;&lt;span</span> <span class="na">class=</span><span class="s">"cppType - identifier - (TRANSIENT)"</span><span class="nt">&gt;</span>string<span class="nt">&lt;/span&gt;&lt;span</span> <span class="na">class=</span><span class="s">"operator"</span><span class="nt">&gt;</span><span class="ni">&amp;amp;</span><span class="nt">&lt;/span&gt;</span> <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"cppParameter - identifier - (TRANSIENT)"</span><span class="nt">&gt;</span>filename<span class="nt">&lt;/span&gt;&lt;span</span> <span class="na">class=</span><span class="s">"operator"</span><span class="nt">&gt;</span>)<span class="nt">&lt;/span&gt;&lt;/pre&gt;</span></code></pre></figure>

<p>By default Productivity Power tools adds stuff like background color, font, etc. but you can configure it to generate <code class="highlighter-rouge">&lt;pre class="vs-code"&gt;</code> in the beginning (this selector will be shown later).</p>

<p>Things like “- identifier - (TRANSIENT)” inside <code class="highlighter-rouge">&lt;span&gt;</code> elements can be safely removed. Let’s see what we got, here’s one of the generated <code class="highlighter-rouge">&lt;span&gt;</code> elements:</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"cppParameter"</span><span class="nt">&gt;</span>filename<span class="nt">&lt;/span&gt;</span></code></pre></figure>

<p>As you can see, the semantic meaning of <code class="highlighter-rouge">filename</code> is not lost! We still know that it’s a function parameter and we can highlight it properly.</p>

<h2 id="setting-css">Setting CSS</h2>

<p>Using CSS we can define <code class="highlighter-rouge">vs-code</code> like this:</p>

<figure class="highlight"><pre><code class="language-css" data-lang="css"><span class="nc">.vs-code</span> <span class="p">{</span>
    <span class="nl">font-family</span><span class="p">:</span><span class="n">Consolas</span><span class="p">;</span>
    <span class="nl">font-size</span><span class="p">:</span><span class="m">13</span><span class="p">;</span>
    <span class="nl">color</span><span class="p">:</span><span class="m">#dfdfbf</span><span class="p">;</span>
    <span class="nl">background</span><span class="p">:</span><span class="m">#2c2c2c</span><span class="p">;</span>
    <span class="err">...</span> <span class="c">/* etc. */</span>
<span class="p">}</span></code></pre></figure>

<p>And now we can define different colors for different C++ tokens:</p>

<figure class="highlight"><pre><code class="language-css" data-lang="css"><span class="nc">.vs-code</span> <span class="nc">.comment</span> <span class="p">{</span> <span class="nl">color</span><span class="p">:</span><span class="m">#7a987a</span><span class="p">;}</span>
<span class="nc">.vs-code</span> <span class="nc">.keyword</span> <span class="p">{</span> <span class="nl">color</span><span class="p">:</span> <span class="m">#efc986</span><span class="p">;</span> <span class="p">}</span>
<span class="nc">.vs-code</span> <span class="nc">.cppMacro</span> <span class="p">{</span> <span class="nl">color</span><span class="p">:</span> <span class="m">#bd63c5</span><span class="p">}</span>
<span class="nc">.vs-code</span> <span class="nc">.number</span> <span class="p">{</span> <span class="nl">color</span><span class="p">:</span> <span class="m">#6e96be</span><span class="p">;}</span>
<span class="nc">.vs-code</span> <span class="nc">.operator</span> <span class="p">{</span> <span class="nl">color</span><span class="p">:</span> <span class="m">#dfdfbf</span><span class="p">;}</span>
<span class="nc">.vs-code</span> <span class="nc">.cppType</span> <span class="p">{</span> <span class="nl">color</span><span class="p">:</span><span class="m">#8acccf</span><span class="p">;</span> <span class="p">}</span>
<span class="o">...</span> <span class="c">/* etc. */</span></code></pre></figure>

<p>And that’s it! Enjoy more detailed highlighting and make your articles more readable with it.</p>

<p>Thank you for reading, hope you find this method useful!</p>

    <hr />
    <p>Follow me on twitter <a href="https://twitter.com/EliasDaler">@EliasDaler</a> to not miss the new stuff!</p>
  </div>

</article>
<div id="disqus_thread"></div>
<script>
    /**
     *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
     *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
     */
    /*
    var disqus_config = function () {
        this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
        this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    */
    (function() {  // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');
        
        s.src = '//eliasdaler-github-io.disqus.com/embed.js';
        
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

    <script>
      (function(document) {
        var toggle = document.querySelector('.sidebar-toggle');
        var sidebar = document.querySelector('#sidebar');
        var checkbox = document.querySelector('#sidebar-checkbox');

        document.addEventListener('click', function(e) {
          var target = e.target;

          if(!checkbox.checked ||
             sidebar.contains(target) ||
             (target === checkbox || target === toggle)) return;

          checkbox.checked = false;
        }, false);
      })(document);
    </script>

  </body>
</html>
